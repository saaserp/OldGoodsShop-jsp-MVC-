/*! cart 2015-02-05 15:10:59 */
KISSY.add("cart/utils/loading/loading",function(a,b){var c=b.all,d='<div id="J_Loading" class="loading-bar"><p>\u6b63\u5728\u52aa\u529b\u52a0\u8f7d\u4e2d...</p></div>';return{show:function(a){this.hide(),a=c(a||"#J_CartMain");c(d).appendTo(a)},hide:function(){c("#J_Loading").remove()}}},{requires:["node"]}),KISSY.add("cart/utils/lang/lang",function(){function a(a){for(var d="",e=0;e<a.length;e++){var f=a.charAt(e),g=b.indexOf(f);d+=a.charCodeAt(e)>1e4&&-1!=g?c.charAt(g):a.charAt(e)}return d}var b="\u7691\u853c\u788d\u7231\u7ff1\u8884\u5965\u575d\u7f62\u6446\u8d25\u9881\u529e\u7eca\u5e2e\u7ed1\u9551\u8c24\u5265\u9971\u5b9d\u62a5\u9c8d\u8f88\u8d1d\u94a1\u72c8\u5907\u60eb\u7ef7\u7b14\u6bd5\u6bd9\u95ed\u8fb9\u7f16\u8d2c\u53d8\u8fa9\u8fab\u9cd6\u762a\u6fd2\u6ee8\u5bbe\u6448\u997c\u62e8\u94b5\u94c2\u9a73\u535c\u8865\u53c2\u8695\u6b8b\u60ed\u60e8\u707f\u82cd\u8231\u4ed3\u6ca7\u5395\u4fa7\u518c\u6d4b\u5c42\u8be7\u6400\u63ba\u8749\u998b\u8c17\u7f20\u94f2\u4ea7\u9610\u98a4\u573a\u5c1d\u957f\u507f\u80a0\u5382\u7545\u949e\u8f66\u5f7b\u5c18\u9648\u886c\u6491\u79f0\u60e9\u8bda\u9a8b\u75f4\u8fdf\u9a70\u803b\u9f7f\u70bd\u51b2\u866b\u5ba0\u7574\u8e0c\u7b79\u7ef8\u4e11\u6a71\u53a8\u9504\u96cf\u7840\u50a8\u89e6\u5904\u4f20\u75ae\u95ef\u521b\u9524\u7eaf\u7ef0\u8f9e\u8bcd\u8d50\u806a\u8471\u56f1\u4ece\u4e1b\u51d1\u7a9c\u9519\u8fbe\u5e26\u8d37\u62c5\u5355\u90f8\u63b8\u80c6\u60ee\u8bde\u5f39\u5f53\u6321\u515a\u8361\u6863\u6363\u5c9b\u7977\u5bfc\u76d7\u706f\u9093\u654c\u6da4\u9012\u7f14\u70b9\u57ab\u7535\u6dc0\u9493\u8c03\u8fed\u8c0d\u53e0\u9489\u9876\u952d\u8ba2\u4e1c\u52a8\u680b\u51bb\u6597\u728a\u72ec\u8bfb\u8d4c\u9540\u953b\u65ad\u7f0e\u5151\u961f\u5bf9\u5428\u987f\u949d\u593a\u9e45\u989d\u8bb9\u6076\u997f\u513f\u5c14\u9975\u8d30\u53d1\u7f5a\u9600\u73d0\u77fe\u9492\u70e6\u8303\u8d29\u996d\u8bbf\u7eba\u98de\u5e9f\u8d39\u7eb7\u575f\u594b\u6124\u7caa\u4e30\u67ab\u950b\u98ce\u75af\u51af\u7f1d\u8bbd\u51e4\u80a4\u8f90\u629a\u8f85\u8d4b\u590d\u8d1f\u8ba3\u5987\u7f1a\u8be5\u9499\u76d6\u5e72\u8d76\u79c6\u8d63\u5188\u521a\u94a2\u7eb2\u5c97\u768b\u9550\u6401\u9e3d\u9601\u94ec\u4e2a\u7ed9\u9f9a\u5bab\u5de9\u8d21\u94a9\u6c9f\u6784\u8d2d\u591f\u86ca\u987e\u5250\u5173\u89c2\u9986\u60ef\u8d2f\u5e7f\u89c4\u7845\u5f52\u9f9f\u95fa\u8f68\u8be1\u67dc\u8d35\u523d\u8f8a\u6eda\u9505\u56fd\u8fc7\u9a87\u97e9\u6c49\u9602\u9e64\u8d3a\u6a2a\u8f70\u9e3f\u7ea2\u540e\u58f6\u62a4\u6caa\u6237\u54d7\u534e\u753b\u5212\u8bdd\u6000\u574f\u6b22\u73af\u8fd8\u7f13\u6362\u5524\u75ea\u7115\u6da3\u9ec4\u8c0e\u6325\u8f89\u6bc1\u8d3f\u79fd\u4f1a\u70e9\u6c47\u8bb3\u8bf2\u7ed8\u8364\u6d51\u4f19\u83b7\u8d27\u7978\u51fb\u673a\u79ef\u9965\u8ba5\u9e21\u7ee9\u7f09\u6781\u8f91\u7ea7\u6324\u51e0\u84df\u5242\u6d4e\u8ba1\u8bb0\u9645\u7ee7\u7eaa\u5939\u835a\u988a\u8d3e\u94be\u4ef7\u9a7e\u6b7c\u76d1\u575a\u7b3a\u95f4\u8270\u7f04\u8327\u68c0\u78b1\u7877\u62e3\u6361\u7b80\u4fed\u51cf\u8350\u69db\u9274\u8df5\u8d31\u89c1\u952e\u8230\u5251\u996f\u6e10\u6e85\u6da7\u6d46\u848b\u6868\u5956\u8bb2\u9171\u80f6\u6d47\u9a84\u5a07\u6405\u94f0\u77eb\u4fa5\u811a\u997a\u7f34\u7ede\u8f7f\u8f83\u79f8\u9636\u8282\u830e\u60ca\u7ecf\u9888\u9759\u955c\u5f84\u75c9\u7ade\u51c0\u7ea0\u53a9\u65e7\u9a79\u4e3e\u636e\u952f\u60e7\u5267\u9e43\u7ee2\u6770\u6d01\u7ed3\u8beb\u5c4a\u7d27\u9526\u4ec5\u8c28\u8fdb\u664b\u70ec\u5c3d\u52b2\u8346\u89c9\u51b3\u8bc0\u7edd\u94a7\u519b\u9a8f\u5f00\u51ef\u9897\u58f3\u8bfe\u57a6\u6073\u62a0\u5e93\u88e4\u5938\u5757\u4fa9\u5bbd\u77ff\u65f7\u51b5\u4e8f\u5cbf\u7aa5\u9988\u6e83\u6269\u9614\u8721\u814a\u83b1\u6765\u8d56\u84dd\u680f\u62e6\u7bee\u9611\u5170\u6f9c\u8c30\u63fd\u89c8\u61d2\u7f06\u70c2\u6ee5\u635e\u52b3\u6d9d\u4e50\u956d\u5792\u7c7b\u6cea\u7bf1\u79bb\u91cc\u9ca4\u793c\u4e3d\u5389\u52b1\u783e\u5386\u6ca5\u96b6\u4fe9\u8054\u83b2\u8fde\u9570\u601c\u6d9f\u5e18\u655b\u8138\u94fe\u604b\u70bc\u7ec3\u7cae\u51c9\u4e24\u8f86\u8c05\u7597\u8fbd\u9563\u730e\u4e34\u90bb\u9cde\u51db\u8d41\u9f84\u94c3\u51cc\u7075\u5cad\u9886\u998f\u5218\u9f99\u804b\u5499\u7b3c\u5784\u62e2\u9647\u697c\u5a04\u6402\u7bd3\u82a6\u5362\u9885\u5e90\u7089\u63b3\u5364\u864f\u9c81\u8d42\u7984\u5f55\u9646\u9a74\u5415\u94dd\u4fa3\u5c61\u7f15\u8651\u6ee4\u7eff\u5ce6\u631b\u5b6a\u6ee6\u4e71\u62a1\u8f6e\u4f26\u4ed1\u6ca6\u7eb6\u8bba\u841d\u7f57\u903b\u9523\u7ba9\u9aa1\u9a86\u7edc\u5988\u739b\u7801\u8682\u9a6c\u9a82\u5417\u4e70\u9ea6\u5356\u8fc8\u8109\u7792\u9992\u86ee\u6ee1\u8c29\u732b\u951a\u94c6\u8d38\u4e48\u9709\u6ca1\u9541\u95e8\u95f7\u4eec\u9530\u68a6\u8c1c\u5f25\u89c5\u7ef5\u7f05\u5e99\u706d\u60af\u95fd\u9e23\u94ed\u8c2c\u8c0b\u4ea9\u94a0\u7eb3\u96be\u6320\u8111\u607c\u95f9\u9981\u817b\u64b5\u637b\u917f\u9e1f\u8042\u556e\u954a\u954d\u67e0\u72de\u5b81\u62e7\u6cde\u94ae\u7ebd\u8113\u6d53\u519c\u759f\u8bfa\u6b27\u9e25\u6bb4\u5455\u6ca4\u76d8\u5e9e\u56fd\u7231\u8d54\u55b7\u9e4f\u9a97\u98d8\u9891\u8d2b\u82f9\u51ed\u8bc4\u6cfc\u9887\u6251\u94fa\u6734\u8c31\u8110\u9f50\u9a91\u5c82\u542f\u6c14\u5f03\u8bab\u7275\u6266\u948e\u94c5\u8fc1\u7b7e\u8c26\u94b1\u94b3\u6f5c\u6d45\u8c34\u5811\u67aa\u545b\u5899\u8537\u5f3a\u62a2\u9539\u6865\u4e54\u4fa8\u7fd8\u7a8d\u7a83\u94a6\u4eb2\u8f7b\u6c22\u503e\u9877\u8bf7\u5e86\u743c\u7a77\u8d8b\u533a\u8eaf\u9a71\u9f8b\u98a7\u6743\u529d\u5374\u9e4a\u8ba9\u9976\u6270\u7ed5\u70ed\u97e7\u8ba4\u7eab\u8363\u7ed2\u8f6f\u9510\u95f0\u6da6\u6d12\u8428\u9cc3\u8d5b\u4f1e\u4e27\u9a9a\u626b\u6da9\u6740\u7eb1\u7b5b\u6652\u95ea\u9655\u8d61\u7f2e\u4f24\u8d4f\u70e7\u7ecd\u8d4a\u6444\u6151\u8bbe\u7ec5\u5ba1\u5a76\u80be\u6e17\u58f0\u7ef3\u80dc\u5723\u5e08\u72ee\u6e7f\u8bd7\u5c38\u65f6\u8680\u5b9e\u8bc6\u9a76\u52bf\u91ca\u9970\u89c6\u8bd5\u5bff\u517d\u67a2\u8f93\u4e66\u8d4e\u5c5e\u672f\u6811\u7ad6\u6570\u5e05\u53cc\u8c01\u7a0e\u987a\u8bf4\u7855\u70c1\u4e1d\u9972\u8038\u6002\u9882\u8bbc\u8bf5\u64de\u82cf\u8bc9\u8083\u867d\u7ee5\u5c81\u5b59\u635f\u7b0b\u7f29\u7410\u9501\u736d\u631e\u62ac\u644a\u8d2a\u762b\u6ee9\u575b\u8c2d\u8c08\u53f9\u6c64\u70eb\u6d9b\u7ee6\u817e\u8a8a\u9511\u9898\u4f53\u5c49\u6761\u8d34\u94c1\u5385\u542c\u70c3\u94dc\u7edf\u5934\u56fe\u6d82\u56e2\u9893\u8715\u8131\u9e35\u9a6e\u9a7c\u692d\u6d3c\u889c\u5f2f\u6e7e\u987d\u4e07\u7f51\u97e6\u8fdd\u56f4\u4e3a\u6f4d\u7ef4\u82c7\u4f1f\u4f2a\u7eac\u8c13\u536b\u6e29\u95fb\u7eb9\u7a33\u95ee\u74ee\u631d\u8717\u6da1\u7a9d\u545c\u94a8\u4e4c\u8bec\u65e0\u829c\u5434\u575e\u96fe\u52a1\u8bef\u9521\u727a\u88ad\u4e60\u94e3\u620f\u7ec6\u867e\u8f96\u5ce1\u4fa0\u72ed\u53a6\u9528\u9c9c\u7ea4\u54b8\u8d24\u8854\u95f2\u663e\u9669\u73b0\u732e\u53bf\u9985\u7fa1\u5baa\u7ebf\u53a2\u9576\u4e61\u8be6\u54cd\u9879\u8427\u9500\u6653\u5578\u874e\u534f\u631f\u643a\u80c1\u8c10\u5199\u6cfb\u8c22\u950c\u8845\u5174\u6c79\u9508\u7ee3\u865a\u5618\u987b\u8bb8\u7eea\u7eed\u8f69\u60ac\u9009\u7663\u7eda\u5b66\u52cb\u8be2\u5bfb\u9a6f\u8bad\u8baf\u900a\u538b\u9e26\u9e2d\u54d1\u4e9a\u8bb6\u9609\u70df\u76d0\u4e25\u989c\u960e\u8273\u538c\u781a\u5f66\u8c1a\u9a8c\u9e2f\u6768\u626c\u75a1\u9633\u75d2\u517b\u6837\u7476\u6447\u5c27\u9065\u7a91\u8c23\u836f\u7237\u9875\u4e1a\u53f6\u533b\u94f1\u9890\u9057\u4eea\u5f5d\u8681\u827a\u4ebf\u5fc6\u4e49\u8be3\u8bae\u8c0a\u8bd1\u5f02\u7ece\u836b\u9634\u94f6\u996e\u6a31\u5a74\u9e70\u5e94\u7f28\u83b9\u8424\u8425\u8367\u8747\u9896\u54df\u62e5\u4f63\u75c8\u8e0a\u548f\u6d8c\u4f18\u5fe7\u90ae\u94c0\u72b9\u6e38\u8bf1\u8206\u9c7c\u6e14\u5a31\u4e0e\u5c7f\u8bed\u5401\u5fa1\u72f1\u8a89\u9884\u9a6d\u9e33\u6e0a\u8f95\u56ed\u5458\u5706\u7f18\u8fdc\u613f\u7ea6\u8dc3\u94a5\u5cb3\u7ca4\u60a6\u9605\u4e91\u90e7\u5300\u9668\u8fd0\u8574\u915d\u6655\u97f5\u6742\u707e\u8f7d\u6512\u6682\u8d5e\u8d43\u810f\u51ff\u67a3\u7076\u8d23\u62e9\u5219\u6cfd\u8d3c\u8d60\u624e\u672d\u8f67\u94e1\u95f8\u8bc8\u658b\u503a\u6be1\u76cf\u65a9\u8f97\u5d2d\u6808\u6218\u7efd\u5f20\u6da8\u5e10\u8d26\u80c0\u8d75\u86f0\u8f99\u9517\u8fd9\u8d1e\u9488\u4fa6\u8bca\u9547\u9635\u6323\u7741\u72f0\u5e27\u90d1\u8bc1\u7ec7\u804c\u6267\u7eb8\u631a\u63b7\u5e1c\u8d28\u949f\u7ec8\u79cd\u80bf\u4f17\u8bcc\u8f74\u76b1\u663c\u9aa4\u732a\u8bf8\u8bdb\u70db\u77a9\u5631\u8d2e\u94f8\u7b51\u9a7b\u4e13\u7816\u8f6c\u8d5a\u6869\u5e84\u88c5\u5986\u58ee\u72b6\u9525\u8d58\u5760\u7f00\u8c06\u6d4a\u5179\u8d44\u6e0d\u8e2a\u7efc\u603b\u7eb5\u90b9\u8bc5\u7ec4\u94bb\u81f4\u949f\u4e48\u4e3a\u53ea\u51f6\u51c6\u542f\u677f\u91cc\u96f3\u4f59\u94fe\u6cc4",c="\u769a\u85f9\u7919\u611b\u7ffa\u8956\u5967\u58e9\u7f77\u64fa\u6557\u9812\u8fa6\u7d46\u5e6b\u7d81\u938a\u8b17\u525d\u98fd\u5bf6\u5831\u9b91\u8f29\u8c9d\u92c7\u72fd\u5099\u618a\u7e43\u7b46\u7562\u6583\u9589\u908a\u7de8\u8cb6\u8b8a\u8faf\u8fae\u9f08\u765f\u7015\u6ff1\u8cd3\u64ef\u9905\u64a5\u7f3d\u9251\u99c1\u8514\u88dc\u53c3\u8836\u6b98\u615a\u6158\u71e6\u84bc\u8259\u5009\u6ec4\u5ec1\u5074\u518a\u6e2c\u5c64\u8a6b\u6519\u647b\u87ec\u995e\u8b92\u7e8f\u93df\u7523\u95e1\u986b\u5834\u5617\u9577\u511f\u8178\u5ee0\u66a2\u9214\u8eca\u5fb9\u5875\u9673\u896f\u6490\u7a31\u61f2\u8aa0\u9a01\u7661\u9072\u99b3\u6065\u9f52\u71be\u6c96\u87f2\u5bf5\u7587\u8e8a\u7c4c\u7da2\u919c\u6ae5\u5eda\u92e4\u96db\u790e\u5132\u89f8\u8655\u50b3\u7621\u95d6\u5275\u9318\u7d14\u7dbd\u8fad\u8a5e\u8cdc\u8070\u8525\u56ea\u5f9e\u53e2\u6e4a\u7ac4\u932f\u9054\u5e36\u8cb8\u64d4\u55ae\u9132\u64a3\u81bd\u619a\u8a95\u5f48\u7576\u64cb\u9ee8\u8569\u6a94\u6417\u5cf6\u79b1\u5c0e\u76dc\u71c8\u9127\u6575\u6ecc\u905e\u7de0\u9ede\u588a\u96fb\u6fb1\u91e3\u8abf\u53e0\u8adc\u758a\u91d8\u9802\u9320\u8a02\u6771\u52d5\u68df\u51cd\u9b25\u72a2\u7368\u8b80\u8ced\u934d\u935b\u65b7\u7dde\u514c\u968a\u5c0d\u5678\u9813\u920d\u596a\u9d5d\u984d\u8a1b\u60e1\u9913\u5152\u723e\u990c\u8cb3\u767c\u7f70\u95a5\u743a\u792c\u91e9\u7169\u7bc4\u8ca9\u98ef\u8a2a\u7d21\u98db\u5ee2\u8cbb\u7d1b\u58b3\u596e\u61a4\u7cde\u8c50\u6953\u92d2\u98a8\u760b\u99ae\u7e2b\u8af7\u9cf3\u819a\u8f3b\u64ab\u8f14\u8ce6\u8907\u8ca0\u8a03\u5a66\u7e1b\u8a72\u9223\u84cb\u5e79\u8d95\u7a08\u8d1b\u5ca1\u525b\u92fc\u7db1\u5d17\u81ef\u93ac\u64f1\u9d3f\u95a3\u927b\u500b\u7d66\u9f94\u5bae\u978f\u8ca2\u920e\u6e9d\u69cb\u8cfc\u5920\u8831\u9867\u526e\u95dc\u89c0\u9928\u6163\u8cab\u5ee3\u898f\u77fd\u6b78\u9f9c\u95a8\u8ecc\u8a6d\u6ac3\u8cb4\u528a\u8f25\u6efe\u934b\u570b\u904e\u99ed\u97d3\u6f22\u95a1\u9db4\u8cc0\u6a6b\u8f5f\u9d3b\u7d05\u5f8c\u58fa\u8b77\u6eec\u6236\u5629\u83ef\u756b\u5283\u8a71\u61f7\u58de\u6b61\u74b0\u9084\u7de9\u63db\u559a\u7613\u7165\u6e19\u9ec3\u8b0a\u63ee\u8f1d\u6bc0\u8cc4\u7a62\u6703\u71f4\u5f59\u8af1\u8aa8\u7e6a\u8477\u6e3e\u5925\u7372\u8ca8\u798d\u64ca\u6a5f\u7a4d\u9951\u8b4f\u96de\u7e3e\u7ddd\u6975\u8f2f\u7d1a\u64e0\u5e7e\u858a\u5291\u6fdf\u8a08\u8a18\u969b\u7e7c\u7d00\u593e\u83a2\u9830\u8cc8\u9240\u50f9\u99d5\u6bb2\u76e3\u5805\u7b8b\u9593\u8271\u7dd8\u7e6d\u6aa2\u583f\u9e7c\u63c0\u64bf\u7c21\u5109\u6e1b\u85a6\u6abb\u9452\u8e10\u8ce4\u898b\u9375\u8266\u528d\u991e\u6f38\u6ffa\u6f97\u6f3f\u8523\u69f3\u734e\u8b1b\u91ac\u81a0\u6f86\u9a55\u5b0c\u652a\u9278\u77ef\u50e5\u8173\u9903\u7e73\u7d5e\u8f4e\u8f03\u7a2d\u968e\u7bc0\u8396\u9a5a\u7d93\u9838\u975c\u93e1\u5f91\u75d9\u7af6\u6de8\u7cfe\u5ec4\u820a\u99d2\u8209\u64da\u92f8\u61fc\u5287\u9d51\u7d79\u5091\u6f54\u7d50\u8aa1\u5c46\u7dca\u9326\u50c5\u8b39\u9032\u6649\u71fc\u76e1\u52c1\u834a\u89ba\u6c7a\u8a23\u7d55\u921e\u8ecd\u99ff\u958b\u51f1\u9846\u6bbc\u8ab2\u58be\u61c7\u6473\u5eab\u8932\u8a87\u584a\u5108\u5bec\u7926\u66e0\u6cc1\u8667\u5dcb\u7aba\u994b\u6f70\u64f4\u95ca\u881f\u81d8\u840a\u4f86\u8cf4\u85cd\u6b04\u6514\u7c43\u95cc\u862d\u703e\u8b95\u652c\u89bd\u61f6\u7e9c\u721b\u6feb\u6488\u52de\u6f87\u6a02\u9433\u58d8\u985e\u6dda\u7c6c\u96e2\u88cf\u9bc9\u79ae\u9e97\u53b2\u52f5\u792b\u66c6\u701d\u96b8\u5006\u806f\u84ee\u9023\u942e\u6190\u6f23\u7c3e\u6582\u81c9\u93c8\u6200\u7149\u7df4\u7ce7\u6dbc\u5169\u8f1b\u8ad2\u7642\u907c\u9410\u7375\u81e8\u9130\u9c57\u51dc\u8cc3\u9f61\u9234\u6de9\u9748\u5dba\u9818\u993e\u5289\u9f8d\u807e\u56a8\u7c60\u58df\u650f\u96b4\u6a13\u5a41\u645f\u7c0d\u8606\u76e7\u9871\u5eec\u7210\u64c4\u9e75\u865c\u9b6f\u8cc2\u797f\u9304\u9678\u9a62\u5442\u92c1\u4fb6\u5c62\u7e37\u616e\u6ffe\u7da0\u5dd2\u6523\u5b7f\u7064\u4e82\u6384\u8f2a\u502b\u4f96\u6dea\u7db8\u8ad6\u863f\u7f85\u908f\u947c\u7c6e\u9a3e\u99f1\u7d61\u5abd\u746a\u78bc\u879e\u99ac\u7f75\u55ce\u8cb7\u9ea5\u8ce3\u9081\u8108\u779e\u9945\u883b\u6eff\u8b3e\u8c93\u9328\u925a\u8cbf\u9ebd\u9ef4\u6c92\u9382\u9580\u60b6\u5011\u9333\u5922\u8b0e\u5f4c\u8993\u7dbf\u7dec\u5edf\u6ec5\u61ab\u95a9\u9cf4\u9298\u8b2c\u8b00\u755d\u9209\u7d0d\u96e3\u6493\u8166\u60f1\u9b27\u9912\u81a9\u6506\u649a\u91c0\u9ce5\u8076\u9f67\u9477\u93b3\u6ab8\u7370\u752f\u64f0\u6fd8\u9215\u7d10\u81bf\u6fc3\u8fb2\u7627\u8afe\u6b50\u9dd7\u6bc6\u5614\u6f1a\u76e4\u9f90\u570b\u611b\u8ce0\u5674\u9d6c\u9a19\u98c4\u983b\u8ca7\u860b\u6191\u8a55\u6f51\u9817\u64b2\u92ea\u6a38\u8b5c\u81cd\u9f4a\u9a0e\u8c48\u5553\u6c23\u68c4\u8a16\u727d\u6261\u91fa\u925b\u9077\u7c3d\u8b19\u9322\u9257\u6f5b\u6dfa\u8b74\u5879\u69cd\u55c6\u7246\u8594\u5f37\u6436\u936c\u6a4b\u55ac\u50d1\u7ff9\u7ac5\u7aca\u6b3d\u89aa\u8f15\u6c2b\u50be\u9803\u8acb\u6176\u74ca\u7aae\u8da8\u5340\u8ec0\u9a45\u9f72\u9874\u6b0a\u52f8\u537b\u9d72\u8b93\u9952\u64fe\u7e5e\u71b1\u97cc\u8a8d\u7d09\u69ae\u7d68\u8edf\u92b3\u958f\u6f64\u7051\u85a9\u9c13\u8cfd\u5098\u55aa\u9a37\u6383\u6f80\u6bba\u7d17\u7be9\u66ec\u9583\u965d\u8d0d\u7e55\u50b7\u8cde\u71d2\u7d39\u8cd2\u651d\u61fe\u8a2d\u7d33\u5be9\u5b38\u814e\u6ef2\u8072\u7e69\u52dd\u8056\u5e2b\u7345\u6fd5\u8a69\u5c4d\u6642\u8755\u5be6\u8b58\u99db\u52e2\u91cb\u98fe\u8996\u8a66\u58fd\u7378\u6a1e\u8f38\u66f8\u8d16\u5c6c\u8853\u6a39\u8c4e\u6578\u5e25\u96d9\u8ab0\u7a05\u9806\u8aaa\u78a9\u720d\u7d72\u98fc\u8073\u616b\u980c\u8a1f\u8aa6\u64fb\u8607\u8a34\u8085\u96d6\u7d8f\u6b72\u5b6b\u640d\u7b4d\u7e2e\u7463\u9396\u737a\u64bb\u64e1\u6524\u8caa\u7671\u7058\u58c7\u8b5a\u8ac7\u6b4e\u6e6f\u71d9\u6fe4\u7e27\u9a30\u8b04\u92bb\u984c\u9ad4\u5c5c\u689d\u8cbc\u9435\u5ef3\u807d\u70f4\u9285\u7d71\u982d\u5716\u5857\u5718\u9839\u86fb\u812b\u9d15\u99b1\u99dd\u6a62\u7aaa\u896a\u5f4e\u7063\u9811\u842c\u7db2\u97cb\u9055\u570d\u7232\u6ff0\u7dad\u8466\u5049\u50de\u7def\u8b02\u885b\u6eab\u805e\u7d0b\u7a69\u554f\u7515\u64be\u8778\u6e26\u7aa9\u55da\u93a2\u70cf\u8aa3\u7121\u856a\u5433\u5862\u9727\u52d9\u8aa4\u932b\u72a7\u8972\u7fd2\u9291\u6232\u7d30\u8766\u8f44\u5cfd\u4fe0\u72f9\u5ec8\u9341\u9bae\u7e96\u9e79\u8ce2\u929c\u9591\u986f\u96aa\u73fe\u737b\u7e23\u9921\u7fa8\u61b2\u7dda\u5ec2\u9472\u9109\u8a73\u97ff\u9805\u856d\u92b7\u66c9\u562f\u880d\u5354\u633e\u651c\u8105\u8ae7\u5beb\u7009\u8b1d\u92c5\u91c1\u8208\u6d36\u93fd\u7e61\u865b\u5653\u9808\u8a31\u7dd2\u7e8c\u8ed2\u61f8\u9078\u766c\u7d62\u5b78\u52f3\u8a62\u5c0b\u99b4\u8a13\u8a0a\u905c\u58d3\u9d09\u9d28\u555e\u4e9e\u8a1d\u95b9\u7159\u9e7d\u56b4\u9854\u95bb\u8c54\u53ad\u786f\u5f65\u8afa\u9a57\u9d26\u694a\u63da\u760d\u967d\u7662\u990a\u6a23\u7464\u6416\u582f\u9059\u7aaf\u8b20\u85e5\u723a\u9801\u696d\u8449\u91ab\u92a5\u9824\u907a\u5100\u5f5c\u87fb\u85dd\u5104\u61b6\u7fa9\u8a63\u8b70\u8abc\u8b6f\u7570\u7e79\u852d\u9670\u9280\u98f2\u6afb\u5b30\u9df9\u61c9\u7e93\u7469\u87a2\u71df\u7192\u8805\u7a4e\u55b2\u64c1\u50ad\u7670\u8e34\u8a60\u6e67\u512a\u6182\u90f5\u923e\u7336\u904a\u8a98\u8f3f\u9b5a\u6f01\u5a1b\u8207\u5dbc\u8a9e\u7c72\u79a6\u7344\u8b7d\u9810\u99ad\u9d1b\u6df5\u8f45\u5712\u54e1\u5713\u7de3\u9060\u9858\u7d04\u8e8d\u9470\u5dbd\u7cb5\u6085\u95b1\u96f2\u9116\u52fb\u9695\u904b\u860a\u919e\u6688\u97fb\u96dc\u707d\u8f09\u6522\u66ab\u8d0a\u8d13\u9ad2\u947f\u68d7\u7ac8\u8cac\u64c7\u5247\u6fa4\u8cca\u8d08\u7d2e\u5284\u8ecb\u9358\u9598\u8a50\u9f4b\u50b5\u6c08\u76de\u65ac\u8f3e\u5d84\u68e7\u6230\u7dbb\u5f35\u6f32\u5e33\u8cec\u8139\u8d99\u87c4\u8f4d\u937a\u9019\u8c9e\u91dd\u5075\u8a3a\u93ae\u9663\u6399\u775c\u7319\u5e40\u912d\u8b49\u7e54\u8077\u57f7\u7d19\u646f\u64f2\u5e5f\u8cea\u937e\u7d42\u7a2e\u816b\u8846\u8b05\u8ef8\u76ba\u665d\u9a5f\u8c6c\u8af8\u8a85\u71ed\u77da\u56d1\u8caf\u9444\u7bc9\u99d0\u5c08\u78da\u8f49\u8cfa\u6a01\u838a\u88dd\u599d\u58ef\u72c0\u9310\u8d05\u589c\u7db4\u8ac4\u6fc1\u8332\u8cc7\u6f2c\u8e64\u7d9c\u7e3d\u7e31\u9112\u8a5b\u7d44\u947d\u7dfb\u9418\u9ebc\u70ba\u96bb\u5147\u6e96\u555f\u95c6\u88e1\u9742\u9918\u934a\u6d29";return function(b){switch(Global.cfg.lang){case"zh_tw":return a(b);default:return b}}}),KISSY.add("cart/utils/tpl/render",function(a,b){function c(c,e,f){var g,h;if(f=f||d,a.isString(c))g=c;else{try{g=c.render(e)}catch(i){h=i}g.match(/KISSY\.Template:[\s\w]*Error\./)?(h=g,a.Config.debug||(g="")):g+=" "}return g&&(g=b(g)),h&&(a.log(f+" render error: "+h+" with data: ","warn"),a.log(e,"dir"),c.parser&&a.log(f+" the template log is :"+c.parser,"warn"),Global.utils.jstracker("[Render] error msg:"+g+c.parser,"render.js",0,"render")),g}var d="[tpl-render] ";return c},{requires:["../lang/lang"]}),KISSY.add("cart/utils/dialog/dialog",function(a,b,c,d){var e,f,g,h=b.all;return{init:function(){},_dialog:function(b,c,f,i,j,k){a.isUndefined(f)&&(f="\u63d0\u793a\u6d88\u606f"),this.destroy(),g=h('<div id="J_CartDialogRef" style="position:fixed;left:50%;top: 50%; width: 1px; height: 1px;"></div>').appendTo("body"),a.use("overlay",function(a,i){e=new i.Dialog({width:374,elCls:"cart-dialog cart-dialog-"+b,headerContent:d(f),bodyContent:d(c||""),footerContent:function(){var a="";switch(b){case"alert":a='<span class="cart-icon icon-warning"></span>';break;case"confirm":a='<a href="javascript:void(0)" class="dialog-btn J_DialogConfirmBtn">\u786e&nbsp;\u5b9a</a><a href="javascript:void(0)" class="dialog-btn dialog-cancel J_DialogCancelBtn">\u5173&nbsp;\u95ed</a>';break;default:a=""}return d(a)}(),mask:!0,closeAction:"hide",align:{points:["cc","cc"]},effect:{target:g,easing:"backOut",duration:.3,effect:"none"},aria:!0}),e.show(),e.on("hide",function(){k&&k(),e.destroy(),g&&g.remove()}),h(e.get("el")).delegate("click",".J_DialogConfirmBtn",function(a){a.preventDefault(),j&&j(),e.destroy(),g&&g.remove()}).delegate("click",".J_DialogCancelBtn",function(a){a.preventDefault(),e.hide()}),e.on("hide",function(){switch(b){case"confirm":k&&k();break;default:j&&j()}})})},confirm:function(a,b,d,e,f){return c.ie<8?(confirm(a)?e&&e():f&&f(),void 0):this._dialog("confirm",a,b,d,e,f)},alert:function(a,b,d,e){return c.ie<8?alert(a):this._dialog("alert",a,b,d,e)},hint:function(a){f&&clearTimeout(f);var b=h("#J_CartSpecialAlert");0===b.length?b=h('<div id="J_CartSpecialAlert" class="special-alert">'+a+"</div>").appendTo("body"):b.html(a);var c=b.width();b.css("margin-left",-c/2),f=setTimeout(function(){h("#J_CartSpecialAlert").remove()},4e3)},destroy:function(){e&&(e.destroy&&e.destroy(),e=null),g&&g.remove()}}},{requires:["node","ua","../tpl/render"]}),KISSY.add("cart/mods/global/data",function(a){var b=window;return{deal:function(c){a.each(c.list,function(c){if(c){var d=c.sellerId,e=b["seller_"+d];d&&e&&(a.mix(c,e,!1),a.isBoolean(e.hasPriceVolume)&&(c.hasPriceVolume=e.hasPriceVolume),!c.title&&c.shopName&&(c.title=c.shopName),c.host=c.host||"C"),a.each(c.bundles,function(c){c&&a.each(c.orders,function(c){if(c){var d=c.itemId+"_"+c.skuId,e=b["item_"+d];d&&e&&a.mix(c,e,!1);var f=b["seller_"+c.sellerId];c.shopId&&f&&(c.seller=f.seller,c.sellerId=f.sellerId,c.shopUrl=f.url,c.shopName=f.shopName)}})})}})},transform:function(b){var c=b.globalData,d=c.page,e=c.bundRela,f={},g={};return e&&e.list&&a.each(e.list,function(b){var c=b.id+"_"+d,e=Global.cartGroups?Global.cartGroups[c]:null;e&&e.checkTpl(b),b.bundles&&b.bundles.length>1?a.each(b.bundles,function(a){f[a]=c}):e&&e.data&&a.each(e.data.bundles,function(a){f[a]=c}),g[c]=b}),a.each(b.list,function(b){var c=f[b.id];c&&(b.id.replace("s_","")+"_"+d===c?(g[c].shopName=b.shopName,g[c].url=b.url,g[c].title=b.title,g[c].host=b.host):a.isUndefined(g[c].host)&&(g[c].host=b.host),b.groupId=c)}),b.groups=g,Global.groupData=Global.groupData||{},a.mix(Global.groupData,g,!0),b}}}),KISSY.add("cart/mods/global/loader",function(a,b,c,d,e,f){function g(b,g){if(d.show(),t>=u)return e.alert("\u8d2d\u7269\u8f66\u52a0\u8f7d\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u91cd\u8bd5"),a.log(m+"max retry times exceeded. exit;"),void 0;a.isEmptyObject(b)&&Global.globalData&&(b={isNext:!0,endTime:Global.globalData.startTime,page:Global.globalData.page+1}),b&&Global.cfg.tpId&&(b.tpId=Global.cfg.tpId);var h=a.now(),i=!0,j=function(b){Global.firstData=null;var c=a.now();if(b.success){b=f.transform(b),e.destroy();var j=b.globalData;j&&-1!==j.totalSize&&(Global.totalSize=j.totalSize,j.totalSize>0&&j.tpId&&1===j.page&&b.list&&0===b.list.length&&Global.empty()),Global.globalData=j||{},Global.globalData.bItemsCount=0,Global.globalData.cItemsCount=0,Global.globalData.bShopsCount=0,Global.globalData.cShopsCount=0,t=0}else t>=u&&e.alert(b.error&&b.error.errorMessage?b.error.errorMessage:"\u8d2d\u7269\u8f66\u52a0\u8f7d\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u91cd\u8bd5"),Global.utils.jstracker("async get my cart returned error: "+(b.error&&b.error.errorCode?b.error.errorCode:"unknown"),"loader.js",0,"getMyCart_return_error"),t++;g&&g(b);var k={result:b.success,renderTime:(a.now()-c)/1e3};i===!0&&(k.ajaxTime=(c-h)/1e3),d.hide(),a.log("[Loader] renderTime: "+k.renderTime),Global.utils.goldlog("cart3-render_time",k)};Global.firstData?(i=!1,setTimeout(function(){f.deal(Global.firstData),j(Global.firstData)},0),a.log("[Loader] use first page data.")):c({data:b,url:Global.cfg.api.loader,dataType:"jsonp",success:j,error:function(){t++,Global.utils.jstracker("async get my cart request error.","loader.js",0,"getMyCart_request_error")}})}function h(){var b=this,c=p.scrollTop();if(!b.__loading&&b.__started){if(c>=q){var d=b.config.diff||200;r&&d+c+p.height()>b.container.outerHeight(!0)&&(a.log("[Loader] loading more~~~"),s.length,i.call(b))}q=c}}function i(){var a=Global.getViewPortPage();this.load({isNext:!0,endTime:a.startTime,page:a.page+1})}function j(b,c){var d=this;if(d.__disable!==!0){if(d.__loading=1,c=c||{},a.isFunction(c)&&(c={success:c}),(!b||a.isEmptyObject(b))&&t>3){var f="async get my cart retried too many times, abort.";return a.log(m+f),Global.utils.jstracker(f,"loader.js",130,"getMyCart_request_error"),void 0}(b&&b.isNext===!1||!s.length)&&(d.config.extraParams&&(b||(b={}),a.mix(b,d.config.extraParams)),g(b,function(b){if(b.success){if(c.success&&c.success(b)===!1)return d.__loading=0,!1;var f=b.globalData,g=f&&!a.isUndefined(f.currentPageSize)?f.currentPageSize:f.totalSize;g>0&&d.config.Cart&&d.config.Cart.render(b.list,b.globalData.page,b.globalData.startTime,b.globalData.endNotEqualTime),(50>g||g===f.totalSize||b.list&&0===b.list.length)&&(r=!1,Global.renderFooter())}else!b.error||"CART_XIAO_ER_CANNOT_BUY"!==b.error.errorCode&&"CART_TMALL_SELLER_CANNOT_BUY"!==b.error.errorCode||(e.alert(b.error&&b.error.errorMessage?b.error.errorMessage:"\u8d2d\u7269\u8f66\u52a0\u8f7d\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u91cd\u8bd5"),d.__disable=!0,Global.empty()),c.error&&c.error(b);return d.__loading=0,c.end&&c.end(b),Global.updateCart({page:b&&b.globalData?b.globalData.page:void 0,type:"load"}),Global.queue.next(),!0}))}}function k(a){var b=this;r=!0,b.config=a,b.container=n(a.container),b.__onScroll=function(){Global.isScrolling=!0,l&&clearTimeout(l),l=setTimeout(function(){Global.isScrolling=!1,h.call(b)},200)},b.load=function(a,c){j.call(b,a,c)},a.firstLoad!==!1&&b.load({},this.config.loadCfg),b.start()}var l,m="[loader] ",n=b.all,o=window,p=n(o),q=0,r=!0,s=[],t=0,u=3;return a.augment(k,{start:function(){!this.__started&&p.on("scroll",this.__onScroll)&&(this.__started=1)},end:function(){p.detach("scroll",this.__onScroll),this.__started=0},isLoading:function(){return 1===this.__loading},disable:function(){this.end(),this.__disable=!0}}),k},{requires:["node","ajax","../../utils/loading/loading","../../utils/dialog/dialog","./data"]}),KISSY.add("cart/mods/order/orderData",function(a){function b(a){a.redemption=!1,a.extraItems&&a.extraItems.length&&(a.redemption=a.extraItems[0],a.redemption.type=a.redemption.type||"award",a.redemption.redemptedNum=a.redemption.totalExtraItemNum-a.redemption.remainExtraItemNum,a.redemption.disabled=0===a.redemption.remainExtraItemNum||0==a.model.totalShopPrice)}return{deal:function(c){c.model=c.model||{},c.model.totalShopPrice=parseFloat(c.model.totalShopPrice)||0,a.each(c.bundles,function(b){c.bundles.length>1&&"shop"===b.type&&(b.title="\u666e\u901a\u5546\u54c1",b.type="normal"),a.each(b.orders,function(b){if(b.model&&b.model.isSelected&&b.isValid){var d=0;b.services&&a.each(b.services,function(a){d+=a.sum}),c.model.totalShopPrice+=parseFloat(d)+parseFloat(b.price.sum)}})}),c.model.totalShopPrice>0&&a.each(c.bundles,function(b){a.each(b.orders,function(a){a.extraItemInfo&&(a.model=a.model||{},a.model.isSelected=!0)})}),b(c);var d=[];return c.scrollPromos&&(a.each(c.scrollPromos,function(a){/<li/.test(a)?d.push(a):d.push("<li>"+a+"</li>")}),c.scrollPromos=d),c.smPostView=c.smPostView&&-1!=c.smPostView.type&&-2!=c.smPostView.type?c.smPostView:"",c.smPostView&&(c.smPostView.priceStr=Global.utils.toMoney(c.smPostView.price),c.smPostView.weightStr=c.smPostView.weight/1e3||0,c.smPostView.priceLevelStr=Global.utils.toMoney(c.smPostView.priceLevel)||""),c.showFooter=c.smPostView||c.promView,c},dealRedemptionData:b}}),KISSY.add("cart/mods/order/tpl/redemption.tpl",function(a,b){var c=(b.all,'<div class="td-chk"></div>{{#if model && model.totalShopPrice && redemption.totalExtraItemNum > redemption.remainExtraItemNum && redemption.type == "award"}}<div class="remain">\u8fd8\u53ef\u6362\u8d2d<em class="J_Remain number">{{redemption.remainExtraItemNum}}</em>\u4ef6\u5546\u54c1</div>{{/if}}<div class="amount"><span class="redemption-count">\u9009\u4e2d\u5546\u54c1\u5408\u8ba1<span class="J_TotalPrice">{{model.totalShopPriceStr}}</span>\u5143\uff0c\u53ef{{#if redemption.type == "freegift"}}\u9886\u53d6{{#else}}\u6362\u8d2d{{/if}}<em class="J_TotalRedemptionAmount number">{{redemption.totalExtraItemNum}}</em>\u4ef6{{#if redemption.type == "freegift"}}\u8d60\u54c1{{#else}}\u5546\u54c1{{/if}}{{#if redemption.type == "freegift"}}{{#if redemption.redemptedNum}}\uff0c\u5df2\u9886\u53d6{{redemption.redemptedNum}}\u4ef6\u8d60\u54c1{{/if}}{{/if}}</span><a class="J_Redemption entry {{#if redemption.disabled}}entry-disabled{{/if}}" href="#" hidefocus="true">{{#if redemption.type == "freegift"}}\u9886\u53d6\u8d60\u54c1{{#else}}\u9a6c\u4e0a\u6362\u8d2d{{/if}}<span class="arrow"></span></a></div>');return{redemptionTip:c,redemption:'{{#if redemption}}<div class="redemption-info"><div class="redemption-tip clearfix">'+c+'</div><div class="redemption-list J_RedemptionList carousel"></div><div class="redemption-sku J_SkuPanel"></div></div>{{/if}}'}},{requires:["node"]}),KISSY.add("cart/mods/order/tpl/order.tpl",function(a,b){var c='<div id="J_BundleList_{{uniqueId}}" class="item-list">{{#if bundles}}{{#each bundles as bundle index}}<div id="J_Bundle_{{#if uniqueId}}{{uniqueId}}_{{index}}{{#else}}{{bundle.id}}{{/if}}" class="bundle {{#if index === bundles.length - 1}} bundle-last {{/if}}">{{#if bundle.orders}}{{#each bundle.orders as item}}<div id="J_ItemHolder_{{item.cartId}}"></div>{{/each}}{{/if}}</div>{{/each}}{{/if}}</div>',d='{{#if hasPriceVolume}}<span class="shop-coupon-trigger J_MyShopCoupon"><em>\u4f18\u60e0\u5238</em><span class="arrow"></span></span>{{/if}}',e='{{#if isGoldSeller}}<span class="icon-golden-seller" title="\u91d1\u724c\u5356\u5bb6"></span>{{/if}}',f='{{#if smPostView}}<div class="redemption-info sm-post-view"><div class="redemption-tip clearfix"><div class="amount">{{#if promView}}{{promView.title}}{{#if smPostView}}\uff0c{{/if}}{{/if}}{{#if smPostView}}{{#if smPostView.type == 1}}{{#if smPostView.priceLevelStr}}<span>\u4eab\u6ee1{{smPostView.priceLevelStr}}\u5143{{#if smPostView.weightStr}}\uff08{{smPostView.weightStr}}kg\u4ee5\u5185\uff09{{/if}}\u5305\u90ae</span>{{#else}}<span>\u60a8\u5df2\u4eab\u53d7\u514d\u8fd0\u8d39\u4f18\u60e0</span>{{/if}}{{#elseif smPostView.type == 0}}<span>\u518d\u4e70{{smPostView.priceStr}}\u5143{{#if smPostView.weightStr}}\uff08\u603b\u91cd\u5c0f\u4e8e{{smPostView.weightStr}}kg\uff09{{/if}}\u53ef\u514d\u8fd0\u8d39</span><a href="http://chaoshi.tmall.com" target="_blank">\u9a6c\u4e0a\u53bb\u51d1\u5355</a>{{/if}}{{/if}}</div></div></div>{{/if}}';return{normal:'<div id="J_Order_{{uniqueId}}" class="J_Order clearfix order-body {{#if extraItem}}order-redemption{{/if}} {{#if isValid === false}} order-invalid {{/if}}"><div class="J_ItemHead shop clearfix"><div class="shop-info">{{#if isValid}}<div class="cart-checkbox {{#if model && model.isChecked}}cart-checkbox-checked{{/if}}"><input class="J_CheckBoxShop" id="J_CheckShop_{{uniqueId}}" type="checkbox" name="orders[]" value="{{uniqueId}}" {{#if model && model.isChecked}}checked{{/if}} /><label for="J_CheckShop_{{uniqueId}}">\u52fe\u9009\u6b64\u5e97\u94fa\u4e0b\u6240\u6709\u5546\u54c1</label></div>&nbsp;&nbsp;{{/if}}{{#if host != "C"}}<span class="shop-icon icon-{{host}}"></span>{{/if}}'+e+'{{#if title}}\u5e97\u94fa\uff1a<a href="{{url}}" target="_blank" title="{{title}}" class="J_MakePoint" data-point="tbcart.8.15">{{title}}</a>{{#elseif seller}}\u5356\u5bb6\uff1a<a href="{{url}}" target="_blank" title="{{seller}}" class="J_MakePoint" data-point="tbcart.8.15">{{seller}}</a>{{/if}}{{#if host !== "SM" && host !== "LG"}}{{#if seller}}<span class="J_WangWang" data-items="{{uniqueId}}" data-icon="small" data-nick="{{seller}}" data-display="inline"></span>{{/if}}{{/if}}'+d+'</div>{{#if scrollPromos}}<div class="order-promo-info"><div class="scrolling-container"><ul class="scrolling-promo-hint J_ScrollingPromoHint">{{#each scrollPromos as promo}}{{promo}}{{/each}}</ul></div></div>{{/if}}</div><div class="order-content">'+c+b.redemption+f+"</div></div>",combo:'{{#if groupId}}<div id="J_Order_{{uniqueId}}" class="J_Order clearfix order-body combo-order J_Combo {{#if isValid === false}} order-invalid {{/if}}"><div class="combo-main"><div class="td-chk combo-chk">{{#if isValid}}<div class="cart-checkbox {{#if model && model.isChecked}}cart-checkbox-checked{{/if}}"><input class="J_CheckBoxShop" id="J_CheckShop_{{uniqueId}}" type="checkbox" name="orders[]" value="{{uniqueId}}" {{#if model && model.isChecked}}checked{{/if}} /><label for="J_CheckShop_{{uniqueId}}">\u52fe\u9009\u6b64\u5957\u9910</label></div>{{#else}}<span class="act-status icon-invalid">\u5931\u6548</span>{{/if}}</div><div class="combo-list">'+c+'</div><div class="td-op combo-op"><div class="td-inner"><a href="javascript:;" class="J_ComboDel J_MakePoint">\u5220\u9664</a></div></div></div></div>{{#else}}<div id="J_Order_{{uniqueId}}" class="J_Order clearfix order-body combo-order J_Combo {{#if isValid === false}} order-invalid {{/if}}"><div class="J_ItemHead shop clearfix"><div class="shop-info">{{#if isValid}}<div class="cart-checkbox {{#if model && model.isChecked}}cart-checkbox-checked{{/if}}"><input class="J_CheckBoxShop" id="J_CheckShop_{{uniqueId}}" type="checkbox" name="orders[]" value="{{uniqueId}}" {{#if model && model.isChecked}}checked{{/if}} /><label for="J_CheckShop_{{uniqueId}}">\u52fe\u9009\u6b64\u5957\u9910</label></div>{{#else}}<span class="act-status">\u5957\u9910\u5df2\u5931\u6548</span>{{/if}}&nbsp;&nbsp;{{#if host != "C"}}<span class="icon-{{host}}"></span>{{/if}}'+e+'<span class="act-name" title="{{title}}">\u5957\u9910\uff1a{{title}}</span>'+d+'</div></div><div class="order-content clearfix">'+c+'<div class="td-op combo-order-op" style="height: {{comboHeight}}px;"><div class="vl"><div class="vl-wp"><div class="vl-cn"><a href="javascript:;" class="J_ComboDel J_MakePoint">\u5220\u9664</a></div></div></div></div>'+f+"</div></div>{{/if}}",act:'<div id="J_Order_{{uniqueId}}" class="J_Order clearfix order-body cross-shop-act J_CrossShopAct {{#if isValid === false}} order-invalid {{/if}}"><div class="J_ItemHead shop clearfix {{#if !isValid}} disable{{/if}}"><div class="shop-info">{{#if isValid}}<div class="cart-checkbox {{#if model && model.isChecked}}cart-checkbox-checked{{/if}}"><input class="J_CheckBoxShop" id="J_CheckShop_{{uniqueId}}" type="checkbox" name="orders[]" value="{{uniqueId}}" {{#if model && model.isChecked}}checked{{/if}} /><label for="J_CheckShop_{{uniqueId}}">\u52fe\u9009\u6b64\u6d3b\u52a8\u4e0b\u6240\u6709\u5546\u54c1</label></div>&nbsp;&nbsp;{{#else}}<span class="act-status">\u6d3b\u52a8\u5df2\u5931\u6548</span>{{/if}}<a href="{{url}}" class="act-name J_MakePoint" data-point="tbcart.8.15" target="_blank" title="{{title}}">\u6d3b\u52a8\uff1a{{title}}</a>'+d+'</div>{{#if scrollPromos}}{{#if scrollPromos.length}}<div class="act-promo"><div class="act-promo-wrapper"><ul class="act-promo-hint J_ScrollingPromoHint">{{#each scrollPromos as campaignPlan}}{{#if campaignPlan}}{{campaignPlan}}{{/if}}{{/each}}</ul></div></div>{{/if}}{{/if}}</div><div class="order-content">'+c+'{{#if gradeMessage}}<div class="act-saveinfo"><div class="msg"><p class="naked tips">{{gradeMessage}}</p></div></div>{{/if}}</div></div>'}},{requires:["./redemption.tpl"]}),KISSY.add("cart/mods/order/orderTPL",function(a,b,c,d,e,f,g){var h=b.all,i="[Template] order render ",j={};return{generate:function(b){var c;if(b){var g=b.type&&f[b.type]?b.type:"normal";j[g]=j[g]||d(f[g]),c=e(j[g],b,i)}else a.log(i+"error: order data cannot be recognized.");return c},render:function(b){var c=this.generate(b),d="J_OrderHolder_"+b.uniqueId,e=h("#"+d);return e&&0!==e.length?e.html(c):(a.log(i+"cannot find order holder for order:"+b.id),e=h('<div id="'+d+'"></div>').html(c).appendTo("#J_OrderList")),a.log(i+"order "+b.id+" rendered."),e},renderRedemption:function(a){var b="J_OrderHolder_"+a.uniqueId,c=h("#"+b);if(c&&c.length){var f=h(".redemption-info",c);if(f&&f.length){j.redemptionTip||(j.redemptionTip=d(g.redemptionTip));var k=e(j.redemptionTip,a,i);f.one(".redemption-tip").html(k)}}}}},{requires:["node","ua","gallery/template/1.0/","../../utils/tpl/render","./tpl/order.tpl","./tpl/redemption.tpl"]}),KISSY.add("cart/mods/bundle/tpl/bundle.tpl",function(){var a='<div id="J_ItemList_{{id}}" class="item-list">{{#if items}}{{#each items as item}}<div id="J_ItemHolder_{{item.cartId}}"></div>{{/each}}{{/if}}</div>',b={act:'{{#if title}}<div class="bundle-hd"><div class="td-chk"></div><div class="bd-title">{{title}}<i class="icon-bd-title"></i></div><div class="bd-promos">{{#if promos}}{{#if promos.length}}<div class="bd-has-promo">\u5df2\u4eab\u4f18\u60e0\uff1a{{#each promos as promo}}{{#if promo}}<span class="bd-has-promo-content">{{promo}}</span>&nbsp;&nbsp;{{/if}}{{/each}}</div>{{/if}}{{/if}}{{#if gradeMessage}}<div class="bd-tips"><a href="{{url}}" target="_blank">{{gradeMessage}}&nbsp;<span class="gt">&gt;&gt;</span></a></div>{{/if}}{{#if scrollPromos}}<div class="act-promo"><div class="act-promo-wrapper"><ul class="act-promo-hint J_ScrollingPromoHint">{{#each scrollPromos as promo}}{{#if promo}}<li>{{promo}}</li>{{/if}}{{/each}}</div></div>{{/if}}</div></div>{{/if}}<div class="bundle-main">'+a+"</div>"};return b.normal=b.act,b}),KISSY.add("cart/mods/bundle/bundleTPL",function(a,b,c,d,e){var f=b.all,g="[Template] bundle render ",h={};return{generate:function(b){var c;return b?(b.type&&e[b.type]||(b.type="normal"),a.log(g+"info: start for bundle:"+b.id+". The bundle type is "+b.type),c=e[b.type]):a.log(g+"error: bundle data cannot be recognized."),c},render:function(a){var b=f("#J_Bundle_"+a.uniqueId);return a.type&&e[a.type]&&(h[a.type]||(h[a.type]=c(e[a.type])),b.html(d(h[a.type],a,g))),b}}},{requires:["node","gallery/template/1.0/","../../utils/tpl/render","./tpl/bundle.tpl"]}),KISSY.add("cart/mods/item/promoTip/promo-logo-map",function(){return{laba:{url:"http://gtms01.alicdn.com/tps/i1/T1N9lAFsBXXXXE4m2q-90-16.png",tips:"\u814a\u516b\u5e74\u8d27\u8282",extra:{2:{title:"\u3010\u814a\u516b\u5e74\u8d27\u8282\u3011"}}},"5zhe":{url:"http://gtms01.alicdn.com/tps/i1/T1XOlxFudfXXa9fH_f-38-16.png",tips:"5\u6298"},nmqc:{url:"http://gtms01.alicdn.com/tps/i1/T1iWFhFvNiXXafW0zi-53-16.png",tips:"\u5e74\u672b\u6e05\u4ed3"}}}),KISSY.add("cart/mods/item/promoTip/promoTitleMap",function(){var a={groupingp:"\u5e97\u94fa\u4fc3\u9500",shopvip:"\u5e97\u94fa VIP",tbvip:"VIP",limitp:"\u9650\u65f6\u6298\u6263",cartp:"\u4e13\u5c5e\u4f18\u60e0",jhs:"\u805a\u5212\u7b97",activityp:"\u5356\u5bb6\u4fc3\u9500",other:"\u5176\u5b83\u4f18\u60e0",official:"\u5356\u5bb6\u4fc3\u9500",nonofficial:"\u5929\u732b\u4fc3\u9500",down:"5\u6298",preOfficial:"10\u6708\u72c2\u6b22\u8282",preDown:"5\u6298",mjhg:"\u6362\u8d2d\u4f18\u60e0","default":"\u5356\u5bb6\u4fc3\u9500",Tmall$tmallAllPointPromotion:"\u79ef\u5206\u62b5\u6263"};return function(b){return a[b]||(b="default"),a[b]}}),KISSY.add("cart/mods/item/icons/icon-map",function(a,b){b.all;return{"http://a.tbcdn.cn/tbsp/icon/xiaobao/a_quality_item_16x16.png":"http://gtms04.alicdn.com/tps/i4/T1JnMdFQFXXXaSQP_X-16-16.png","http://img04.taobaocdn.com/tps/i4/T1ZUaWXctlXXXXXXXX-16-16.gif":"","http://img03.taobaocdn.com/tps/i5/T1Z5hvXfpHXXXXXXXX-16-16.png":"","http://img07.taobaocdn.com/tps/i7/T1g9BqXoJfXXXXXXXX-16-16.png":"","http://img01.taobaocdn.com/tps/i1/T1Ek1gXfRtXXXXXXXX-16-16.gif":"","http://img01.taobaocdn.com/tps/i4/T1_ZFuXi4jXXXXXXXX-16-16.png":"","http://img01.taobaocdn.com/tps/i1/T1svydXBpfXXa46z6X-16-13.png":"http://gtms03.alicdn.com/tps/i3/TB1dtEWFVXXXXXwaXXXAz6UFXXX-16-16.png","http://a.tbcdn.cn/sys/common/icon/trade/item_cod.png":"http://gtms03.alicdn.com/tps/i3/TB1dtEWFVXXXXXwaXXXAz6UFXXX-16-16.png","http://assets.taobaocdn.com/sys/common/icon/trade/xcard.png":"http://gtms02.alicdn.com/tps/i2/T1uxT.FIXaXXaSQP_X-16-16.png","http://a.tbcdn.cn/sys/common/icon/trade/xcard.png":"http://gtms02.alicdn.com/tps/i2/T1uxT.FIXaXXaSQP_X-16-16.png","http://gtms03.alicdn.com/tps/i3/T1yE9QFyNhXXaSQP_X-16-16.png":"http://gtms01.alicdn.com/tps/i1/T1phr.FGRbXXaSQP_X-16-16.png","http://a.tbcdn.cn/tbsp/icon/xiaobao/a_7-day_return_16x16.png":"http://gtms01.alicdn.com/tps/i1/T1phr.FGRbXXaSQP_X-16-16.png","http://img03.taobaocdn.com/tps/i3/T17hHwXktgXXaHNz_X-16-16.gif":"","http://img01.taobaocdn.com/tps/i1/T1501KXiBuXXXXXXXX-18-18.png":"http://gtms01.alicdn.com/tps/i1/T18k.aFIpaXXaSQP_X-16-16.png","http://img03.taobaocdn.com/tps/i3/T1bnR4XEBhXXcQVo..-14-16.png":"http://gtms04.alicdn.com/tps/i4/T1yaEeFIJXXXaSQP_X-16-16.png","http://a.tbcdn.cn/tbsp/icon/xiaobao/a_true_description_16x16.png":"http://gtms04.alicdn.com/tps/i4/T1yaEeFIJXXXaSQP_X-16-16.png","http://img03.taobaocdn.com/tps/i3/T1DoWeXzpbXXcQVo..-14-16.png":"http://gtms02.alicdn.com/tps/i2/T1RNAdFJ8XXXaSQP_X-16-16.png","http://a.tbcdn.cn/tbsp/icon/xiaobao/an_authentic_item_16x16.png":"http://gtms02.alicdn.com/tps/i2/T1RNAdFJ8XXXaSQP_X-16-16.png","http://img02.taobaocdn.com/tps/i2/T18rKdXARfXXcQVo..-14-16.png":"http://gtms04.alicdn.com/tps/i4/T1ZUocFOFXXXaSQP_X-16-16.png","http://img04.taobaocdn.com/tps/i4/T1tZ5fXCRaXXadE...-14-15.png":"","http://img02.taobaocdn.com/tps/i2/T1wMedXqFfXXbRS1DX-15-16.png":"http://gtms01.alicdn.com/tps/i1/T1DpMcFIVaXXaSQP_X-16-16.png","http://img01.taobaocdn.com/tps/i1/T1blOeXCxbXXbCoE..-14-14.png":"","http://img04.taobaocdn.com/tps/i4/T1tPwAXeXeXXbPtI6h-47-14.gif":"http://gtms03.alicdn.com/tps/i3/T1e9cXFFhaXXaSQP_X-16-16.png"}},{requires:["node"]}),KISSY.add("cart/mods/item/itemData",function(a,b,c,d){function e(b){return b.price.serviceTotal=0,a.each(b.services,function(a,c){b.price.serviceTotal+=b.services[c].sum,b.services[c].collapseShow=4>c,b.services[c].price_str=parseFloat(b.services[c].price/100).toFixed(2),b.services[c].sum_str=parseFloat(b.services[c].sum/100).toFixed(2)}),b.price.serviceTotal=parseFloat(b.price.serviceTotal/100).toFixed(2),b}function f(b){return b.itemIcon&&(b._icons=[],b._iconAlias=[],a.each(b.itemIcon,function(c){a.each(c,function(a){b._icons.push(a)})}),b._icons.length&&a.each(b._icons,function(a){a&&a.img&&d[a.img]&&(a.img=d[a.img]),a.alias&&b._iconAlias.push(a.alias)})),b}function g(b){if(b.prePromos&&(0===b.prePromos.price&&!b.prePromos.hiddenPrice||b.prePromos.price>=b.price.now)&&(b.prePromos=null),b.prePromos){b.promotions=a.clone(b.prePromos),b.promotions.type="pre-promo",b.promotions.name="12.12\u4ef7",b.promotions.priceStr=0===b.prePromos.price?b.prePromos.hiddenPrice.replace(/\uff1f/g,"?"):Global.utils.toMoney(b.promotions.price),b.promotions.saved=0;var d=b.price.oriPromo-b.promotions.price;d>0&&(b.promotions.specialContent="12.12\u5f53\u5929\u6bd4\u52a0\u5165\u8d2d\u7269\u8f66\u65f6\u53c8\u4f18\u60e0\u4e86"+Global.utils.toMoney(d)+"\u5143"),b.prePromos.hiddenPrice&&0===b.prePromos.price&&(b.promotions.showTip=!1)}else{var e=!1;b.promos&&b.promos.length&&a.each(b.promos,function(d){d&&d.length&&a.each(d,function(a){1!==a.type&&"promo"!==a.type||e!==!1||(e=!0,b.promotions=a,b.promotions.type="promo",b.promotions.name=c(b.promotions.style),b.promotions.saved=b.price.save)})}),e===!1&&b.price.save&&(b.promotions={type:"seller",saved:b.price.save,name:"\u5356\u5bb6\u964d\u4ef7",title:"\u5356\u5bb6\u964d\u4ef7"})}var f=b.cartActiveInfo;if(f){if(f.isDefault===!0&&1!==f.wantStatus&&!b.prePromos){var g=b.price.descend||b.price.save;a.mix(b.promotions,{type:1!==f.type||g?"seller":"special",saved:g,name:f.name||"\u5356\u5bb6\u964d\u4ef7",desc:f.slogan,content:f.content||"",activityType:f.type,except:f.except||""})}b.askPromo={open:f.isDefault===!1&&0!==f.wantStatus,asked:1===f.wantStatus}}return b.promotions?(f&&(b.promotions.endTime=f.endTime),b.price.oriPromo>b.price.now&&"pre-promo"!==b.promotions.type&&(b.promotions.diff=b.price.oriPromo-b.price.now),b.promotions.diff&&"promo"===b.promotions.type&&(b.promotions.type="seller",b.promotions.name="\u5356\u5bb6\u964d\u4ef7"),b.promotions.period=l,b.promotions.hideTitle=1===l&&b.promotions.logos&&b.promotions.logos.length||!b.promotions.title,l>1&&(b.promotions.logos=[]),b.promotions.content=b.promotions.content||"",b.promotions.usedPoint=b.promotions.usedPoint||0):b.promotions={},b}function h(c){return c.promoLogos=[],c.promoPriceLogos=[],c.logo&&a.each(c.logo,function(d){if(!a.isObject(d)||c.promoCoupons&&"http://gtms03.alicdn.com/tps/i3/TB1jNHhGFXXXXc2XVXXLqEnIVXX-78-16.png"===d.url){d+="";var e=d.split("_");if(e&&e[0]&&b[e[0]]){var f=b[e[0]];if(e[1]&&"2"!=e[1]?c.promoLogos.push(f):c.promoPriceLogos.push(f),f.extra&&e[1]&&f.extra[e[1]]){var g=f.extra[e[1]];g&&g.title&&(c.title=g.title+c.title.replace(g.title,""))}}}else 2===d.pos?c.promoPriceLogos.push(d):c.promoLogos.push(d)}),0===c.promoLogos.length&&(c.promoLogos=!1),0===c.promoPriceLogos.length&&(c.promoPriceLogos=!1),c}function i(a){a.weightStr="",a.weight>0&&(a.weightStr="("+a.weight*a.amount.now/1e3+"kg)")}function j(a){var b=!1,c=new Date;a.isDouble11===!0&&a.leafCategory>0&&2>l&&(a.isValid===!1?b=!0:a.amount.max<=3&&c.getDate()>=5&&(b=!0)),a._showRelative=b}function k(b){return b.promoCoupons=[],b.promos&&b.promos.length&&a.each(b.promos,function(c){c&&c.length&&a.each(c,function(a){2===a.type&&b.promoCoupons.push(a)})}),b.promoCoupons.length||(b.promoCoupons=!1),b}var l=parseInt(Global.cfg.period,10);return{deal:function(b){return b.model=b.model||{},b.randomNum=+new Date,b.period=l,b.pic=b.pic?b.pic.replace(/_(sum|\d{2,5}x\d{2,5})\.jpg$/,""):"",b.shopName=b.shopName?a.escapeHTML(b.shopName.replace("\\u","")):void 0,a.each(b.price,function(a,c){b.price[c+"_str"]=parseFloat(a/100).toFixed(2)}),b.skuStatus=b.skuStatus||0,e(b),f(b),g(b),k(b),h(b),i(b),j(b),b}}},{requires:["./promoTip/promo-logo-map","./promoTip/promoTitleMap","./icons/icon-map"]}),KISSY.add("cart/mods/item/tpl/item.tpl",function(){var a=(parseInt(Global.cfg.period,10),"http://a.tbcdn.cn/s.gif"),b='{{#if icon.link}}<a href="{{icon.link}}" target="_blank" class="item-icon item-icon-{{index}} J_MakePoint" data-point="tbcart.8.26" title="{{icon.title}}"><img src="{{icon.img}}" alt="{{icon.name}}" /></a>{{#else}}<span class="item-icon item-icon-{{index}}" title="{{icon.title}}"><img src="{{icon.img}}" alt="{{icon.name}}" /></span>{{/if}}',c={checkbox:'{{#if isValid}}{{#if type === "combo" || orderType === "combo"}}{{#elseif type == "redemption"}}<em class="item-label label-{{extraItemInfo.type}}">{{#if extraItemInfo.type == "freegift"}}\u8d60\u54c1{{#else}}\u6362\u8d2d{{/if}}</em>{{#else}}<div class="cart-checkbox {{#if model && model.isSelected}}cart-checkbox-checked{{/if}}"><input class="J_CheckBoxItem" id="J_CheckBox_{{cartId}}" type="checkbox" name="items[]" value="{{cartId}}" {{#if model && model.isSelected}}checked{{/if}} /><label for="J_CheckBox_{{cartId}}">\u52fe\u9009\u5546\u54c1</label></div>{{/if}}{{#elseif type === "ju11"}}<a class="icon-ju11" title="\u8be5\u5546\u54c1\u4e3a\u805a\u5212\u7b97\u5b9d\u8d1d\uff0c\u76ee\u524d\u6b63\u5728\u9884\u70ed\uff0c\u663e\u793a\u5546\u54c1\u539f\u4ef7\uff0c\u6682\u65f6\u65e0\u6cd5\u8d2d\u4e70\uff0c\u5f00\u56e2\u540e\u53ef\u6062\u590d\u6b63\u5e38\u8d2d\u4e70\uff01" href="javascript: void(0);">\u805a\u5212\u7b97</a>{{#else}}<a class="item-label label-invalid" title="\u5546\u54c1\u88ab\u4e0b\u67b6\u3001\u5220\u9664\u3001\u5e93\u5b58\u4e0d\u8db3\uff0c\u6216\u5546\u5bb6\u5904\u4e8e\u88ab\u76d1\u7ba1\u6216\u51bb\u7ed3\u72b6\u6001" target="_blank" href="http://service.taobao.com/support/knowledge-1116245.htm">\u5931\u6548</a>{{/if}}',itemInfo:{itemPic:'<div class="item-pic J_ItemPic"><a href="{{url}}" target="_blank" title="{{title}}" class="J_MakePoint" data-point="tbcart.8.12">{{#if pic == ""}}<img src="http://a.tbcdn.cn/app/tc/img/nopic_s50.gif" alt="{{title}}" class="itempic J_ItemImg" />{{#else}}<img src="'+a+'" lazyload="{{pic}}_80x80.jpg" class="itempic J_ItemImg" />{{/if}}</a></div>',itemTitle:'<a href="{{url}}" target="_blank" title="{{title}}" class="item-title J_MakePoint" data-point="tbcart.8.11" />{{title}}</a>',itemTry:'{{#if trial}}<a title="\u8bd5\u7528\u670d\u52a1\uff1a{{trial.message}}"><img class="itemicon" src="http://img04.taobaocdn.com/tps/i4/T1ZUaWXctlXXXXXXXX-16-16.gif"/></a>{{/if}}',itemIcons:'{{#if _icons}}<div class="item-icon-list clearfix"><div class="item-icons J_ItemIcons {{#if _collapseIcons}} item-icons-collapse {{#else}} item-icons-fixed {{/if}}">{{#each _icons as icon index}}'+b+'{{/each}}{{#if _collapseIcons}}<span class="more">\u66f4\u591a<span class="arrow"></span></span>{{/if}}</div></div>{{/if}}',itemProps:'{{#if skus}}<div class="item-props">{{#each skus as value name}}<span>{{name}}: {{value}}</span>{{/each}}</div>{{/if}}',itemXiaoBao:'{{#if xb && xb.length}}<div class="xb"><span>\u4fdd\u969c: </span>{{#each xb as icon}}{{ICONS_MAP[icon]}}{{/each}}</div>{{/if}}',itemShopInfo:'{{#if host !== "SM"}}{{#if type == "combo" || type == "campaign" || orderType == "act" || orderType == "combo"}}<div class="shop-info">{{#if shopName}}<a title="{{shopName}}" class="shop-title J_MakePoint" data-point="tbcart.8.15" target="_blank" href="{{shopUrl}}">{{shopName}}</a>{{/if}}{{#if host != "C"}}<span class="host-icon icon-{{host}}"></span>{{/if}}<span class="J_WangWang" data-icon="small" data-nick="{{seller}}" data-display="inline"></span></div>{{/if}}{{/if}}',itemLogos:'<div class="promo-logos">{{#if promoLogos}}{{#each promoLogos as logo}}<p class="promo-logo">{{#if logo.link}}<a href="{{logo.link}}" target="_blank" title="{{logo.tips}}">{{/if}}<img src="{{logo.url}}" alt="{{logo.tips}}" title="{{logo.tips}}" />{{#if logo.link}}</a>{{/if}}</p>{{/each}}{{/if}}{{#if promoCoupons}}{{#each promoCoupons as coupon}}<p class="promo-logo"><span class="tbc-double-12-label" data-type="coupon" data-value="{{coupon.usedPoint}}"></span></p>{{/each}}{{/if}}</div>'},services:'{{#if services}}<div class="item-services-hr"><div class="td td-chk"></div><div class="td td-item"><div class="item-info"></div></div><div class="td td-info"></div><div class="td td-price"></div><div class="td td-amount"></div><div class="td td-sum"></div><div class="td td-op"></div></div><div class="item-services {{#if model && model.serviceCollapsed !== false}} services-collapsed {{/if}}"><div class="td-chk"></div><div class="service-wp"><a class="service-header J_ToggleSerivces" href="javascript:void(0);">\u552e\u540e\u670d\u52a1<span class="arrow"></span></a><ul class="services-list">{{#each services as service}}<li class="service-list {{#if service.collapseShow}}collapse-show{{/if}}"><div class="td td-item"><div class="item-info" style="background-image: url({{service.icon}})"><a class="service-title J_MakePoint" href="{{service.url}}" data-point="tbcart.8.27" target="_blank">{{service.title}}</a></div></div><div class="td td-info"></div><div class="td td-price"><div class="td-inner"><span class="price">{{#if service.promo}}{{service.promo}}{{#else}}{{service.price_str}}{{/if}}</span></div></div><div class="td td-amount"><div class="td-inner"><span class="number">{{service.quantity}}</span></div></div><div class="td td-sum"><div class="td-inner"><span class="price">{{service.sum_str}}</span></div></div></li>{{/each}}</ul></div><div class="td-op"></div><div class="service-total td-sum"><div class="td-inner"><span class="price">{{price.serviceTotal}}</span></div></div></div>{{/if}}',info:'<div class="item-props {{#if skuStatus === 2}}item-props-can{{#elseif skuStatus === 1}}item-add-props{{/if}}">{{#if skus}}{{#each skus as value name}}<p class="sku-line" tabindex="0">{{name}}\uff1a{{value}}</p>{{/each}}{{/if}}{{#if skuStatus === 2}}<span tabindex="0" class="btn-edit-sku J_BtnEditSKU J_MakePoint" data-point="tbcart.8.10">\u4fee\u6539</span>{{#elseif skuStatus === 1}}<a tabindex="0" title="\u9009\u62e9\u5546\u54c1\u4fe1\u606f" href="javascript:void(0);" class="cart-btn-white btn-select-sku J_AddSkuBtn J_MakePoint" data-point="tbcart.8.13">\u9009\u62e9\u5546\u54c1\u4fe1\u606f</a>{{/if}}</div>',price:'<div class="item-price price-promo-{{promotions.type}}"><div class="price-content">{{#if price.now < price.origin}}<div class="price-line"><em class="price-original">{{price.origin_str}}</em></div>{{/if}}<div class="price-line"><em class="J_Price price-now" tabindex="0">{{price.now_str}}</em></div></div>{{#if isValid}}{{#if promotions && promotions.type}}{{#if promotions.type === "pre-promo"}}<div class="pre-promos {{#if promotions.showTip === false}}{{#else}}J_ItemPromotions{{/if}}"><div class="promo-price"><em>{{prePromos.priceStr}}</em><span class="arrow"></span></div></div>{{#else}}{{#if promotions.hideTitle === false}}<div class="promo-main promo-{{promotions.type}}"><div class="promo-content {{#if promotions.endTime}} promo-limited {{/if}} {{#if promotions.style}}promo-{{promotions.style}}{{/if}} J_ItemPromotions">{{#if promotions.endTime}}<span class="icon-time"></span>{{/if}}{{promotions.name}}{{#if promotions.name}}<span class="arrow"></span>{{/if}}</div></div>{{/if}}{{#if promotions.logos && promotions.logos.length}}<div class="promo-logos J_PromoLogos" {{#if promotions.period === 0}} style="display:none" {{/if}}>{{#each promotions.logos as logo}}<p class="promo-logo"><img src="{{logo.logoUrl}}" alt="{{logo.tips}}" title="{{logo.tips}}" /></p>{{/each}}</div>{{/if}}{{/if}}{{/if}}{{#if askPromo}}{{#if askPromo.open === true}}<div class="ask-promo"><a class="promo-ask-btn J_AskPromotion">{{#if askPromo.asked === true}}\u5df2{{/if}}\u6c42\u4f18\u60e0</a></div>{{/if}}{{/if}}{{/if}}{{#if promoPriceLogos}}<div class="promo-logos">{{#each promoPriceLogos as logo}}<p class="promo-logo">{{#if logo.link}}<a href="{{logo.link}}" target="_blank" title="{{logo.tips}}">{{/if}}<img src="{{logo.url}}" alt="{{logo.tips}}" title="{{logo.tips}}" />{{#if logo.link}}</a>{{/if}}</p>{{/each}}</div>{{/if}}</div>',amount:'<div class="amount-wrapper {{#if amount.multiple > 1 || amount.max < 1 || amount.max < amount.now || amount.limit <= amount.max || amount.max <= 3 || amount.supply < amount.demand}}amount-has-error{{/if}}">{{#if type == "combo" || type == "redemption" || orderType == "combo"}}<div class="item-static-amount">{{amount.now}}</div>{{#else}}<div class="item-amount {{#if isValid && amount.max <= 3 && type == "redemption"}} s-lack {{/if}}">{{#if isValid && type !== "redemption"}}<input type="text" value="{{amount.now}}" class="text text-amount J_ItemAmount" data-max="{{amount.max}}" data-now="{{amount.now}}" autocomplete="off" />{{#else}}{{amount.now}}{{/if}}</div>{{#if isValid}}<div class="amount-msg J_AmountMsg">{{#if amount.multiple > 1}}<em class="s-amount-tip">\u4ec5\u652f\u6301{{amount.multiple}}\u500d\u8d2d\u4e70</em>{{/if}}{{#if amount.max < 1}}<em class="error-msg">\u8be5\u5b9d\u8d1d\u5e93\u5b58\u4e0d\u8db3,\u8bf7\u8054\u7cfb\u5356\u5bb6</em>{{#elseif amount.max < amount.now}}<em class="error-msg">\u6700\u591a\u53ea\u80fd\u8d2d\u4e70{{amount.max}}\u4ef6</em>{{#elseif amount.limit <= amount.max}}<em class="s-danger-text">\u9650\u8d2d{{amount.limit}}\u4ef6</em>{{#elseif amount.max <= 3}}<em class="s-danger-text" title="\u8be5\u5546\u54c1\u53ea\u6709{{amount.max}}\u4ef6\u4e86\u54e6\uff0c\u8981\u4e70\u7684\u8d76\u7d27\u554a">\u5e93\u5b58\u7d27\u5f20</em>{{#elseif amount.supply < amount.demand}}<em class="error-msg" title="\u8be5\u5546\u54c1\u53ea\u6709{{amount.supply}}\u4ef6\u4e86\u54e6\uff0c\u4f46\u662f\u6709{{amount.demand}}\u4eba\u5df2\u7ecf\u52a0\u5165\u8d2d\u7269\u8f66\u6253\u7b97\u8d2d\u4e70">\u5e93\u5b58\u7d27\u5f20</em>{{/if}}</div>{{/if}}{{/if}}</div>',total:'<em tabindex="0" class="J_ItemSum number">{{price.sum_str}}</em><div class="J_ItemLottery"></div>{{#if weightStr}}<div class="weight">{{weightStr}}</div>{{/if}}',operations:'{{#if _showRelative}}<a  title="\u67e5\u770b\u540c\u7c7b\u5b9d\u8d1d"  class="btn-show-relative J_MakePoint" href="http://www.tmall.com/go/market/brand/worth.php?from=cart&invalidItems={{itemId}}_{{sellerId}}_{{leafCategory}}" target="_blank" data-point="tbcart.8.42">\u67e5\u770b\u540c\u7c7b\u5b9d\u8d1d</a>{{/if}}<a  title="\u79fb\u81f3\u6536\u85cf\u5939"  class="btn-fav J_Fav J_MakePoint"  data-point-url="http://www.atpanel.com/jsclick?cache={{randomNum}}1&mycart=collect" href="#">\u79fb\u5165\u6536\u85cf\u5939</a><a href="javascript:;" data-point-url="http://www.atpanel.com/jsclick?cache={{randomNum}}2&cartlist=delete" class="J_Del J_MakePoint">\u5220\u9664</a>'};
return["<div ",' id="J_Item_{{cartId}}" ','class="J_ItemBody item-body clearfix item-{{type}} {{#if services}}item-with-services{{/if}} {{#if isFirstOne}}first-item{{/if}} {{#if isLastOne}} last-item {{/if}} {{#if isValid === false && type !== "ju11"}} item-invalid {{/if}} {{#if model && model.isSelected}} selected item-selected {{/if}}" ',">",'<ul class="item-content clearfix">','<li class="td td-chk">','<div class="td-inner">'+c.checkbox+"</div>","</li>",'<li class="td td-item">','<div class="td-inner">',c.itemInfo.itemPic,'<div class="item-info">','<div class="item-basic-info">',c.itemInfo.itemTitle,"</div>",'<div class="item-other-info">',c.itemInfo.itemShopInfo,c.itemInfo.itemLogos,c.itemInfo.itemIcons,"</div>","</div>","</div>","</li>",'<li class="td td-info">',c.info,"</li>",'<li class="td td-price">','<div class="td-inner">'+c.price+"</div>","</li>",'<li class="td td-amount">','<div class="td-inner">'+c.amount+"</div>","</li>",'<li class="td td-sum">','<div class="td-inner">'+c.total+"</div>",'</li><li class="td td-op">','<div class="td-inner">{{#if type !== "combo"}}'+c.operations+"{{/if}}</div>","</li></ul>",c.services,"</div>"]}),KISSY.add("cart/mods/item/itemTPL",function(a,b,c,d,e){var f=b.all,g="[Template] item render ",h=[];return a.each(e,function(a){h.push(c(a))}),{generate:function(b){var c="";return b&&b.cartId&&a.each(h,function(a){c+=d(a,b,g)}),c},render:function(b){var c=this.generate(b);if(b&&b.cartId){var d=f("#J_ItemHolder_"+b.cartId);return d&&d.length?(d.html(c),d):(a.log(g+"cannot find item holder for item:"+b.cartId),null)}return a.log(g+"error: cannot find item id."),null}}},{requires:["node","gallery/template/1.0/","../../utils/tpl/render","./tpl/item.tpl"]}),KISSY.add("cart/mods/item/quantity/effect",function(a,b,c){"use strict";var d=b.all,e=null,f=null;return{increase:function(a,b,g,h,i){if(c.ie<8||""!==Global.cfg.client)return i&&i(),void 0;if(parseInt(g,10)!==parseInt(h,10)){e&&e.stop(),f&&f.stop();for(var j=g+"",k="",l=h+"",m="",n=b.width(),o=b.outerHeight(),p=0;p<j.length;p++)k+='<span style="position:relative;top:0;">'+j[p]+"</span>";b.css("color","#fff"),a.css("position","relative"),a.prepend('<span class="numSpan" style="position:absolute;width:'+n+"px;height:"+o+"px;line-height:"+o+'px;margin:0;padding:0;text-align:center;top:0;left:19px;">'+k+"</span>");var q=a.all(".numSpan"),r=q.last("span");r&&(f=r.animate({top:-25,opacity:.5},{duration:.2,complete:function(){q.remove()}}));for(var s=0;s<l.length;s++)m+='<span style="position:relative;">'+l[s]+"</span>";var t=d('<span class="downSpan" style="position:absolute;width:'+n+"px;height:"+o+"px;line-height:"+o+'px;margin:0;padding:0;text-align:center;top:35px;left:19px;opacity:0.5;">'+m+"</span>");a.append(t);var u=a.all(".downSpan"),v=u.last("span");e=v.animate({top:-35,opacity:1},{duration:.2,complete:function(){u.remove(),a.css("position",""),b.css("color","#3c3c3c"),i&&i()}})}},decrease:function(a,b,g,h,i){if(c.ie<8||""!==Global.cfg.client)return i&&i(),void 0;if(parseInt(g,10)!==parseInt(h,10)){e&&e.stop(),f&&f.stop();for(var j=g+"",k="",l=h+"",m="",n=b.width(),o=b.outerHeight(),p=0;p<j.length;p++)k+='<span style="position:relative;top:0;">'+j[p]+"</span>";b.css("color","#fff"),a.css("position","relative"),a.prepend('<span class="numSpan" style="position:absolute;width:'+n+"px;height:"+o+"px;line-height:"+o+'px;margin:0;padding:0;text-align:center;top:0;left:19px;">'+k+"</span>");var q=a.all(".numSpan"),r=q.last("span");r&&(f=r.animate({top:25,opacity:.5},{duration:.2,complete:function(){q.remove()}}));for(var s=0;s<l.length;s++)m+='<span style="position:relative;">'+l[s]+"</span>";var t=d('<span class="upSpan" style="position:absolute;width:'+n+"px;height:"+o+"px;line-height:"+o+'px;margin:0;padding:0;text-align:center;opacity:0.5;top:-35px;left:19px;">'+m+"</span>");a.append(t);var u=a.all(".upSpan"),v=u.last("span");e=v.animate({top:35,opacity:1},{duration:.2,complete:function(){u.remove(),a.css("position",""),b.css("color","#3c3c3c"),i&&i()}})}}}},{requires:["node","ua"]}),KISSY.add("cart/mods/item/quantity/quantity",function(a,b,c,d,e){function f(b){a.mix(this,b),this._init(b)}{var g=b.all;parseInt(Global.cfg.period)}return a.augment(f,{_init:function(){this._initUI(),this._bindEvents()},_initUI:function(){var a=this.item.data,b=parseInt(c.val(this.triggerEl),10),d=1!==b?"minus":"no-minus",e=b>=a.amount.max||b>=a.amount.limit?"no-plus":"plus";this.minusEl=c.create('<a href="#" class="J_Minus '+d+'">-</a>'),this.plusEl=c.create('<a href="#" class="J_Plus '+e+'">+</a>'),this.containerEl=c.parent(this.triggerEl),c.insertBefore(this.minusEl,this.triggerEl),c.insertAfter(this.plusEl,this.triggerEl)},_bindEvents:function(){this.item.itemEl.delegate("click",".J_Minus",this._minusClickHandler,this).delegate("click",".J_Plus",this._plusClickHandler,this),d.on(this.triggerEl,"valuechange",this._valueChangeHandler,this)},_valueChangeHandler:function(){this.timer&&clearTimeout(this.timer),this._doCheckQuantity(this._getCurVal()),this._doCheck()},_minusClickHandler:function(b){if(b.preventDefault(),!c.hasClass(this.minusEl,"no-minus")){this.timer&&clearTimeout(this.timer);var d=this._getCurVal(),f=this._doCheckQuantity(this._changeAmount(-1));e.decrease(g(this.containerEl),g(this.triggerEl),d,f,a.bind(function(){this._doCheck(500)},this))}},_plusClickHandler:function(b){if(b.preventDefault(),!c.hasClass(this.plusEl,"no-plus")){this.timer&&clearTimeout(this.timer);var d=this._getCurVal(),f=this._doCheckQuantity(this._changeAmount(1));e.increase(g(this.containerEl),g(this.triggerEl),d,f,a.bind(function(){this._doCheck(500)},this))}},_getCurVal:function(){return parseInt(a.trim(c.val(this.triggerEl)),10)||1},_changeAmount:function(a){var b=this.item.data.amount,c=b.multiple||1,d=this._getCurVal();return a&&(c>1?a>0?d+=c-d%c:d-=d%c?d%c:c:d+=a),1>d&&(d=1),d},_doCheck:function(a){var b=this,c=b.item.data.amount,d=c.now;d!==b._getCurVal()&&(b.timer&&clearTimeout(b.timer),b.timer=setTimeout(function(){var a=b._getCurVal();b._updateItem(a)},a||300),Global.utils.makepoint("8.9"))},_doCheckQuantity:function(a){var b=this.item.data.amount,d=this.triggerEl,e=b.max,f=b.limit,g=b.now,h=b.demandQuality||0,i=b.supplyQuality||0,j=b.multiple||1;0>=a&&(a=1),1===a?c.replaceClass(this.minusEl,"minus","no-minus"):c.replaceClass(this.minusEl,"no-minus","minus"),a>=e||a>=f?c.replaceClass(this.plusEl,"plus","no-plus"):c.replaceClass(this.plusEl,"no-plus","plus"),/^\d+$/.test(a+"")?0===e?(this._addError("\u5e93\u5b58\u4e0d\u8db3"),a=0):a>e?(this._addError("\u6700\u591a\u53ea\u53ef\u8d2d\u4e70"+e+"\u4ef6"),a=e):g>e&&a>e?(this._addError("\u6700\u591a\u53ea\u53ef\u8d2d\u4e70"+e+"\u4ef6"),a=e):h>i?this._addError("\u4ec5\u5269"+i+"\u4ef6","\u8be5\u5546\u54c1\u53ea\u6709"+i+"\u4ef6\u4e86\u54e6\uff0c\u4f46\u662f\u6709"+h+"\u4eba\u5df2\u7ecf\u52a0\u5165\u8d2d\u7269\u8f66\u6253\u7b97\u8d2d\u4e70\uff0c\u5148\u4e70\u5148\u5f97\u54e6\uff01"):0!==a%j&&(this._addError("\u8d2d\u4e70\u6570\u91cf\u5fc5\u987b\u662f"+j+"\u7684\u500d\u6570"),a=j):a=g;var k="",l="";return e>=f?k="\u9650\u8d2d"+f+"\u4ef6":3>=e&&(k="\u5e93\u5b58\u7d27\u5f20",l="\u8be5\u5546\u54c1\u53ea\u6709"+e+"\u4ef6\u4e86\u54e6\uff0c\u8981\u4e70\u7684\u8d76\u7d27\u554a"),k&&this._addError(k,l,"s-danger-text"),c.val(d,a),a},_updateItem:function(a){{var b=this,c=b.item;b.triggerEl}this._updateSum(a),Global.request({updateUnselect:!c.isSelected(),operate:c,quantity:a,orders:c.getOrder(),type:"update",silent:!0,success:function(){},error:function(c){c.message&&b._addError(c.message),b._updateQuantity(a)}})},_updateSum:function(a){var b=this.item;b.data.amount.now=a,b.data.price.sum=b.data.price.now*a,b.itemSumEl.html(Global.utils.toMoney(b.data.price.sum))},_updateQuantity:function(a){var b=this.triggerEl;this._updateSum(a),c.val(b,a),Global.updateCart()},_addError:function(a,b,d){b=b||"",d=d||"error-msg",this._removeError();var e=c.create('<em class="'+d+'"'+(b?' title="'+b+'"':"")+">"+a+"</em>");c.append(e,c.get(".J_AmountMsg",this.item.itemEl))},_removeError:function(){var a=c.query("em",c.get(".J_AmountMsg",this.item.itemEl));c.remove(a)}}),f},{requires:["node","dom","event","./effect"]}),KISSY.add("cart/utils/pic-zoom/pic-zoom",function(a,b){function c(a,b,c){var d=b.offset(),e=c.offset(),f=d&&e?d.top-e.top:0,g=c.height(),h=b.outerHeight(),i=66;i=f>0?(g-f)/2-8:-f+g/2-8,0>i&&(i=0),i>h-16&&(i=h-16),a.css("top",i)}function d(){f&&clearTimeout(f),e&&(f=setTimeout(function(){e.hide&&e.hide()},200))}var e,f,g=b.all,h='<div class="item-big-pic cart-pic s240"><a href="{itemUrl}" target="_blank"><img src="{bigImgSrc}" class="J_MakePoint" /></a></div><span class="arrow"></span>';return{show:function(b,i,j){return f&&clearTimeout(f),e&&e.hide(),""===i?!1:(f=setTimeout(function(){var k=a.substitute(h,{itemUrl:j,bigImgSrc:i.replace(/_(sum|\d{2,5}x\d{2,5})\.jpg$/,"")+"_240x240.jpg"}),l={offset:[10,53],node:b,points:["cr","cl"],overflow:{adjustY:1}},m=function(){if(e){var a=e.get("el"),d=g(".arrow",a);c(d,a,b)}};e?(e.set("content",k),e.set("align",l),e.show(),m()):a.use("overlay",function(a,b){e=new b({elCls:"small2big-popup",zIndex:13e3,align:l,content:k}),e.show(),m(),g(e.get("el")).attr("id","J_PicZoom").on("mouseenter",function(){f&&clearTimeout(f)}).on("mouseleave",d),a.log("[PicZoom] constructed.")})},300),!0)},hide:d}},{requires:["node"]}),KISSY.add("cart/mods/item/bigPic/bigPic",function(a,b,c){function d(b){var d=this;a.mix(d,b),e(d.itemEl).delegate("mouseenter",".J_ItemPic",function(){c.show(d.triggerEl,d.imgUrl,d.itemUrl)}).delegate("mouseleave",".J_ItemPic",function(){c.hide()})}var e=b.all;return a.augment(d,{destroy:function(){c.hide()}}),d},{requires:["node","../../../utils/pic-zoom/pic-zoom"]}),KISSY.add("cart/utils/highlight/highlight",function(a,b){function c(a){this.targetEl=d(a),this.highlightEl=null}var d=b.all;return a.augment(c,{_setPosition:function(){var a=this.targetEl,b=a.offset();b?d(this.highlightEl).css({left:b.left,top:b.top,width:a.outerWidth(),height:a.hasClass("hidden")?0:a.height()}):Global.utils.jstracker("target el offset not defined.","highlight.js","14","dom")},add:function(){this.highlightEl&&this.remove(),this.highlightEl=d('<div class="highlight"></div>'),this._setPosition(),this.highlightEl.appendTo(document.body)},remove:function(){this.highlightEl&&(d(this.highlightEl).remove(),delete this.highlightEl)}}),c},{requires:["node"]}),KISSY.add("cart/mods/item/del/del",function(a,b,c){return{del:function(b,d){var e=this;switch(d=a.merge({type:"del"},d||{}),a.trim(d.type)){case"fav":this._delItem(b,d);break;default:this._addHighlight(b.itemEl),c.confirm("\u786e\u8ba4\u8981\u5220\u9664\u8be5\u5b9d\u8d1d\u5417?","\u5220\u9664\u5b9d\u8d1d",void 0,function(){e._delItem(b,d)},a.bind(this._removeHighLight,this))}},_addHighlight:function(a){this.highlight||(this.highlight=new b(a)),this.highlight.add()},_removeHighLight:function(){this.highlight&&(this.highlight.remove(),delete this.highlight)},_delItem:function(a,b){var c=this;Global.request({type:"delete",operate:a,orders:a.getOrder(),success:function(d){d.success&&(b.success&&b.success(),c._removeHighLight(),a.remove())},error:b.error||function(){c._removeHighLight()}})}}},{requires:["../../../utils/highlight/highlight","../../../utils/dialog/dialog"]}),KISSY.add("cart/mods/item/fav/fav",function(a,b,c,d,e,f){function g(b){a.mix(this,b),this._init()}var h=b.all;return a.augment(g,{_init:function(){this.isFromUndo?this._doFav(this.item):this._bindEvents()},_bindEvents:function(){var a=this;h(a.item.itemEl).delegate("click",".J_Fav",function(b){b.preventDefault(),"pad"===Global.cfg.client&&b.stopPropagation(),a._doFav(a.item),Global.utils.makepoint("8.7")})},_doFav:function(b){var d=this,f=[],g=a.isArray(b)?b:[b];a.each(g,function(a){f.push(a.data.itemId+":"+a.data.skuId)}),e({type:"get",url:Global.cfg.api.favorite,data:{itemSkuList:f.join(","),_tb_token_:c.val("#_tb_token_")},success:function(b){if(a.isPlainObject(b)){var c=b.result,e="pad"===Global.cfg.client,f=e?null:d._generateTip(g[0],c);c.status?d._delItem(g[0],function(){e&&alert("\u6210\u529f\u79fb\u5165\u6536\u85cf\u5939\uff01"),d._removeTip(f)}):(e&&c.message&&alert(c.message.error),d._removeTip(f))}},dataType:"jsonp"})},_generateTip:function(a,b){var d=a.itemEl,e=b.status,f=b.message,g=d.offset(),h=d.width(),i=c.create('<div id="fav-lay-prefix-'+a.cartId+'" class="fav-box"></div>'),j="";return j=e?c.create('<div class="msg fav-status"><p class="ok">\u6210\u529f\u79fb\u81f3\u6536\u85cf\u5939</p></div>'):8===f.errorCode?c.create('<div class="msg fav-status"><p class="attention">'+f.error+"</p></div>"):c.create('<div class="msg fav-status"><p class="error">'+f.error+"</p></div>"),c.append(j,i),c.append(i,document.body),g&&c.css(i,{top:g.top+11,left:g.left+h-c.width(j)}),i},_removeTip:function(b){b&&a.later(function(){c.remove(b)},500)},_delItem:function(a,b){f.del(a,{type:"fav",success:b,error:b})}}),g},{requires:["node","dom","event","ajax","../del/del"]}),KISSY.add("cart/utils/tip/tip",function(a,b,c){function d(){h&&h.destroy(),h=null}function e(){g&&clearTimeout(g)}function f(){g&&clearTimeout(g),g=setTimeout(d,300)}var g,h,i,j=b.all,k=!1;return{init:function(){k===!1&&j(document).delegate("mouseenter",".cart-tips",e).delegate("mouseleave",".cart-tips",f)},show:function(b,d,g){return b?(a.isFunction(d)&&(g=d,d={}),k===!1&&this.init(),this.hide(),a.use("overlay",function(a,k){d.elCls="cart-tips "+(d.elCls||""),d.content=c(b)+'<span class="arrow"></span>',h=new k.Popup(d),h.show(),d.contentWidth&&j(h.get("contentEl")).width(d.contentWidth),i=d.align&&d.align.node?j(d.align.node):null,d.noEvent!==!0&&i.on("mouseenter",e).on("mouseleave",f),g&&g(h)}),!0):!1},hide:function(){g&&clearTimeout(g),d(),i&&i.detach("mouseleave",f).detach("mouseenter",e)}}},{requires:["node","../tpl/render"]}),KISSY.add("cart/mods/item/promoTip/promo",function(a,b,c,d,e){function f(a){var b=a/1e3/60;return b>60?parseInt(b/60,10)+"\u5c0f\u65f6":parseInt(b,10)+"\u5206\u949f"}function g(b){var g=this;a.mix(g,b),g.timer=null,g.tip=null,g.animTimer=null;var k=g.item;k.itemEl.delegate("mouseenter click",".J_ItemPromotions",function(b){"click"===b.type&&b.preventDefault(),b.stopPropagation(),g.timer&&clearTimeout(g.timer),g.timer=setTimeout(function(){var l=h(b.currentTarget).addClass(i),m=k.data.promotions,n=m.title.split(":");if(m.desc=m.desc||(n.length>1?a.trim(n[1]):n[0]),m.endTime){var o=+new Date,p=m.endTime-o;p>0&&(m.endStr=f(p))}m.savedStr=Global.utils.toMoney(m.saved);var q="";(m.diff||1===m.activityType)&&(q="\u6bd4\u52a0\u5165\u8d2d\u7269\u8f66\u65f6\uff0c",m.diff?q+="\u53c8\u4f18\u60e0\u4e86"+Global.utils.toMoney(m.diff)+"\u5143"+(1===m.activityType?"\u4e14\u5305\u90ae":""):1===m.activityType&&(q+="\u5305\u90ae"),m.except&&(q+="\uff08\u4e0d\u5305\u542b\uff1a"+m.except+"\uff09")),m.compareStr=q;var r=e(d(j),m);if(r){var s=h("<div>"+r+"</div>").appendTo("body").css({position:"absolute",top:-9999,left:-9999}),t=s.width();s.remove(),100>t?t=100:t>200&&(t=200),g.animTimer&&g.animTimer.stop(),c.show(r,{elCls:"promo-detail-tips",align:{node:l,points:["bl","tl"]},contentWidth:t,noEvent:!0},function(a){g.tip=a;var b=h(a.get("el")),c=b.height();b.height(0),animTimer=b.animate({height:c},{duration:.2,easing:"backOut"})})}},300)}).delegate("mouseleave",".J_ItemPromotions",function(a){a.stopPropagation(),g.timer&&clearTimeout(g.timer),g.animTimer&&g.animTimer.stop(),g.timer=setTimeout(function(){if(h(a.currentTarget).removeClass(i),g.tip){var b=h(g.tip.get("el"));g.animTimer=b.animate({height:0},{duration:.1,easing:"backIn",complete:function(){c.hide(),b.remove(),g.tip&&g.tip.destroy()}})}g.tip=null},300)})}var h=b.all,i="promo-hover",j='{{#if endStr}}<div class="promo-end-time">\u5269\u4f59\uff1a{{endStr}}</div>{{/if}}<div class="promo-d-line">{{name}}\uff1a{{desc}}</div>{{#if usedPoint > 0}}<div class="promo-d-line">\u53ef\u7528{{usedPoint}}\u5929\u732b\u79ef\u5206\u83b7\u5f97\u4f18\u60e0</div>{{/if}}{{#if saved}}<div class="promo-d-line">\u4f18\u60e0\uff1a{{savedStr}}\u5143</div>{{/if}}{{#if compareStr}}<div class="promo-d-line promo-diff">{{compareStr}}</div>{{/if}}{{#if specialContent}}<div class="promo-d-line promo-diff">{{specialContent}}</div>{{/if}}';return g},{requires:["node","../../../utils/tip/tip","gallery/template/1.0/","../../../utils/tpl/render"]}),KISSY.add("cart/mods/item/promoTip/ask-for-promo",function(a,b,c,d){function e(a){var b=a.item;b.itemEl.delegate("click",".J_AskPromotion",function(a){a.halt();var c=f(a.currentTarget);b.data.askPromo.asked===!0?d.show("\u60a8\u5df2\u5411\u5356\u5bb6\u6c42\u4f18\u60e0\uff0c<br />\u8bf7\u7b49\u5f85\u5356\u5bb6\u53cd\u9988\uff01",{elCls:"promo-detail-tips",align:{node:c,points:["bl","tl"],offset:[0,7]}}):Global.request({type:"findPromotion",operate:b,orders:b.getOrder()})})}var f=b.all;return e},{requires:["node","ajax","../../../utils/tip/tip"]}),KISSY.add("cart/utils/sku/sku",function(a,b,c,d,e,f){function g(b){a.mix(this,b),this._init()}SALE_NOT_FOUND="\u8be5\u5b9d\u8d1d\u5df2\u88ab\u4e0b\u67b6\u6216\u5220\u9664";var h='{{#each prop as curPropValues curPropName}}<dl class="prop clearfix J_Prop"><dt>{{curPropName}}</dt><dd><ul class="clearfix">{{#each curPropValues as curPropValue curPvid}}{{#if curPvid != "pvId" && curPvid != "type"}}<li data-prop="{{curPropName}}" data-pvid="{{curPvid}}" class="prop-block J_PropBlock {{#if curSku}}{{#if curPropValue[0]==curSku[curPropName.replace(/&nbsp;/g, "").replace(/s+/gi, "").replace(/\u3000/g, "")]}} selected{{/if}}{{/if}}{{#if curPropValue.length == 2}} img-mode {{/if}}" title="{{curPropValue[0]}}"><a href="javascript: void(0)" {{#if curPropValue.length == 2}}style="background:url({{curPropValue[1]}}) 50% 50% no-repeat;"{{/if}}><span>{{curPropValue[0]}}</span></a><i></i></li>{{/if}}{{/each}}</ul></dd></dl>{{/each}}',i='<div class="msg hidden-msg"><p class="error J_ErrorInfo"></p></div>',j='{{#if hasAmount !== false}}<dl class="amount clearfix"><dt>\u6570&nbsp;&nbsp;&nbsp;&nbsp;\u91cf</dt><dd class="clearfix"><div class="amount-wp"><a href="#" class="J_Minus no-minus">-</a><input type="text" value="{{quantity}}" class="J_Amount amount-input" /><a href="#" class="plus J_Plus">+</a></div><span class="unit">\u4ef6</span><span class="stock">\uff08\u5e93\u5b58<em class="J_Stock" data-defstock="{{stock}}">{{stock}}</em>\u4ef6\uff09</span>'+i+"</dd></dl>{{#else}}"+i+'{{/if}}<p class="operate"><a href="javascript:void(0);" class="add-cart J_AddCart {{#if hasSku}}btn-disabled{{/if}}"><span>\u786e\u5b9a</span></a><a href="javascript:void(0);" class="cancel J_Cancel">\u53d6\u6d88</a></p>',k="selected";return a.augment(g,{_init:function(){var b=this;a.mix(b,c.Target),a.mix(b,{hasSku:!0,skuData:null,skuInfo:{prop:{},pvids:null},propAmount:0},!1),b._request(),b.on("rendered",function(){b.renderfired&&b.renderfired();var a=b.container;b.hasAmount!==!1&&(b.minusBtn=a.one(".J_Minus"),b.plusBtn=a.one(".J_Plus"),b.quantityInput=a.one(".J_Amount")),b.errorBox=b.errorBox||a.one(".J_ErrorInfo"),b.hasSku&&b._initSkuSelect(),b.hasAmount!==!1&&b._initQuantity(),!b.hasSku&&b.defaultAmount?b[(b.addToCart?"":"_")+"addToCart"]({item_id:b.itemId,outer_id:0,outer_id_type:1,quantity:parseInt(b.defaultAmount,10)}):(b._initBtnAddCart(),b._initBtnCancel()),b.rendered&&b.rendered()})},_initMask:function(){var c=this,d=c.rowBox.one(".J_Mask");d||(d=b.create('<div class="J_Mask mask"><i></i></div>'),c.container.parent().prepend(d)),c.mask=a.one(d)},_request:function(){var b=this;e({url:Global.cfg.api.sku,dataType:"jsonp",data:{item_num_id:b.itemId},jsonpCallback:"jsonpGetSkuInfo"+a.guid(),success:function(c){a.isPlainObject(c)&&c.success?(b.skuData=c,b.hasSku=!!c.prop,!b.hasSku&&b.defaultAmount?b.fire("rendered"):b._render()):(f.alert("\u83b7\u53d6\u5546\u54c1\u5c5e\u6027\u4fe1\u606f\u5931\u8d25\uff0c\u8be5\u5546\u54c1\u53ef\u80fd\u5df2\u7ecf\u4e0b\u67b6\u6216\u5220\u9664"),b.error&&b.error())},error:function(){f.alert("\u83b7\u53d6\u5546\u54c1\u5c5e\u6027\u4fe1\u606f\u5931\u8d25"),b.error&&b.error()},charset:"gbk"})},_render:function(){var a=this,b=a.skuData,c="",e=d(j).render({hasSku:a.hasSku,stock:b.item.stock,hasAmount:a.hasAmount,quantity:a.quantity||1});a.defStock=b.item.stock,a.hasSku&&(b.curSku=a.curSku,c=d(h).render(b)),a.container.html('<div class="sku-props-selector clearfix">'+c+e+"</div>"),a.fire("rendered")},_initSkuSelect:function(){var b=this,c=b.container.all(".J_Prop");b.propAmount=c.length,c.each(function(c){var d=c.all("li");d.on("click",function(c){c.preventDefault(),b._handleItemClick(a.one(this),d)}),d.each(function(a){a.hasClass(k)&&b._recordPropInfo({isSelected:!0,prop:a.attr("data-prop"),pvid:a.attr("data-pvid")})})}),b.on("skuChange",function(a){b._recordPropInfo(a),b.skuChanged(a),b.hasAmount!==!1?(b._updateStock(),b._validateQuantity()):b._isAllPropSelected()&&b._hideErrorInfo()})},_handleItemClick:function(a,b){var c=this;a.hasClass(k)?a.removeClass(k):(b.each(function(a){a.removeClass(k)}),a.addClass(k)),c.fire("skuChange",{isSelected:a.hasClass(k),prop:a.attr("data-prop"),pvid:a.attr("data-pvid")})},_isAllPropSelected:function(){var b=this,c=b.skuInfo.prop,d=0;return a.each(c,function(a){a&&(d+=1)}),b.propAmount===d},_recordPropInfo:function(a){var b=this,c=b.skuInfo,d=c.prop;a.isSelected?d[a.prop]=a.pvid:delete d[a.prop],c.pvids=b._isAllPropSelected()?b._getCurrentPvids():null},_updateStock:function(){var a=this,b=a.skuData.skuMap,c=a.skuInfo.pvids,d=a.container.one(".J_Stock"),e=a._isAllPropSelected()?b[c].stock:d.attr("data-defstock");d.html(e)},_getCurrentPvids:function(){var a,b=this,c=b.skuData.skuMap;for(a in c)if(c.hasOwnProperty(a)&&b._isMatchThePvid(a))break;return a},_isMatchThePvid:function(b){var c=this,d=0,e=c.skuInfo.prop;return a.each(e,function(a){var c=new RegExp(a);c.test(b)&&(d+=1)}),d===c.propAmount},_initQuantity:function(){var a=this;a.quantityInput.on("keyup",function(){a._validateQuantity()}),c.delegate(a.container,"click",".J_Plus",function(b){b.preventDefault();var c=parseInt(a.quantityInput.val(),10);a.quantityInput.val(c+1),c>0&&a.minusBtn.replaceClass("no-minus","minus"),a._validateQuantity()}),c.delegate(a.container,"click",".J_Minus",function(b){if(b.preventDefault(),a.minusBtn.hasClass("no-minus"))return!1;var c=parseInt(a.quantityInput.val(),10);return c>1&&a.quantityInput.val(--c),2>c&&a.minusBtn.replaceClass("minus","no-minus"),a._validateQuantity(),!0})},_validateQuantity:function(){var a=this,b=/^\d+$/,c=a.quantityInput,d=parseInt(c.val(),10);if(a._hideErrorInfo(),!b.test(c.val()))return c.val(""),a._showErrorInfo("\u8bf7\u586b\u5199\u6b63\u786e\u7684\u5b9d\u8d1d\u6570\u91cf\uff01");var e=a._getCurrentStock();if(!e)return a._showErrorInfo("\u6682\u65f6\u7f3a\u8d27");if(d>e)return a._showErrorInfo("\u6700\u591a\u53ef\u8d2d\u4e70"+e+"\u4ef6\u5546\u54c1");if(a.checkQuantity){var f=a.checkQuantity(d);if(f)return a._showErrorInfo(f)}return!0},_showErrorInfo:function(b){return this.errorBox&&this.errorBox.html(b).parent().show(),this.autoHideError&&(this._errorTime&&clearTimeout(this._errorTime),this._errorTime=setTimeout(a.bind(this._hideErrorInfo,this),1e3*this.autoHideError)),!1},_hideErrorInfo:function(){this.errorBox&&this.errorBox.html("").parent().hide()},_getRemainRedeemed:function(){var a=this.rowBox.one(".J_Remain");return parseInt(a.text(),10)},_getCurrentStock:function(){var a=this.container.one(".J_Stock");return parseInt(a.text(),10)},_initBtnAddCart:function(){var a=this,b=a.hasSku,c=a.container,d=a.itemId,e=c.one(".J_AddCart");a.on("skuChange",function(){e[a._isAllPropSelected()?"removeClass":"addClass"]("btn-disabled")}),e.on("click",function(c){return c.preventDefault(),a._isAllPropSelected()?a.hasAmount===!1||a._validateQuantity()?(a[(a.addToCart?"":"_")+"addToCart"]({item_id:d,outer_id:b?a.skuData.skuMap[a.skuInfo.pvids].skuId:0,outer_id_type:b?2:1,quantity:a.hasAmount!==!1?a.quantityInput.val():a.quantity}),!0):(a._showErrorInfo("\u6570\u91cf\u586b\u5199\u6709\u8bef"),!1):(a._showErrorInfo("\u8bf7\u9009\u62e9\u5546\u54c1\u5c5e\u6027"),!1)})},_addToCart:function(b){var c=this;b.t=a.now(),"freegift"===c.itemType&&(b.rw="zp"),a.io({type:"POST",url:c.rowBox.one(".J_Redemption").attr("data-cart-url"),dataType:"json",data:b,success:function(b){a.isPlainObject(b)&&(b.status||c._showErrorInfo(b.error||"\u7cfb\u7edf\u51fa\u9519"))}})},_initBtnCancel:function(){var a=this,b=a.container;b.one(".J_Cancel").on("click",function(b){b.preventDefault(),a.cancel()})},destroy:function(){this.container.empty()}}),g},{requires:["dom","event","gallery/template/1.0/","ajax","../dialog/dialog"]}),KISSY.add("cart/utils/width-fix/auto-width",function(a,b){function c(a){if(a.minWidth&&a.el&&a.heightThreshold){a.distance=(a.maxWidth-a.minWidth)/(parseInt(a.tryTimes,10)||10),this.$el=a.clone?d(a.el).clone(!0).appendTo("body").css({position:"absolute",top:-9999,left:-9999}):d(a.el),this.$el.width(a.minWidth),this.cfg=a;var b=this._fix();return a.clone&&this.$el.remove(),b}}var d=b.all;return a.augment(c,{_fix:function(){var a=this.$el,b=this.cfg,c=a.height(),d=a.width();return d>=b.maxWidth?(a.width(b.maxWidth),[b.maxWidth,a.height()]):c<=b.heightThreshold?[d,c]:c>b.heightThreshold?(a.width(d+b.distance),this._fix()):void 0}}),c},{requires:["node"]}),KISSY.add("cart/mods/item/sku/sku-edit",function(a,b,c,d,e){function f(b){a.mix(this,b),this._init()}var g=b.all,h="item-props-can-hover";return a.augment(f,{_init:function(){var b=this;switch(this.skuStatus){case 1:this.triggerEl=g(".J_AddSkuBtn",this.item.itemEl),this.item.itemEl.delegate("click",".J_AddSkuBtn",a.bind(this._initSku,this));break;case 2:this.timer=null,this.triggerEl=g(".item-props",this.item.itemEl),this.item.itemEl.delegate("click",".J_BtnEditSKU",a.bind(this._initSku,this)),this.item.itemEl.delegate("mouseenter",".item-props-can",function(a){a.stopPropagation(),b.timer&&clearTimeout(b.timer),b.timer=setTimeout(function(){!Global.isScrolling&&g(a.currentTarget).addClass(h)},300)}).delegate("mouseleave",".item-props-can",function(a){a.stopPropagation(),b.timer&&clearTimeout(b.timer),b.timer=setTimeout(function(){!b.sku&&g(a.currentTarget).removeClass(h)},300)})}},destroy:function(){var a=this;a.sku.destroy(),a.sku=null,a.container.remove(),2===a.skuStatus&&a.triggerEl.removeClass(h),g(document).detach("click",a._removeEdit,a)},_removeEdit:function(a){var b=g(a.target),c=b.parent(".J_SkuEdit");if(c&&c.length&&c.attr("id")==="J_SkuEdit_"+this.item.data.cartId)return!1;var d=b.parent(".item-props"),e=b.parent(".J_ItemBody");return(b.hasClass(".item-props")||d&&d.length)&&e&&e.length&&e.attr("id")==="J_Item_"+this.item.data.cartId?!1:(this.destroy(),!0)},_updateSku:function(a){var b=this;b.item.data.skuId=a.outer_id,Global.request({type:"updateItemSku",operate:b.item,quantity:a.quantity,orders:b.item.getOrder(),skuid:a.outer_id,success:function(a){a&&a.success===!0&&b&&b.destroy&&b.destroy(),0===a.list.length&&b.item.remove()}})},_getItemSku:function(){if(this.item&&this.item.data&&this.item.data.skus){var a=g("<div></div>").html(d.stringify(this.item.data.skus)),b=a.html();return a.remove(),d.parse(b)}return{}},_initSku:function(b,c){var d=this;d.container=g("#J_SkuEdit_"+d.item.data.cartId),d.container&&0!==d.container.length||(d.container=g('<div id="J_SkuEdit_'+d.item.data.cartId+'" class="J_SkuEdit sku-edit-popup" style="display: none;"><div class="sku-edit-content"></div><div class="sku-item-pic J_SkuItemPic"><div class="cart-pic s160"><a href="'+d.item.data.url+'" target="_blank"><img src="'+d.item.data.pic+'_160x160.jpg"></a></div></div><span class="arrow"></span></div>').appendTo("body")),2===d.skuStatus&&d.triggerEl.addClass(h),d.sku||(d.sku=new e({container:g(".sku-edit-content",d.container),itemId:d.item.data.itemId,hasAmount:!1,quantity:d.item.data.amount.now,curSku:d._getItemSku(),cancel:function(){c&&a.isFunction(c)&&c(),d.destroy.call(d)},rendered:function(){var a=0,b=this.container.parent(),c=20;2===d.skuStatus&&g(d.triggerEl).all(".sku-line").each(function(a){c+=a.height()});var e=g(d.triggerEl).offset(),f={display:"block"};if(e)if(2===d.skuStatus)f.top=c+e.top,f.left=e.left;else{f.top=25+e.top;var h=g(d.triggerEl).parent(".item-props");if(h){var i=h.offset();f.left=i?i.left:0}}b.css(f),g(".J_PropBlock",this.container).each(function(b){var c=b.outerWidth();c-185>a&&(a=c-185)}),a>0&&b.width(250+a),g(".J_SkuItemPic",b).height(b.height()||180),g(document).on("click",d._removeEdit,d),f.top&&f.left||Global.utils.jstracker("trigger el offset not defined.","sku-edit",140,"dom")},addToCart:function(c){b&&a.isFunction(b)&&b(c),d._updateSku.call(d,c)},skuChanged:function(){var b=this.container.parent(),c=this.skuInfo,e=this.skuData,f=e.item.picUrl||d.item.data.pic,g=e.prop;c.prop&&a.each(c.prop,function(a,b){if(g[b]){var c=g[b][a];if(c&&c[1])return f=Global.utils.removePicSuffix(c[1]),void 0}}),b.all(".J_SkuItemPic").all("img").attr("src",f+"_160x160.jpg")},error:a.bind(d.destroy,d)}))}}),f},{requires:["node","ua","json","../../../utils/sku/sku","../../../utils/width-fix/auto-width"]}),KISSY.add("cart/mods/cart/undo/fake-order",function(a){function b(a){this.uniqueId=a.orderId,this.comboId=a.comboId,this.shopId=a.shopId,this.shopActId=a.shopActId,this.data={page:a.page},this.items={}}return a.augment(b,{getItems:function(){var b=[];return a.each(this.items,function(a){b.push(a)}),b}}),b}),KISSY.add("cart/mods/cart/undo/undo",function(a,b,c,d,e,f){function g(){l&&clearTimeout(l),m("#J_UndoTips").remove();var a=k.parent().one(".J_ItemBody")||m("#J_OrderList").one(".J_ItemBody")||m("#J_Cart"),b=a.offset()||{top:250,left:0},c=m(r).appendTo("body").css("top",b.top+30);l=setTimeout(function(){c.fadeOut(.3,function(){c.remove()})},4e3)}function h(b){var c={},d={},e=[];a.each(o,function(a){if(a){var b=a.getOrder();b||(d[a.orderId]||(d[a.orderId]=new f(a)),b=d[a.orderId],b.items[a.cartId]=a),c[b.uniqueId]=b,e.push(a)}});var h=[];a.each(c,function(a){h.push(a)}),Global.request({type:"undelete",orders:h,operate:e,success:function(a){g(),b&&b(a)},error:function(){}})}function i(){var b,c=!1,d=null;if(a.each(o,function(a){if(a){var c=m("#J_Order_"+a.orderId);d=d||(c.length?c:null),b=b||a.orderId,c.length&&d&&c.offset().top<d.offset().top&&(d=c)}}),d){a.log(n+"insert after order title.");var e=d.parent(".J_GroupHolder");e&&e.length?k.insertBefore(e):k.insertBefore(d.parent()),c=!0}if(c===!1){if(b){a.log(n+"insert after first order.");var f=m("#J_OrderHolder_"+b);if(f&&f.length){var g=f.parent(".J_Group");return g&&g.length?k.insertBefore(g):k.insertBefore(f),!0}}a.log(n+"insert before any order."),k.prependTo("#J_OrderList")}return!0}var j,k,l,m=b.all,n="[undo] ",o={},p=[],q='<div id="J_Undo" class="undo-wrapper"><div class="undo-msg J_UndoMaxMsg"><p>\u6210\u529f\u5220\u9664 <em>{num}</em> \u4ef6\u5b9d\u8d1d\uff0c\u5982\u6709\u8bef\uff0c\u53ef<a href="#undo" class="J_UndoDel">\u64a4\u9500\u672c\u6b21\u5220\u9664</a></p></div></div>',r='<div id="J_UndoTips" class="undo-tips"><div class="msg"><p class="naked ok">\u60a8\u5df2\u6210\u529f\u6062\u590d\u5220\u9664\u7684\u5b9d\u8d1d</p></div></div>';return{record:function(b){p=[],o={},a.each(a.makeArray(b),function(b){b&&b.isRedemption!==!0&&!a.inArray(b.cartId,p)&&(p.push(b.cartId),o[b.cartId]=b)})},render:function(){var b=this;return 0===p.length?(a.log(n+"no items deleted. Undo will not be rendered."),!1):(j&&clearTimeout(j),j=setTimeout(function(){k&&k.remove(),k=m(a.substitute(q,{num:p.length})),i(),k.delegate("click",".J_UndoDel",function(a){a.preventDefault(),h(b.clear)}),a.log(n+"rendered.")},300),!0)},clear:function(){p=[],o={},k&&k.remove()}}},{requires:["node","ajax","json","../../../utils/dialog/dialog","./fake-order"]}),KISSY.add("cart/mods/item/icons/icons",function(a,b){function c(a){var b,c=a.item,e="item-icons-collapse",f="item-icons-expand";c.itemEl.delegate("mouseenter mouseleave",".J_ItemIcons",function(a){var c=d(a.currentTarget);if(b&&clearTimeout(b),!c.hasClass("item-icons-fixed"))switch(a.type){case"mouseenter":b=setTimeout(function(){c.hasClass(e)&&c.removeClass(e).addClass(f)},150);break;case"mouseleave":b=setTimeout(function(){c.removeClass(f).addClass(e)},300)}})}var d=b.all;return c},{requires:["node"]}),KISSY.add("cart/mods/item/lottery/lottery-map",function(){var a="\u6316\u5230\u5b9d\u5566\uff01\u73b0\u5728\u8d2d\u4e70\uff0c\u53ef",b='\uff0c<a href="http://service.taobao.com/support/knowledge-5686796.htm" target="_blank">\u67e5\u770b\u8be6\u60c5</a>';return{tjb:{words:a+"\u5f97500\u6dd8\u91d1\u5e01"+b},hb:{words:a+"\u5f9710\u5143\u652f\u4ed8\u5b9d\u7ea2\u5305"+b},mh:{words:a+"\u9886\u53d6\u539f\u4ef7399\u5143\u7684\u5929\u732b\u9b54\u76d2"+b}}}),KISSY.add("cart/mods/item/lottery/lottery",function(a,b,c,d){function e(a){var b=f(".J_ItemLottery",a.itemEl).html("");if(a.lottery&&c[a.lottery])var e=f(g(a.lottery)).appendTo(b).on("mouseenter",function(){d.show(c[a.lottery].words,{elCls:"lottery-tips",align:{node:e,points:["bl","tl"],offset:[0,10]}})})}var f=b.all,g=function(a){return'<span class="item-lottery item-lottery-'+a+'"></span>'};return a.augment(e,{destroy:function(){}}),e},{requires:["node","./lottery-map","../../../utils/tip/tip"]}),KISSY.add("cart/mods/item/pk/pk",function(a,b){var c="\u5df2\u52a0\u5165\u5bf9\u6bd4",d="\u8be5\u5b9d\u8d1d\u5df2\u5b58\u5728",e="PETREL_DATA_EXIST";return{add:function(a,f){var g=this;if(b.attr(f,"title")==c)return g._generateTip(a.itemEl,d),void 0;if(Global.toolbar&&Global.toolbar.getItemHdEl("pk")){var h=a.data,i={cartId:h.cartId,itemId:h.itemId,skuId:h.skuId?h.skuId:0,from:1,anim:!0,trigger:f,pic:h.pic,callback:function(b){b.success?g._disableTrigger(f):b.error?(b.error.errorCode==e&&g._disableTrigger(f),g._generateTip(a.itemEl,b.error.errorMessage)):g._generateTip(a.itemEl)}};Global.toolbar.message("pk",{type:"addToPK",cfg:i})}else g._generateTip(a.itemEl)},_disableTrigger:function(a){b.text(a,"\u5df2\u52a0\u5165\u5bf9\u6bd4"),b.attr(a,{title:c}),b.css(a,{color:"#999999",cursor:"text","text-decoration":"none"})
},_generateTip:function(a,c){var d=a.offset(),e=a.width(),f=b.create('<div class="fav-box"></div>');c=c?c:"\u7cfb\u7edf\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5";var g=b.create('<div class="msg pk-status"><p class="error">'+c+"</p></div>");b.append(g,f),b.append(f,document.body),d&&b.css(f,{top:d.top+11,left:d.left+e-b.width(g)}),setTimeout(function(){b.remove(f)},3e3)}}},{requires:["dom","io","event"]}),KISSY.add("cart/utils/20141212/hongbao-label",function(a,b){function c(a,b){b.append('<i class="'+f+"coupon-number "+f+'coupon-number-s"></i>');for(var c=0,d=a.length;d>c;c++)b.append('<i class="'+f+"coupon-number "+f+"coupon-number-"+a[c]+'"></i>')}function d(b){b[i]&&3===b[i].length||(b[i]=h),b[j]||(b[j]=g);for(var d=e(b[j],b.container),k=0,l=d.length;l>k;k++){var m=e(d[k]),n=m.attr("data-type"),o="",p=[f+"common"],q=0,r=!1;if(m.attr("data-render-finish")&&"done"===m.attr("data-render-finish")&&(b.repeatRender?b.debug&&a.log(b.debugPrefix+"\u6807\u7b7e\u91cd\u65b0\u6e32\u67d3\uff1a",m):(b.debug&&a.log(b.debugPrefix+"\u6807\u7b7e\u5df2\u88ab\u6e32\u67d3\u8fc7\uff0c\u8df3\u8fc7\u91cd\u65b0\u6e32\u67d3\uff1a",m),r=!0)),!r)switch(n){case"label":o=b[i][0],p.push(f+"pc"),p.push(f+"normal");break;case"mini-label":o=b[i][0],p.push(f+"pc"),p.push(f+"mini");break;case"coupon":o=b[i][1],p.push(f+"pc"),p.push(f+"coupon");var s=parseInt(m.attr("data-value"),10)/100;isNaN(s)?r=!0:q=s.toString().split("");break;case"presale":o=b[i][2],p.push(f+"pc"),p.push(f+"presale-normal");break;case"mini-presale":o=b[i][2],p.push(f+"pc"),p.push(f+"presale-short")}if(!r){if(m.attr("data-render-finish","done"),q&&(o+="\uff1a\u62b5"+s+"\u5143"),m.attr("title",o),m.text(o),q)switch(q.length){case 1:c(q,m),p.push(f+"coupon-short"),m.append('<i class="'+f+'coupon-end"></i>');break;case 2:c(q,m),p.push(f+"coupon-normal"),m.append('<i class="'+f+'coupon-end"></i>');break;case 3:c(q,m),p.push(f+"coupon-long")}m.addClass(p.join(" "))}}}var e=b.all,f="tbc-hongbao-label-",g=".tbc-double-12-label",h=["1212\u4e07\u80fd\u76db\u5178","1212\u8d2d\u7269\u5238","1212\u9884\u552e"],i="label-title",j="label-class",k=function(b){var c={},e="[\u7ea2\u5305\u6807\u7b7e\u63d2\u4ef6] ";return b&&(c=b,b.debug&&a.log(e+"\u6253\u6807\u7ec4\u4ef6\u5f53\u524d\u914d\u7f6e\uff1a",b)),c.debugPrefix=e,d(c),!0};return{init:k}},{requires:["node"]}),KISSY.add("cart/mods/item/baseItem",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){function u(b){a.mix(this,b),this._init()}var v=b.all,w="[BaseItem] ";return a.augment(u,{_init:function(){this.data.model=this.data.model||{},this.mods=this.mods||{},this._render(),this.isValid?Global.lazyload(this.itemHolderEl,function(){this._initQuantity(),this._initCheckbox()},this):("ju11"!==this.data.type&&Global.broadcast("G_ShowClearInvalid",{}),this.isSelected(!1)),Global.lazyload(this.itemPicEl),Global.lazyload(this.itemHolderEl,function(){this._initBigPic(),this._initItemDel(),this._initItemFav(),this._initOpArea(),this._initSkuEdit(),this.isValid&&this._initPromoTip(),this._initLottery(),this._initCouponPromo()},this),Global[(this.isValid&&this.isSelected()?"add":"remove")+"SelectedItems"](this)},_render:function(){this.itemHolderEl=f.render(this.data),this.itemEl=v("#J_Item_"+this.cartId,this.itemHolderEl),this.itemSumEl=v(".J_ItemSum",this.itemEl),this.itemPicEl=v(".J_ItemImg",this.itemEl)},_initCouponPromo:function(){var a=this,b=a.data.promoCoupons;b&&b.length&&t.init({container:v(".promo-logos",a.itemEl)})},_initQuantity:function(){"combo"!==this.orderType&&new g({item:this,triggerEl:v(".J_ItemAmount",this.itemEl)})},_initPromoTip:function(){var a=this;a.data.promotions&&(a.promo=new k({item:a})),a.data.askPromo&&(a.askPromo=new m({item:a}))},_initBigPic:function(){var a=this;a.mods.bigPic=new h({triggerEl:v(".J_ItemPic",a.itemEl),itemEl:a.itemEl,itemUrl:a.data.url,imgUrl:a.data.pic})},_initOpArea:function(){var a=this;"pad"===Global.cfg.client&&(a.opEl=v(".J_ItemOps",a.itemEl),a.itemEl.on("swipe",function(b){if("left"===b.direction&&b.distance>=100){v(".J_ItemOps").hide();var c=a.itemEl.one(".td").height();a.opEl.css({height:c,"line-height":c+"px"}).show()}}).on("click",function(a){var b=v(a.target);b.hasClass("item-operations")&&b.parent(".item-operations")||v(".item-operations").hide()}))},_initItemDel:function(){var a=this;a.itemEl.delegate("click",".J_Del",function(b){b.preventDefault(),"pad"===Global.cfg.client&&b.stopPropagation(),i.del(a,{success:function(){p.record(a)}}),Global.utils.makepoint("8.8")})},_initItemFav:function(){new j({item:this})},_initPK:function(){var a=this;a.itemEl.delegate("click",".J_Diff",function(b){b.preventDefault(),"pad"===Global.cfg.client&&b.stopPropagation(),s.add(a,b.target)})},_initCheckbox:function(){var b=this;v(b.itemEl).delegate("click",".J_CheckBoxItem",function(){Global.resetTemp(),b.isSelected()?b.unselect():b.select(),Global.utils.makepoint("8.6")}),!a.isUndefined(b.isSelected())&&b.check(b.isSelected())},_initSkuEdit:function(){return this.skuEdit?!0:(this.skuEdit=new n({skuStatus:this.data.skuStatus,item:this}),!0)},_initServices:function(){var a=this;a.data.services&&(a.mods.services=new Services({itemEl:a.itemEl,item:a}))},_initItemIcons:function(){var a=this;a.itemIcons=new q({item:a})},_initLottery:function(){var a=this.getAttr("lottery");a&&(this.mods.lottery=new r({itemEl:this.itemEl,lottery:a}))},isSelected:function(a){return a+1&&(this.data.model.isSelected=a),this.data.model.isSelected},remove:function(b){var c=this,d=this.itemEl,e=this.cartId;c.destroy(),d.fadeOut(.3,function(){d.remove();var a=v("#J_ItemHolder_"+e);a&&a.length&&a.html("").hide()}),a.isFunction(b)&&b()},destroy:function(){var b=this.getBundle();a.each(this.mods,function(a){a&&a.destroy&&a.destroy()}),this.check(!1),b.removeItem(this.cartId),a.log(w+" item "+this.cartId+" destroyed."),Global.updateCart()},check:function(a){a+1&&(this.isSelected(!!a),this.itemEl[(a?"add":"remove")+"Class"]("selected item-selected"),v(".J_CheckBoxItem",this.itemEl).prop("checked",a),v(".cart-checkbox",this.itemEl)[(a?"add":"remove")+"Class"]("cart-checkbox-checked"),Global[(a?"add":"remove")+"SelectedItems"](this))},select:function(){var b=this,c=this.getBundle();if(this.isValid){if(this.isSelected()!==!0&&Global.getSelectedItemsLength()>=50)return this.check(!1),o.alert("\u5982\u679c\u9700\u8981\u8d2d\u4e7050\u4ef6\u4ee5\u4e0a\u5546\u54c1\uff0c\u8bf7\u5206\u591a\u6b21\u7ed3\u7b97\uff0c\u5355\u6b21\u6700\u591a\u7ed3\u7b9750\u4ef6\u5546\u54c1","\u5df2\u9009\u5546\u54c1\u63d0\u793a"),!1;if(1===this.data.skuStatus)return this.skuEdit||this._initSkuEdit(),this.skuEdit._initSku(function(){b.check(!0)},function(){b.check(!1)}),this.itemEl&&this.itemEl.offset()&&(e(window,{scrollTop:this.itemEl.offset().top-50},.5,"easeOutStrong").run(),a.log(w+"scrolled to select sku.")),!1;this.check(!0)}return c.check(),!0},unselect:function(){this.check(!1),this.getBundle().check()},mixData:function(b){return b.model=this.data.model,this.data=a.clone(b),this.data},getPrice:function(){return parseFloat(this.data.price.sum)||0},getQuantity:function(){return parseInt(this.data.amount.now,10)},getSkuId:function(){return this.data.skuId},getBundle:function(){var a=this.getOrder();return a.bundles[this.bundleId]},getOrder:function(){var a=Global.getCart(),b=null;return a&&a.orders&&(b=a.orders[this.orderId]),b},getAttr:function(b){var c=this;if(!c.attrs&&(c.attrs={},c.data.attr)){var d=c.data.attr.split(";");a.each(d,function(a){if(a){var b=a.split(":");c.attrs[b[0]]=b[1]}})}return b?c.attrs[b]:c.attrs},hasIcon:function(b){var c=this.data,d=c._iconAlias;return d&&d.length?a.inArray(b,d):!1}}),u},{requires:["node","dom","event","anim","./itemTPL","./quantity/quantity","./bigPic/bigPic","./del/del","./fav/fav","./promoTip/promo","./promoTip/promoTitleMap","./promoTip/ask-for-promo","./sku/sku-edit","../../utils/dialog/dialog","../cart/undo/undo","./icons/icons","./lottery/lottery","./pk/pk","../../utils/20141212/hongbao-label"]}),KISSY.add("cart/mods/item/comboItem",function(a,b){function c(b){a.mix(this,b),this._init()}return a.extend(c,b,{_init:function(){c.superclass._init.call(this)},_initQuantity:function(){},_initItemDel:function(){this.isDisabled&&c.superclass._initItemDel.call(this)},_initItemFav:function(){this.isDisabled&&c.superclass._initItemFav.call(this)},_initOpArea:function(){}}),c},{requires:["./baseItem"]}),KISSY.add("cart/mods/item/services/services",function(a,b){function c(b){a.mix(this,b),this._init()}var d=b.all;return a.augment(c,{_init:function(){var a=this,b="services-collapsed";a.serviceEl=d(".item-services",a.itemEl),d(a.itemEl).delegate("click",".J_ToggleSerivces",function(c){c.preventDefault();var d=a.serviceEl.hasClass(b);a.serviceEl[(d?"remove":"add")+"Class"](b),a.item.data.model.serviceCollapsed=!d})}}),c},{requires:["node"]}),KISSY.add("cart/mods/item/serviceItem",function(a,b,c){function d(b){a.mix(this,b),this._init()}return a.extend(d,b,{_init:function(){d.superclass._init.call(this),Global.lazyload(this.itemHolderEl,this._initService,this)},_initService:function(){var a=this;a.data.services&&(a.mods.services=new c({itemEl:a.itemEl,item:a}))},getPrice:function(){var b=d.superclass.getPrice.call(this),c=0;return a.each(this.data.services,function(a){c+=a.sum}),parseFloat(c)+b}}),d},{requires:["./baseItem","./services/services"]}),KISSY.add("cart/mods/item/redemptionItem",function(a,b){function c(b){a.mix(this,b),this._init()}return a.extend(c,b,{_init:function(){this.checkSelect(),c.superclass._init.call(this)},checkSelect:function(){var a=!0;this.data.model&&this.data.model.isSelected||(this.data.isValid===!0?!this.otherData||this.otherData.bundleChecked||this.otherData.hasSelectedItem||(a=!1):a=!1,this.data.model=this.data.model||{},this.data.model.isSelected=a)},_initQuantity:function(){}}),c},{requires:["./baseItem"]}),KISSY.add("cart/mods/item/crossShopItem",function(a,b){function c(b){a.mix(this,b),this._init()}return a.extend(c,b,{_init:function(){c.superclass._init.call(this)}}),c},{requires:["./baseItem"]}),KISSY.add("cart/mods/item/ju11Item",function(a,b){function c(b){a.mix(this,b),this._init()}return a.extend(c,b,{_init:function(){c.superclass._init.call(this)}}),c},{requires:["./baseItem"]}),KISSY.add("cart/mods/item/itemFactory",function(a,b,c,d,e,f,g,h){return{create:function(i){var j,k=i.data;if("deleted"===k.type)return null;switch(k.type="combo"===i.orderType?"combo":i.type,(k.isExtraItem||k.extraItemInfo)&&(k.type="redemption"),k.services&&(k.type="service"),k.host&&Global.globalData&&Global.globalData[("B"===k.host?"b":"c")+"ItemsCount"]++,a.mix(i,{cartId:k.cartId,itemId:k.itemId,isValid:k.isValid,title:k.title,pic:k.pic,url:k.url,isCombo:"combo"===i.orderType}),i.group=i.host,i.host){case"C":case"B":case"SM":i.group="normal";break;case"HK":i.group="HK_"+k.sellerId}k.isCod&&(i.group="cod"),k.isValid===!1&&"JU_11"===k.code&&(k.type="ju11"),k=b.deal(k);var l;switch(i.data.type){case"deleted":return null;case"combo":l=a.merge(i,{isCombo:!0,comboId:i.data.comboId}),j=new d(l);break;case"redemption":l=a.merge(i,{isRedemption:!0}),j=new f(l);break;case"act":l=a.merge(i,{isCrossShop:!0,crossShopActId:k.crossShopActId,channelInfo:k.channel}),j=new g(l);break;case"service":l=a.merge(i,{isService:!0}),j=new e(l);break;case"ju11":l=a.merge(i,{isJu11:!0}),j=new h(l);break;default:i.data.type="normal",j=new c(i)}return j.level="item",j}}},{requires:["./itemData","./baseItem","./comboItem","./serviceItem","./redemptionItem","./crossShopItem","./ju11Item"]}),KISSY.add("cart/utils/debug/debug",function(a){return{_show:function(b,c,d){b&&(c=c||"\u7cfb\u7edf\u9519\u8bef",d=d||"error",Global.utils.isDaily&&a.use("gallery/pageNotification/1.0/index",function(a,e){var f=new e({closeButton:!0,positionClass:"page-notification-top-right",onclick:null,showDuration:"300",hideDuration:"1000",timeOut:"0",extendedTimeOut:"0",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"});f[d](b,c)}))},error:function(a,b){this._show(a,b,"error")},success:function(a,b){this._show(a,b,"success")},info:function(a,b){this._show(a,b,"info")},warning:function(a,b){this._show(a,b,"warning")}}}),KISSY.add("cart/mods/bundle/baseBundle",function(a,b,c,d,e){function f(b){a.mix(this,b),this._init()}var g=(b.all,"[BaseBundle] ");return a.augment(f,{_init:function(){this.items={},this.updateTimer=null,this.checkTimer=null,this.data.model=this.data.model||{},this.data.uniqueId=this.id;var b=!1;a.each(this.data.items,function(a){return a&&a.isValid&&!a.extraItemInfo&&a.model&&a.model.isSelected===!0?(b=!0,!1):void 0}),this.otherData={bundleChecked:this.data.model&&this.data.model.isChecked===!0,hasSelectedItem:b},this._render(),this._initItems()},_render:function(){this.bundleEl=c.render(this.data)},_initItems:function(){var b=this;a.each(this.data.items,function(c,d){c.type=c.type||b.data.type,c.isFirstOne=0===d,c.isLastOne=d===b.data.items.length-1,c.orderType=b.orderType,c.host=b.host;try{b.items[c.cartId]=b._initItem(c)}catch(f){var g="item "+c.itemId+" construct error: "+f;a.log(g,"warn"),e.error("\u5b9d\u8d1d\u6e32\u67d3\u51fa\u9519\uff0c\u5b9d\u8d1did\uff1a"+c.itemId+"<br/>"+g,"\u5b9d\u8d1d"+c.itemId+"\u6e32\u67d3\u51fa\u9519"),Global.utils.jstracker(g)}})},_initItem:function(a){var b=this;return d.create({bundleId:b.id,type:a.type||b.type,data:a,host:b.host,orderType:b.orderType,orderId:b.orderId,comboId:b.comboId,shopId:b.shopId,shopActId:b.shopActId,page:b.page,otherData:b.otherData})},getSelectedCartIds:function(){var b=[];return a.each(this.items,function(a){a&&a.isSelected()&&b.push(a.cartId)}),b},isChecked:function(b){return b+1&&(this.data.model.isChecked=b),b===!0&&a.each(this.items,function(a){a&&a.isSelected(!0)}),this.data.model.isChecked},hasSelectedItem:function(){var b=!1;return a.each(this.items,function(a){return a&&a.isValid&&a.isRedemption!==!0&&a.isSelected()?(b=!0,!1):void 0}),b},isAllSelected:function(){var b=!0;return a.each(this.items,function(a){return a&&a.isValid&&"redemption"!==a.data.type&&!a.isSelected()?(b=!1,!1):void 0}),b===!0&&a.each(this.items,function(a){a&&"redemption"===a.data.type&&a.check(!0)}),a.log("[Bundle] all items selected: "+b),b},check:function(b){if(this.checkTimer&&clearTimeout(this.checkTimer),b+1){a.log(g+"check status: "+b),this.isChecked(b);var c=this.getOrder();c&&c.check()}else{var d=this;d.checkTimer=setTimeout(function(){d.check(d.isAllSelected())},100)}},select:function(){var b=!0;return a.each(this.items,function(a){return a&&1===a.data.skuStatus?(b=!1,a.select(),!1):void 0}),b===!0&&(a.each(this.items,function(a){return a&&!a.select()?(b=!1,!1):void 0}),this.check(b)),b},unselect:function(){this.check(!1),a.each(this.items,function(a){a&&a.unselect()})},getTotalPrice:function(){var b=0;return a.each(this.items,function(a){a&&a.isSelected()&&a.isValid&&(b+=a.getPrice())}),b},getQuantity:function(){var b=0,c=0,d=0;return a.each(this.items,function(a){a?a.isValid?b+=1:c+=1:d+=1}),{valid:b,invalid:c,deleted:d}},removeItem:function(a){return this.items[a]&&(this.items[a]=null),this.update(),this},removeItems:function(){var b=[];return filter=a.isFunction(filter)?filter:function(){return!0},a.each(this.items,function(a){a&&filter(a)&&(a.remove(),b.push(a.cartId))}),b},remove:function(){this.bundleEl.remove(),this.destroy()},destroy:function(){a.each(this.items,function(a){a&&a.destroy&&a.destroy()}),this.getOrder().removeBundle(this.id),a.log(g+" bundle "+this.id+" destroyed.")},update:function(b){b=a.isUndefined(b)?-1:b;var c=a.bind(function(){Global.utils.isEmpty(this.items)&&(a.log(g+"bundle empty. remove."),this.remove());var c=this.getOrder();c&&c.update(b)},this);this.updateTimer&&clearTimeout(this.updateTimer),0>b?c():this.updateTimer=setTimeout(c,b)},render:function(b){var c=this;a.each(b.orders,function(b){c.items[b.cartId]=c.items[b.cartId]?c._initItem(a.mix(c.items[b.cartId],b)):c._initItem(b)})},getData:function(){var b=this,c=[];return a.each(b.items,function(a){a&&c.push(a.data)}),a.mix(b.data,{orders:c})},getItems:function(){var b=[];return a.each(this.items,function(a){a&&b.push(a)}),b},getItemByCartId:function(b){var c=!1;return a.each(this.items,function(a){return a&&a.cartId===b?(c=a,!1):void 0}),c},mixData:function(b){return b.model=this.data.model,this.data=a.clone(b),this.data},getOrder:function(){var a=Global.getCart(),b=null;return a&&a.orders&&(b=a.orders[this.orderId]),b}}),f},{requires:["node","./bundleTPL","../item/itemFactory","../../utils/debug/debug"]}),KISSY.add("cart/mods/bundle/actBundle",function(a,b,c){function d(b){a.mix(this,b),this._init()}b.all;return a.extend(d,c,{_init:function(){d.superclass._init.call(this)}}),d},{requires:["node","./baseBundle"]}),KISSY.add("cart/mods/bundle/redemptionBundle",function(a,b,c){function d(b){a.mix(this,b),this._init()}b.all;return a.extend(d,c,{_init:function(){d.superclass._init.call(this)},isAllSelected:function(){var b=!0,c=!1,d=[];return a.each(this.items,function(a){a&&a.isValid&&(a.isRedemption===!0?d.push(a):a.isSelected()?c=!0:b=!1)}),a.each(d,function(a){a&&a.check(c)}),a.log("[Bundle] all items selected: "+b),b}}),d},{requires:["node","./baseBundle"]}),KISSY.add("cart/mods/bundle/del/bundle-del",function(a,b,c,d,e){function f(b){a.mix(this,b)}b.all;return a.augment(f,{del:function(){this._addHighlight(),d.confirm("\u786e\u5b9a\u8981\u5220\u9664\u9009\u4e2d\u7684\u5957\u9910\u5417\uff1f","\u63d0\u793a\u4fe1\u606f",void 0,a.bind(this._delBundle,this),a.bind(this._removeHighlight,this))},_addHighlight:function(){this.highlight||(this.highlight=new c(this.bundle.bundleEl)),this.highlight.add()},_removeHighlight:function(){this.highlight&&this.highlight.remove()},_delBundle:function(a){var b=this,c=b.bundle,d=c.getOrder();a=a||c.getItems(),Global.request({type:"deleteSome",orders:d,operate:a,success:function(c){b._removeHighlight(),c.success&&(e.record(a),d.remove(),Global.updateCart())},error:function(){}})}}),f},{requires:["node","../../../utils/highlight/highlight","../../../utils/dialog/dialog","../../cart/undo/undo"]}),KISSY.add("cart/mods/bundle/comboBundle",function(a,b,c,d){function e(b){a.mix(this,b),this._init()}var f=b.all;return a.extend(e,c,{_init:function(){var a=this;e.superclass._init.call(a),a.mods=a.mods||{},Global.lazyload(a.bundleEl,function(){a.data.valid===!0&&a._initSelect(),a._initDel()})},_initSelect:function(){var a=this;a.bundleEl.delegate("click",".J_BundleChk",function(b){b.preventDefault(),a.isChecked()?a.unselect():a.select()})},_initDel:function(){var a=this;a.mods.del=new d({bundle:a}),a.bundleEl.delegate("click",".J_ComboBundleDel",function(b){b.preventDefault(),a.mods.del.del()})},select:function(){var a=e.superclass.select.call(this),b=f(".body-level",this.bundleEl);a?b.addClass("bundle-selected"):(this.unselect(),b.removeClass("bundle-selected"))}}),e},{requires:["node","./baseBundle","./del/bundle-del"]}),KISSY.add("cart/mods/bundle/bundleFactory",function(a,b,c,d){return{create:function(a){var e;switch(a.data.items=a.data.orders,delete a.data.orders,"redemption"===a.orderType&&(a.type="redemption"),a.type){case"act":e=new c(a);break;case"redemption":e=new d(a);break;default:a.data.type=a.type||"normal",e=new b(a)}return e.level="bundle",e}}},{requires:["./baseBundle","./actBundle","./redemptionBundle","./comboBundle"]}),KISSY.add("cart/mods/order/promoScroll/promoScroll",function(a){function b(b,c){var d=b.all("li");d.length<2?c&&c():a.use("gallery/switchable/1.3.1/",function(a,e){e.Slide(b,{markupType:2,panels:d,hasTriggers:!1,effect:"scrolly",interval:3,duration:.5}),c&&c()})}return b}),KISSY.add("cart/mods/order/coupon/coupon-codes",function(){return{RC_ACTIVITY_STATUS_INVALID:"\u8be5\u4f18\u60e0\u5238\u5df2\u7ecf\u505c\u6b62\u9886\u7528\uff01",RC_SHOPBONUS_TOTAL_COUNT_EXCEED:"\u8be5\u4f18\u60e0\u5238\u5df2\u7ecf\u88ab\u9886\u53d6\u5b8c\u4e86\uff01",RC_SHOPBONUS_PERSON_COUNT_EXCEED:"\u60a8\u9886\u53d6\u7684\u4f18\u60e0\u5238\u6570\u91cf\u5df2\u8fbe\u5230\u4e0a\u9650\uff01",RC_SELLER_SHOPBONUS_COUNT_EXCEED:"\u60a8\u9886\u53d6\u7684\u4f18\u60e0\u5238\u6570\u91cf\u5df2\u8fbe\u5230\u4e0a\u9650\uff01",RC_CANNOT_SELF_APPLY:"\u4e0d\u80fd\u9886\u53d6\u81ea\u5df1\u5e97\u94fa\u7684\u4f18\u60e0\u5238\uff01",RC_NOT_LOGIN:"\u8bf7\u5148\u767b\u5f55\uff0c\u518d\u6765\u9886\u53d6\uff01",RC_SYSTEM_ERROR:"\u9886\u53d6\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5\uff01"}}),KISSY.add("cart/mods/order/coupon/coupon",function(a,b,c,d,e,f){function g(b){var c=this;a.mix(c,b),c.showing=!1,h(c.orderEl).delegate("click",".J_MyShopCoupon",function(a){a.preventDefault(),c.$trigger=c.$trigger||h(a.currentTarget),c.toggle(),Global.utils.makepoint("8.37")}),Global.listen("hidePopup",function(a){var b=a.ev,d=h(b.target);d.parent(".coupon-popup")||d.hasClass("J_MyShopCoupon")||d.hasClass("coupon-popup")||d.parent(".J_MyShopCoupon")||d.hasClass("applyCoupon-overlay")||d.parent(".applyCoupon-overlay")||c.hide()})}var h=b.all,i="[coupon] ";window.TB=window.TB||{},TB.Act=TB.Act||{};var j,k='<div class="coupon-summary"><span class="icon-announcement"></span>\u5df2\u9886\u53d6 <em class="J_ReceivedCount">{{receivedCount}}</em> \u5f20\u4f18\u60e0\u5238{{#if unreceivedCount > 0}}\uff0c\u6709\u65b0\u4f18\u60e0\u5238\u53ef\u9886\u53d6{{/if}}</div><div class="coupon-list {{#if priceVolumes.length > 3}}coupon-list-hidden{{/if}}"><ul class="J_ShopCouponList">{{#each priceVolumes as coupon}}<li class="coupon coupon-{{coupon.type}}"><div class="coupon-amount"><span class="rmb">&yen;</span>{{coupon.price}}</div><div class="coupon-detail"><div class="coupon-info"><p class="coupon-title">{{#if coupon.type == "hongbao"}}\u5e97\u94fa\u7ea2\u5305{{#else}}{{coupon.title}}{{/if}}&nbsp;{{coupon.condition}}</p><p class="coupon-time">{{coupon.timeRange}}</p></div><div class="coupon-op">{{#if coupon.status === "received"}}<span class="coupon-received">\u9886\u53d6\u6210\u529f</span>{{#else}}<span class="coupon-unreceived J_ApplyCouponBtn" data-id="{{coupon.id}}" data-type="{{coupon.type}}">\u9886 \u53d6</span>{{/if}}</div></div></li>{{/each}}</ul></div>{{#if priceVolumes.length}}<div class="hr"></div>{{/if}}<span class="arrow"></span>',l="shop-coupon-trigger-hover";return a.augment(g,{show:function(){var b=this;b.showing=!0,h(".coupon-popup").remove(),a.use("overlay",function(a,f){b.popup=new f.Popup({elCls:"cart-tips coupon-popup",content:'<div class="loading"></div><span class="arrow"></span>',align:{node:b.$trigger,points:["bl","tl"],offset:[0,10]},closable:!0}),b.popup.show(),b.popup.on("hide",a.bind(b.hide,b)),new c({type:"get",url:"json/GetPriceVolume.do",data:{sellerId:b.sellerId},success:function(f){j||(j=d(k));var g=e(j,f,i);b.popup.set("content",g),b.$count=h(".J_ReceivedCount",b.popup.get("el")),f.priceVolumes&&f.priceVolumes.length>3&&a.use("gallery/kscroll/1.1/index",function(a,c){new c(h(".J_ShopCouponList",b.popup.get("contentEl")),{prefix:"cart-",hotkey:!0,bodydrag:!0,allowArrow:!1})}),h(b.popup.get("el")).delegate("click",".J_ApplyCouponBtn",function(d){d.preventDefault();var e=h(d.currentTarget),f=e.attr("data-type");if("hongbao"===f){var g=Global.utils.isDaily?"assets.daily.taobao.net":"a.tbcdn.cn";a.getScript("http://"+g+"/apps/smf/utils/applyCoupon-min.css"),a.getScript("http://"+g+"/apps/smf/utils/applyCouponWidget-min.js",function(){a.use("smf/coupon/apply",function(a,c){new c({trigger:e,applyChannel:3,type:e.attr("data-type"),activityId:e.attr("data-id"),sellerId:b.sellerId,cburl:"http://"+Global.utils.cartPath+"/weiboBindProxy.htm",daily:Global.utils.isDaily,showItems:!1}).on("success",function(){b.showSuccess(e)})})},"utf-8"),Global.utils.makepoint("8.38")}else{var i=e.hasClass("disabled");i||(c({url:"http://taoquan."+(Global.utils.isDaily?"daily.taobao.net":"taobao.com")+"/coupon/unify_apply.htm",data:{activityId:e.attr("data-id"),sellerId:b.sellerId,json:!0,applyChannel:5},dataType:"jsonp",jsonp:"callBack",success:function(a){"true"===a.success?b.showSuccess(e):b.showError(e,a.msg,a.msgShow)},error:function(){b.showError(e)},timeout:5}),e.addClass("disabled")),Global.utils.makepoint("8.39")}})},dataType:"jsonp"})})},hide:function(){this.showing=!1,this.popup&&this.popup.destroy(),this.$trigger&&this.$trigger.removeClass(l)},toggle:function(){this.showing?this.hide():(this.show(),this.$trigger&&this.$trigger.addClass(l))},showSuccess:function(a){if(a&&a.replaceClass("J_ApplyCouponBtn coupon-unreceived","coupon-received").html("\u9886\u53d6\u6210\u529f"),this.$count){var b=parseInt(this.$count.html(),10);this.$count.html(++b)}},showError:function(b,c,d){d=f[c]||d||"\u7cfb\u7edf\u5fd9\uff01\u8bf7\u7a0d\u5019\u518d\u8bd5\u5427~",a.log(i+"coupon get error: "+d),b&&b.parent(".coupon-detail").addClass("coupon-error").html(d)}}),g},{requires:["node","ajax","gallery/template/1.0/","../../../utils/tpl/render","./coupon-codes"]}),KISSY.add("cart/mods/group/tpl/group.tpl",function(a,b){b.all;return{order:'<div id="J_Group_{{uniqueId}}" class="J_Group"><div class="group-hd"><div class="J_ItemHead shop clearfix"><div class="shop-info"><div class="cart-checkbox {{#if model && model.isSelected}}cart-checkbox-checked{{/if}}"><input class="J_CheckBoxGroup" id="J_CheckGroup_{{uniqueId}}" type="checkbox" name="groups[]" value="{{uniqueId}}" {{#if model && model.isSelected}}checked{{/if}} /><label for="J_CheckGroup_{{uniqueId}}">\u52fe\u9009\u6b64\u5e97\u94fa\u4e0b\u6240\u6709\u5546\u54c1</label></div>&nbsp;&nbsp;{{#if host != "C"}}<span class="shop-icon icon-{{host}}"></span>{{/if}}{{#if title}}\u5e97\u94fa\uff1a<a href="{{url}}" target="_blank" title="{{title}}" class="J_MakePoint" data-point="tbcart.8.15">{{title}}</a>{{#elseif seller}}\u5356\u5bb6\uff1a<a href="{{url}}" target="_blank" title="{{seller}}" class="J_MakePoint" data-point="tbcart.8.15">{{seller}}</a>{{/if}}{{#if host !== "SM"}}{{#if seller}}<span class="J_WangWang" data-items="{{uniqueId}}" data-icon="small" data-nick="{{seller}}" data-display="inline"></span>{{/if}}{{/if}}</div></div></div><div class="group-main"><div class="group-body">{{#each bundles as bundleId index}}<div id="J_OrderHolder_{{bundleId}}_{{page}}"{{#if index == bundles.length - 1}} class="last-order"{{/if}}></div>{{/each}}</div><div class="group-foot">{{#if coudan}}{{#if coudan.type !== -2 && coudan.type !== -1}}<div class="redemption-info"><div class="redemption-tip clearfix"><div class="amount">{{#if coudan.type == 1}}<span>\u60a8\u5df2\u4eab\u53d7{{#if coudan.priceLevelStr}}\u6ee1{{coudan.priceLevelStr}}\u5143{{/if}}\u514d\u8fd0\u8d39\u4f18\u60e0</span>{{#elseif coudan.type == 0}}<span>\u518d\u4e70{{coudan.priceStr}}\u5143\uff08\u603b\u91cd\u5c0f\u4e8e{{coudan.weightStr}}kg\uff09\u53ef\u514d\u8fd0\u8d39</span><a href="http://chaoshi.tmall.com" target="_blank">\u9a6c\u4e0a\u53bb\u51d1\u5355</a>{{/if}}</div></div></div>{{/if}}{{/if}}</div></div></div>'}},{requires:["node"]}),KISSY.add("cart/mods/group/groupTPL",function(a,b,c,d,e){var f=b.all,g="[groupTPL] ",h={};return{generate:function(b){var f;if(b){var i=b.type&&e[b.type]?b.type:"normal";h[i]=h[i]||c(e[i]),f=d(h[i],b,g)}else a.log(g+"error: group data cannot be recognized.");return f},render:function(b){var c=this.generate(b),d="J_GroupHolder_"+b.uniqueId,e=f("#"+d);return e&&0!==e.length?e.html(c):(a.log(g+"cannot find group holder for group:"+b.id),e=f('<div id="'+d+'" class="J_GroupHolder"></div>').html(c).appendTo("#J_OrderList")),a.log(g+"group "+b.id+" rendered."),e}}},{requires:["node","gallery/template/1.0/","../../utils/tpl/render","./tpl/group.tpl"]}),KISSY.add("cart/mods/group/groupData",function(a,b){b.all;return{deal:function(a){a.coudan&&(a.coudan.priceStr=Global.utils.toMoney(a.coudan.price),a.coudan.weightStr=a.coudan.weight/1e3)}}},{requires:["node"]}),KISSY.add("cart/mods/group/baseGroup",function(a,b,c,d){function e(b){a.mix(this,b),this._init()}var f=b.all;return a.augment(e,{_init:function(){d.deal(this.data),this.orders={},this.checkTimer=null,this.data.model=this.data.model||{},this.data.page=this.page||1,this.data.uniqueId=this.id,this._render()},_render:function(){this.groupHolderEl=c.render(this.data),this.groupEl=f("#J_Group_"+this.data.uniqueId,this.groupHolderEl)},isSelected:function(a){return a+1&&(this.data.model.isSelected=a),this.data.model.isSelected},isAllChecked:function(){var b=this,c=Global.getCart();if(c){var d=!0;return a.each(b.data.bundles,function(a){var e=c.orders[a+"_"+b.data.page];return e&&e.data.isValid===!0&&!e.isChecked()?(d=!1,!1):void 0}),d}return!1},check:function(a){if(this.checkTimer&&clearTimeout(this.checkTimer),a+1){this.isChecked=a,this.groupEl[(a?"add":"remove")+"Class"]("group-selected");var b=f(".J_CheckBoxGroup",this.groupEl).parent(".cart-checkbox");b&&b[(a?"add":"remove")+"Class"]("cart-checkbox-checked"),this.isSelected(a)}else{var c=this;this.checkTimer=setTimeout(function(){c.check(c.isAllChecked())},100)}},select:function(){var b=this,c=!0,d=Global.getCart();return d?(a.each(b.data.bundles,function(a){var e=d.orders[a+"_"+b.data.page];return e&&e.data.isValid===!0&&!e.select()?(c=!1,!1):void 0}),this.check(c),c):(this.check(!1),!1)},unselect:function(){var b=this,c=Global.getCart();c&&(a.each(b.data.bundles,function(a){var d=c.orders[a+"_"+b.data.page];d&&d.data.isValid===!0&&d.unselect()}),this.check(!1))},remove:function(){this.groupEl.remove(),this.removed=!0,this.data.model={}},removeOrder:function(b){var c=a.indexOf(b,this.data.bundles);c>-1&&this.data.bundles.splice(c,1),0===this.data.bundles.length&&this.remove()},checkTpl:function(a){var b=this;a&&b.mixData(a),b.removed===!0&&b._init(),b.removed=!1},mixData:function(b){var c=this;a.each(b.bundles,function(b){a.inArray(b,c.data.bundles)||c.data.bundles.push(b)})}}),e},{requires:["node","./groupTPL","./groupData"]}),KISSY.add("cart/mods/group/orderGroup",function(a,b,c){function d(b){a.mix(this,b),this.data.type="order",this._init()}b.all;return a.extend(d,c,{_init:function(){var a=this;d.superclass._init.call(a),Global.lazyload(a.groupEl,function(){a._initCheckbox()})},_initCheckbox:function(){var a=this;a.groupEl.delegate("click",".J_CheckBoxGroup",function(){a.isSelected()?a.unselect():a.select()})}}),d},{requires:["node","./baseGroup"]}),KISSY.add("cart/mods/order/baseOrder",function(a,b,c,d,e,f,g){function h(b){a.mix(this,b),this._init()}var i=b.all,j="[BaseOrder] ";return a.augment(h,{_init:function(){var a=this.data.groupId;a&&(Global.cartGroups=Global.cartGroups||{},Global.cartGroups[a]||(Global.cartGroups[a]=new g({data:Global.groupData[a],id:a,page:this.data.page}))),this.bundles={},this._render(),this._initBundles(),this._initCheckbox(),this.checkTimer=null,this.updateTimer=null,this.orderHolderEl.css("height","auto"),Global.lazyload(this.orderHolderEl,function(){this._initPromoHint(),this._initCoupon()},this)},_render:function(){this.orderHolderEl=c.render(this.data),this.orderEl=i("#J_Order_"+this.uniqueId,this.orderHolderEl)},_initBundles:function(){var b=this;a.each(this.data.bundles,function(a,c){var e=d.create({id:b.uniqueId+"_"+c,orderId:b.uniqueId,type:a.type||b.data.type,data:a,host:b.data.host,orderType:b.data.type,comboId:b.comboId,shopId:b.shopId,shopActId:b.shopActId,page:b.data.page});b.bundles[e.id]=e}),b.isAllSelected()&&b.isChecked(!0)},_initPromoHint:function(){var b=this;this.promoHintEls=i(".J_ScrollingPromoHint",this.orderEl),this.promoHintEls.length&&this.promoHintEls.each(function(c){new e(c,a.isFunction(b._promoHintCallback)?a.bind(b._promoHintCallback,b):void 0)})},_initCoupon:function(){var a=this;a.data.hasPriceVolume&&new f({orderEl:a.orderEl,sellerId:a.data.sellerId})},_initCheckbox:function(){var b=this;i(b.orderEl).delegate("click",".J_CheckBoxShop",function(a){a.preventDefault(),Global.resetTemp(),b.isChecked()?b.unselect():b.select(),Global.utils.makepoint("8.5")}),!a.isUndefined(b.isChecked())&&b.check(b.isChecked(),!1)},isChecked:function(a){return a+1&&(this.data.model.isChecked=a),this.data.model.isChecked},isAllSelected:function(){var b=!0;return a.each(this.bundles,function(c){a.each(c.items,function(a){return a&&a.isValid&&"redemption"!==a.data.type&&!a.isSelected()?(b=!1,!1):void 0})}),a.log("[Order] all bundles selected: "+b),b},check:function(b,c){if(this.checkTimer&&clearTimeout(this.checkTimer),b+1){a.log(j+"check status: "+b);var d=i(".J_CheckBoxShop",this.orderEl);d.prop("checked",b),this.data.isValid&&i(this.orderEl)[(b?"add":"remove")+"Class"]("all-select");var e=d.parent(".cart-checkbox");e&&e[(b?"add":"remove")+"Class"]("cart-checkbox-checked"),this.isChecked(b),b===!0&&a.each(this.bundles,function(a){a.isChecked(!0)}),Global.getCart().check(),this.data.groupId&&Global.cartGroups[this.data.groupId].check(),c!==!1&&Global.request({type:"check",orders:this}),Global.updateCart()}else{var f=this;f.checkTimer=setTimeout(function(){f.check(f.isAllSelected())},100)}},select:function(b){var c=!0;return this.data.isValid===!0?(a.each(this.bundles,function(b){return a.each(b.items,function(a){return a&&1===a.data.skuStatus?(c=!1,a.select(),!1):void 0}),c===!1?!1:void 0}),c===!0&&(a.each(this.bundles,function(a){return a.select()?void 0:(c=!1,!1)}),this.check(c,b))):this.check(!1),c},unselect:function(){this.check(!1),a.each(this.bundles,function(a){a.unselect()})},getTotalPrice:function(){var b=0;return a.each(this.bundles,function(a){b+=a.getTotalPrice()}),b},remove:function(){var a=this.uniqueId;this.orderEl.remove(),i("#J_Order_"+a).remove(),this.data.groupId&&Global.cartGroups[this.data.groupId].removeOrder(this.data.id),this.destroy()},update:function(b){b=a.isUndefined(b)?-1:b;var c=a.bind(function(){a.isEmptyObject(this.bundles)?(a.log(j+"order empty, remove."),this.remove()):Global.getCart().orders[this.uniqueId]=this
},this);this.updateTimer&&clearTimeout(this.updateTimer),0>b?c():this.updateTimer=setTimeout(c,b)},destroy:function(){a.each(this.bundles,function(a){a&&a.destroy&&a.destroy()}),Global.getCart().removeOrder(this.uniqueId),a.log(j+" order "+this.uniqueId+" destroyed."),Global.updateCart()},removeBundle:function(a){return delete this.bundles[a],this.update(),this},getItems:function(){var b=[];return a.each(this.bundles,function(c){a.each(c.items,function(a){a&&b.push(a)})}),b},getSelectedItemCartIds:function(){var b=[];return a.each(this.bundles,function(c){a.each(c.items,function(a){a&&a.isSelected()&&b.push(a.cartId)})}),b},mixData:function(b){var c=this;b.model=c.data.model,b.groupId=c.data.groupId,c.data=a.clone(b),c.data.bundles=[];var d=[];a.each(b.bundles,function(b){var e=b.id,f=c.bundles[e];if(f||a.each(b.orders,function(b){return a.each(c.bundles,function(c){return a.each(c.items,function(a,d){return d===b.cartId?(f=c,e=c.id,!1):void 0}),f?!1:void 0}),f?!1:void 0}),f){f.mixData(b),f.data.items=[];var g=[];a.each(b.orders,function(b){var c=b.cartId,d=f.items[c];a.isUndefined(d)?g.push(b):null===d?f.items[c]={data:b}:d.mixData(b)});var h=!0;a.each(f.items,function(a,b){var c=a?a.data:{cartId:b,type:"deleted"};f.data.items.push(c),!a||c.isValid!==!0||c.model&&c.model.isSelected===!0||(h=!1)}),f.data.model&&h===!1&&(f.data.model.isChecked=!1),g.length&&(f.data.items=f.data.items.concat(g))}else d.push(b)});var e=!0,f=!1;return a.each(c.bundles,function(a){var b=a.data;b.orders=b.items,delete b.items,c.data.bundles.push(b),a.isChecked()===!1&&(e=!1),b.valid&&(f=!0)}),c.data.isValid=f,d.length&&(c.data.bundles=c.data.bundles.concat(d),e=!1),c.data.model&&e===!1&&(c.data.model.isChecked=!1),c.data},getData:function(){var b=this,c=[];return a.each(b.bundles,function(a){c.push(a.getData())}),b.data.bundles=c,b.data},getItemByCartId:function(b){var c=this,d=!1;return a.each(c.bundles,function(a){return d=a.getItemByCartId(b),d?!1:void 0}),d},getOneCreateTime:function(){var b=this,c=0;return a.each(b.bundles,function(b){return a.each(b.items,function(a){return a&&a.data&&a.data.createTime?(c=a.data.createTime,!1):void 0}),!1}),c},correct:function(){}}),h},{requires:["node","./orderTPL","../bundle/bundleFactory","./promoScroll/promoScroll","./coupon/coupon","../group/orderGroup"]}),KISSY.add("cart/mods/order/comboDel/comboDel",function(a,b,c,d,e){function f(b){a.mix(this,b),this._init()}var g=b.all;return a.augment(f,{_init:function(){var a=this;g(a.orderEl).delegate("click",".J_ComboDel",function(b){b.preventDefault(),a._handle()})},_handle:function(){this._addHighlight(),d.confirm("\u786e\u5b9a\u8981\u5220\u9664\u9009\u4e2d\u7684\u5957\u9910\u5417\uff1f","\u63d0\u793a\u4fe1\u606f",void 0,a.bind(this._delOrder,this),a.bind(this._removeHighlight,this))},_addHighlight:function(){this.highlight||(this.highlight=new c(this.order.orderEl.one(".order-content"))),this.highlight.add()},_removeHighlight:function(){this.highlight&&this.highlight.remove()},_delOrder:function(a){var b=this,c=b.order;a=a||c.getItems(),Global.request({type:"deleteSome",orders:c,operate:a,success:function(d){b._removeHighlight(),d.success&&(e.record(a),c.remove(),Global.updateCart())},error:function(){}})}}),f},{requires:["node","../../../utils/highlight/highlight","../../../utils/dialog/dialog","../../cart/undo/undo"]}),KISSY.add("cart/mods/order/comboOrder",function(a,b,c,d,e){function f(b){a.mix(this,b),this._init()}var g=b.all;return a.extend(f,d,{_init:function(){var a=this;this.data.comboHeight=99*this.data.bundles[0].orders.length-1,f.superclass._init.call(this),Global.lazyload(this.orderEl,function(){new e({order:this,orderEl:this.orderEl}),a._initComboOp()},this),setTimeout(function(){g(".combo-order-op",a.orderEl).height(g(".order-content",a.orderEl).height())},0)},_initComboOp:function(){var a=this;a.opEl=g(".J_ComboOp",a.content),a.orderEl.on("swipe",function(b){if("left"===b.direction&&b.distance>=100){g(".J_ComboOp").hide();var c=g(".order-content",a.orderEl).height();a.opEl.css({height:c,"line-height":c+"px"}).show()}}).on("click",function(a){var b=g(a.target);b.hasClass("J_ComboOp")&&b.parent(".J_ComboOp")||g(".item-operations").hide()})}}),f},{requires:["node","ua","./baseOrder","./comboDel/comboDel"]}),KISSY.add("cart/mods/order/crossShopPromo/crossShopPromo",function(a){function b(b){a.mix(this,b),this._init()}return a.augment(b,{_init:function(){var a=this;Global.listen("requestSuccess",function(b){var c=b[a.order.shopId];c&&a._updateSaveInfo(c)})},_updateSaveInfo:function(b){var c=this.order,d=c.orderEl,e=a.one("#J_SaveInfo_"+c.shopId);e&&(b?(e.html(b),d.show(),d.removeClass("hide-border")):(d.hide(),d.addClass("hide-border")))}}),b}),KISSY.add("cart/mods/order/crossShopOrder",function(a,b){function c(b){a.mix(this,b),this._init()}return a.extend(c,b,{_init:function(){c.superclass._init.call(this)},_promoHintCallback:function(){this.promoHintEls.each(function(a){a.parent(".act-promo").width(a.outerWidth())})}}),c},{requires:["./baseOrder","./crossShopPromo/crossShopPromo"]}),KISSY.add("cart/mods/order/redemption/list",function(a,b,c,d,e,f){function g(b){a.mix(this,b),this._init()}var h=b.all,i='<div class="redemption-carousel redemption-type-{{data.type}}"><div class="panels"><ul class="panel clearfix ks-switchable-content">{{#each data.realViewItems as curData}}<li class="redemption-item"><div class="item-wrapper"><div class="pic s100"><a href="{{curData.link}}" target="_blank"><img src="{{curData.img}}_80x80.jpg" /></a></div><div class="item-info"><p class="title"><a href="{{curData.link}}" target="_blank" title="{{curData.title}}">{{curData.shortTitle}}</a></p><p class="price"><span class="origin-price">&yen;<em>{{curData.originPrice}}</em></span><span class="promo-price">&yen;<em>{{curData.promoPrice}}</em></span></p><div class="btns"><a href="#" class="J_SelectSku select-sku" data-itemid="{{curData.itemId}}" data-url="{{curData.api}}"><span>{{#if data.type === "freegift"}}\u9886\u53d6\u8d60\u54c1{{#else}}\u6362\u8d2d{{/if}}</span></a><div class="msg hidden-msg"><p class="error J_ErrorBox"></p></div></div></div></div></li>{{/each}}</ul></div></div>{{#if hasPages}}<div class="trigger-bar "><a href="javascript:void(0);" title="\u4e0a\u4e00\u9875" class="prev">\u4e0a\u4e00\u9875</a><a href="javascript:void(0);" title="\u4e0b\u4e00\u9875" class="next">\u4e0b\u4e00\u9875</a></div>{{/if}}',j="redemption-expanded",k="redemption-selected";return a.augment(g,{_init:function(){{var b=this;b.trigger}a.mix(b,{isRendered:!1}),b.isRendered?h(b.container).parent().addClass(j):b._request()},_isRedemptionAble:function(){var a=this.rowBox.one(".J_Remain");return parseInt(a.text(),10)>0},_initPage:function(){var b=this;a.use("gallery/switchable/1.3.1/",function(a,c){var d=h(b.container).one(".redemption-carousel"),e=d.width(),f=d.one(".redemption-item"),g=f.outerWidth(),i=Math.floor(e/g),j=new c.Carousel(b.container,{effect:"scrollx",easing:"easeOutStrong",prevBtnCls:"prev",nextBtnCls:"next",disableBtnCls:"disable",circular:!0,viewSize:[e],steps:i});j.on("beforeSwitch",function(){h(b.container).parent().removeClass("sku-expanded").one(".J_SkuPanel").html("").hide()})})},_initSku:function(){var b=this,c="";h(b.container).delegate("click",".J_SelectSku",function(d){d.preventDefault();var g=h(d.currentTarget),i=g.attr("data-itemid"),j=h(this).parent();j.hasClass("sku-expanded")&&c===i?j.removeClass("sku-expanded").one(".J_SkuPanel").html("").hide():("freegift"!==b.type&&(j.addClass("sku-expanded").all(".redemption-item").removeClass(k),g.parent(".redemption-item").addClass(k)),b.sku=new f({container:j.one(".J_SkuPanel"),itemId:i,errorBox:"freegift"===b.type?g.parent().one(".J_ErrorBox"):"",itemType:b.type,cancel:function(){h(this.container).slideUp(.3,function(){j.removeClass("sku-expanded").all(".redemption-item").removeClass(k)})},autoHideError:"freegift"===b.type?3:0,hasAmount:"freegift"!==b.type,defaultAmount:"freegift"===b.type?1:0,rendered:function(){if(h(this.container).show(),6===e.ie){var a=h("li",this.container);setTimeout(function(){a.css("overflow","hidden")},10)}},addToCart:a.bind(b._addToCart,b)})),c=i})},_addToCart:function(a){var b=this;Global.request({type:"addExtraItem",operate:{quantity:a.quantity,cartId:0,skuId:a.outer_id,itemId:a.item_id,createTime:b.order.getOneCreateTime(),rwType:b.type},quantity:a.quantity,orders:b.order,skuid:a.outer_id,silent:!0,extraParams:{extSource:b.extSource},globalParams:{tpId:b.tpId},success:function(){b.sku._hideErrorInfo()},error:function(a){b.sku._showErrorInfo(a.error.errorMessage)}})},_request:function(){var b=this;a.io({type:"get",url:Global.cfg.api.redemption,dataType:"json",data:{cartIds:b.order.getSelectedItemCartIds().join(","),ct:c.get("t")},success:function(c){a.isPlainObject(c)&&c.status&&a.isArray(c.list)&&c.list.length&&(b._render(c.list[0]),b.extSource=c.extSource||"1")}})},_render:function(a){var b=this,c=b._formatData(a),e=c&&c.realViewItems&&c.realViewItems.length>4,f=d(i).render({data:c,hasPages:e});b.container.html(f).parent().addClass(j),b.isRendered=!0,e&&(b.container.addClass("multi-pages"),b._initPage()),b._initSku()},_formatData:function(b){return a.each(b.realViewItems,function(a){var b=a.title;a.shortTitle=b.length>10?b.substring(0,10)+"...":b,a.img=a.img.replace(/_(sum|\d{2,5}x\d{2,5})\.jpg$/,"")}),b}}),g},{requires:["node","cookie","gallery/template/1.0/","ua","../../../utils/sku/sku"]}),KISSY.add("cart/mods/order/redemption/redemption",function(a,b,c,d){function e(b){a.mix(this,b),this._init()}var f=b.all,g="lastRedemptionCartId";return a.augment(e,{_init:function(){this._initRedemptionList()},_initRedemptionList:function(){new d({trigger:this.trigger,isAutoRender:this._isContainLastedAddItem(),order:this.order,container:f(".J_RedemptionList",this.order.orderEl),type:this.type,tpId:this.tpId})},_isContainLastedAddItem:function(){return null},_scrollToLastedAddItem:function(a){c.scrollTop(c.offset(a).top),Cookie.remove(g)},_updateRedeemedQuantity:function(a,b){var c=a.one(".J_Remain"),d=a.one(".J_RedemptionList");c&&c.html(b),d&&d[b?"removeClass":"addClass"]("disabled")},_updateRedemptionAmount:function(a,b){var c=a.one(".J_TotalRedemptionAmount");c&&c.html(b)},_updateShopTotalPrice:function(a,b){var c=a.one(".J_TotalPrice");c&&c.html(b)},_updateRedemptionItemStatus:function(b){var c=this;a.each(b,function(a,b){var d=c.order.items[b];if(d){var e=d.itemEl;d.redemptionId=a.promoId,e[a.isValid?"removeClass":"addClass"]("disable")}})}}),e},{requires:["node","dom","./list"]}),KISSY.add("cart/mods/order/redemptionOrder",function(a,b,c,d,e,f){function g(b){a.mix(this,b),this._init()}var h=b.all,i="redemption-expanded";return a.extend(g,c,{_init:function(){var a=this;a.data.model=a.data.model||{},a.data.model.totalShopPrice=parseFloat(a.getTotalPriceFromData(a.data)),a.updateTotalPrice(),g.superclass._init.call(a),h(a.orderEl).delegate("click",".J_Redemption",function(b){b.preventDefault();var c=h(b.currentTarget),e=c.parent(".redemption-info");c.hasClass("entry-disabled")?(a.redemption=null,e.one(".J_RedemptionList").html("")):(e.hasClass(i)?e.removeClass(i+" sku-expanded"):a.redemption?e.addClass(i):a.redemption=new d({order:a,trigger:b.target,type:a.data.redemption.type,tpId:a.data.redemption.tpId}),Global.utils.makepoint("8.25"))})},getTotalPriceFromData:function(b){var c=0;return a.each(b.bundles,function(b){a.each(b.orders,function(a){a.model&&a.model.isSelected===!0&&!a.extraItemInfo&&(c+=a.price.sum)})}),c},updateTotalPrice:function(){var a=this;a.data.model.totalShopPriceStr=Global.utils.toMoney(a.data.model.totalShopPrice)},correct:function(){var a=this;a.isChecked()===!1&&(a.data.model.totalShopPrice=a.getTotalPrice(),a.updateTotalPrice(),f.dealRedemptionData(a.data),e.renderRedemption(a.data))}}),g},{requires:["node","./baseOrder","./redemption/redemption","./orderTPL","./orderData"]}),KISSY.add("cart/mods/order/orderFactory",function(a,b,c,d,e,f){return{create:function(g){var h,i;switch(g.shopId=0,g.comboId=0,g.shopActId=0,g.data.extraItems&&(g.data.type="redemption"),g.data.host&&Global.globalData&&Global.globalData[("B"===g.data.host?"b":"c")+"ShopsCount"]++,g.data=b.deal(g.data),g.data.type){case"combo":g.comboId=g.id,i=a.merge(g,{}),h=new d(i);break;case"act":g.shopActId=g.id,i=a.merge(g,{}),h=new e(i);break;case"redemption":g.shopId=g.id,i=a.merge(g,{}),h=new f(i);break;default:g.shopId=g.id,h=new c(g)}return h.level="order",h}}},{requires:["./orderData","./baseOrder","./comboOrder","./crossShopOrder","./redemptionOrder"]}),KISSY.add("cart/mods/cart/floatbar/totalpay",function(a,b){var c=b.all;return{calc:function(b){if(!a.isNumber(b)||0>b)return!1;var d=Global.utils.toMoney(b);return a.log("cal: "+d),a.each([c("#J_SmallTotal"),c("#J_Total")],function(a){a.html(d)}),!0}}},{requires:["node"]}),KISSY.add("cart/mods/cart/select/select",function(a,b,c){var d=b.all,e="[Select] ",f="select-all-disabled",g="select-all-exceeded",h="selected",i="cart-checkbox-checked",j=!1;return{init:function(){return j===!0?!0:(d("#J_Cart").delegate("click",".J_SelectAll",function(b){b.preventDefault(),Global.resetTemp();var i=d(b.currentTarget);switch(i.hasClass(f)?a.log(e+"cart empty."):i.hasClass(g)?c.show("\u60a8\u8d2d\u7269\u8f66\u4e2d\u7684\u5546\u54c1\u591a\u4e8e50\u4ef6\uff0c\u4e0d\u53ef\u8fdb\u884c\u5168\u9009\u64cd\u4f5c\u3002",{elCls:"select-all-tips",align:{node:i.one("span"),points:["tc","bl"],offset:[-23,-2]}}):Global[(i.hasClass(h)?"un":"")+"selectAll"](),parseInt(i.attr("id").replace("J_SelectAll",""),10)){case 1:Global.utils.makepoint("8.4");break;case 2:Global.utils.makepoint("8.24")}}),d(window).on("scroll",function(){c.hide()}),j=!0,Global.cfg.tpId&&setTimeout(Global.selectAll,0),!0)},update:function(b,c){var e=[d("#J_SelectAll1"),d("#J_SelectAll2")];a.each(e,function(a){a[(0===b.length?"add":"remove")+"Class"](f);var e=c.length===b.length&&b.length<=50&&b.length>0;a[(e?"add":"remove")+"Class"](h),d(".cart-checkbox",a)[(e?"add":"remove")+"Class"](i),d("input",a).prop("checked",e)})},toggle:function(b){if(b+1){var c=[d("#J_SelectAll1"),d("#J_SelectAll2")];a.each(c,function(a){a.removeClass(g+" "+f)[(b?"add":"remove")+"Class"](h)})}},destroy:function(){j=!1}}},{requires:["node","../../../utils/tip/tip"]}),KISSY.add("cart/mods/cart/floatbar/tpl/floatbar.tpl",function(a,b,c,d,e,f,g){function h(b,c,d){a.use("gallery/switchable/1.3.1/",function(a,e){var f=a.mix({markupType:1,effect:"scrollx",easing:"easeOutStrong",circular:!0,prevBtnCls:"prev",nextBtnCls:"next",panelCls:"J_Item",disableBtnCls:"disable"},c);t=new e.Carousel(b,f),t.on("switch",function(a){Global.temp.floatbarCurIndex=a.currentIndex}),d&&d(t)})}var i="[Template FloatBar] ",j=b.all,k='<div class="float-bar-wrapper"><div id="J_SelectAll2" class="select-all select-all-disabled J_SelectAll"><div class="cart-checkbox"><input class="J_CheckBoxShop" id="J_SelectAllCbx2" type="checkbox" name="select-all" value="true" /><label for="J_SelectAllCbx2">\u52fe\u9009\u8d2d\u7269\u8f66\u5185\u6240\u6709\u5546\u54c1</label></div>&nbsp;\u5168\u9009</div><div class="operations"><a href="#" hidefocus="true" class="J_DeleteSelected">\u5220\u9664</a><a href="#" hidefocus="true" class="J_ClearInvalid hidden">\u6e05\u9664\u5931\u6548\u5b9d\u8d1d</a><a href="#" hidefocus="true" class="J_BatchFav">\u79fb\u5165\u6536\u85cf\u5939</a><a href="#" hidefocus="true" class="J_BatchShare">\u5206\u4eab</a><a href="#" hidefocus="true" class="J_BatchCompare" target="_blank" data-tips="\u81f3\u5c11\u8981\u9009\u62e9\u4e24\u4ef6\u5b9d\u8d1d\u624d\u80fd\u8fdb\u884c\u5bf9\u6bd4" data-point="tbcart.8.41">\u5f00\u59cb\u5bf9\u6bd4</a></div><div class="float-bar-right"><div id="J_ShowSelectedItems" class="amount-sum"><span class="txt">\u5df2\u9009\u5546\u54c1</span><em id="J_SelectedItemsCount">0</em><span class="txt">\u4ef6</span><div class="arrow-box"><span class="selected-items-arrow"></span><span class="arrow"></span></div></div><div id="J_CheckCOD" class="check-cod"><span class="icon-cod"></span><span class="s-checkbox J_CheckCOD"></span>\u8d27\u5230\u4ed8\u6b3e</div><div class="pipe"></div><div class="price-sum"><span class="txt">\u5408\u8ba1(\u4e0d\u542b\u8fd0\u8d39)\uff1a</span><strong class="price">&yen;<em id="J_Total">0.00</em></strong></div><div class="btn-area"><a href="javascript:void(0)" id="J_Go" class="submit-btn submit-btn-disabled" aria-label="\u8bf7\u6ce8\u610f\u5982\u679c\u6ca1\u6709\u9009\u62e9\u5b9d\u8d1d\uff0c\u5c06\u65e0\u6cd5\u7ed3\u7b97"><span>\u7ed3&nbsp;\u7b97</span><b></b></a></div></div></div>',l='<div id="J_SelectedItems" class="group-wrapper group-popup hidden"><div id="J_SelectedItemsList" class="group-content"></div><span class="arrow"></span></div>',m='{{#if item.isRedemption === true}}<span class="btn-cancel-select">\u6362\u8d2d\u5b9d\u8d1d</span>{{#else}}<a href="javascript:void(0)" class="btn-cancel-select J_CancelSelect" data-index="{{index}}" data-cartid="{{item.cartId}}"{{#if item.comboId}} data-comboid="{{item.comboId}}"{{/if}}>\u53d6\u6d88\u9009\u62e9</a>{{/if}}',n='<div class="item-lists single-group carousel"><div class="trigger-bar {{#if showCarousel !== true}} hidden{{/if}}"><a href="javascript:void(0);" title="\u4e0a\u4e00\u9875" class="prev">\u4e0a\u4e00\u9875</a><a href="javascript:void(0);" title="\u4e0b\u4e00\u9875" class="next">\u4e0b\u4e00\u9875</a></div><div class="scrollable-content clearfix"><div class="ks-switchable-content">{{#each items as item index}}<div class="s-item J_Item"><a href="{{item.url}}" class="item-pic"><img src="{{item.data.pic}}_80x80.jpg" alt="{{item.title}}" /></a>'+m+"</div>{{/each}}</div></div></div>",o='<div class="groups-list {{#if !allExpand}}group-expand-one{{/if}}">{{#each groups as group}}<div id="J_Group_{{group.name}}" class="group group-{{group.name}} {{#if group.expand}} group-expanded {{/if}}" {{#if group.groupWrapperWidth}} style="width: {{group.groupWrapperWidth}}px"{{/if}}><div class="group-info"><div class="group-title">{{group.title}}<em class="number">{{group.items.length}}</em>\u4ef6</div><div class="group-total price"><em>{{group.totalStr}}</em></div><div class="group-op"><a href="javascript:void(0);" class="J_GroupOp J_GroupCheckout group-checkout">\u7ed3\u7b97</a><a href="javascript:void(0);" class="J_GroupOp J_GroupExpand group-expand">\u5c55\u5f00</a></div><span class="pipe"></span></div><div class="group-items {{#if group.useSlide}} carousel {{/if}}" {{#if group.itemsWidth}} style="width: {{group.itemsWidth}}px"{{/if}}>{{#if group.useSlide}}<span class="prev">\u4e0a\u4e00\u9875</span><span class="next">\u4e0b\u4e00\u9875</span><div class="scroller"><div class="ks-switchable-content">{{/if}}{{#each group.items as item index}}<div class="g-item J_Item"><a href="{{item.url}}" class="item-pic"><img src="{{item.data.pic}}_80x80.jpg" alt="{{item.title}}" /></a>'+m+"</div>{{/each}}{{#if group.useSlide}}</div></div>{{/if}}</div></div>{{/each}}</div>",p=null,q=null,r=null,s=null,t=null;return{renderGroup:function(b){a.isArray(b)&&b.length>1?this.renderMultiGroups(b):this.renderSingleGroup(b[0].items)},renderSingleGroup:function(a){var b=j("#J_SelectedItemsList");r||(r=f(n));var c=8,d=a.length>c,e=g(r,{items:a,showCarousel:d});b.html(e),d?h(b.one(".item-lists"),{steps:c}):Global.temp.floatbarCurIndex=void 0},renderMultiGroups:function(b,c){var d=b.itemsByGroup;s||(s=f(o));var k=8-b.groups.length,l=b.items.length<k;if(!c){var m=0;a.each(d,function(a){a.items.length>m&&(m=a.items.length,c=a.name)})}a.each(d,function(b){b.totalStr=parseFloat(b.total/100).toFixed(2),b.expand=l?!0:b.name===c,b.useSlide=b.items.length>k,b.itemsWidth=0,b.groupWrapperWidth=0,b.expand===!0&&e.ie<8&&(a.log(i+" group "+b.name+" expand"),b.itemsWidth=90*b.items.length,b.groupWrapperWidth=b.itemsWidth+42)});var n=g(s,{groups:d,allExpand:l}),p=j("#J_SelectedItemsList").html(n);if(!l){var q=p.one(".group-expanded"),r=q.attr("id").replace("J_Group_",""),t=q.one(".group-items"),u=t.one(".g-item"),v=k*u.outerWidth();a.log(i+"fix group "+r+" width"),t.width(v),e.ie<8&&q.width(v+42),d[r].items.length>k?h(t,{steps:k,viewSize:[v]}):Global.temp.floatbarCurIndex=void 0}6===e.ie&&setTimeout(function(){j(".group-info",p).hide().show()},100)},render:function(){var a=j("#J_FloatBar");return p=p||f(k),q=q||f(l),a.html(g(p,{})).prepend(j(g(q))),a},removeItem:function(a,b){t?t.remove({index:a,callback:b}):b&&b()}}},{requires:["node","dom","event","ua","gallery/template/1.0/","../../../../utils/tpl/render"]}),KISSY.add("cart/mods/cart/floatbar/delete",function(a,b,c,d){var e=(b.all,"[BatchDel] ");return{batchDel:function(b,c){var f=[];a.each(b,function(b){if(b){var c=b.getOrder();a.inArray(c,f)||f.push(c)}}),Global.request({type:"deleteSome",operate:b,orders:f,success:function(f){a.log(e+" result: "+f.success),c!==!0&&d.record(b),a.each(b,function(a){a&&a.remove()})}})},deleteSelected:function(a){var b=this;return a.length?(c.confirm("\u786e\u8ba4\u8981\u5220\u9664\u8fd9\u4e9b\u5b9d\u8d1d\u5417\uff1f","\u5220\u9664\u5b9d\u8d1d",void 0,function(){b.batchDel(a)}),!0):(c.alert("\u8bf7\u9009\u62e9\u5b9d\u8d1d"),!1)},clearInvalid:function(a){var b=this;return a.length?(c.confirm("\u786e\u8ba4\u8981\u6e05\u9664\u8fd9\u4e9b\u5b9d\u8d1d\u5417\uff1f","\u5220\u9664\u5b9d\u8d1d",void 0,function(){b.batchDel(a)}),!0):(c.alert("\u6682\u65f6\u6ca1\u6709\u5931\u6548\u7684\u5b9d\u8d1d"),!1)}}},{requires:["node","../../../utils/dialog/dialog","../undo/undo"]}),KISSY.add("cart/mods/cart/floatbar/go",function(a,b,c){function d(c){var d=c.params||{},e=b.create("<form>"),f=c.api||h.normal;e.method=c.submitType||"post",e.action=f;for(var i in d){var j=b.create("<input>");j.name=i,j.value=d[i],e.appendChild(j)}b.hide(e),document.body.appendChild(e);var k="";switch(f){case h.HK:k=g.tmallIntlLoginAPI;break;case h.yiyao:k=g.tmallYiYaoLoginAPI;break;case h.tmall:k=g.tmallBuyLoginAPI;break;case h.tmallOld:k=g.tmallStayBuyLoginAPI}k?(k+="?from=cart",a.getScript(k,{success:function(){e.submit()},error:function(){e.action=h.normal,e.submit()},timeout:10})):e.submit()}function e(b){var d=[],e=[],f={},g={};a.each(b.items,function(a){var b=a.data,c=b.cartId,h=b.attr||"",i=h?"":";";b.extraItemInfo&&b.extraItemInfo.promotionIdVal&&(h+=i+"promotionIdVal:"+b.extraItemInfo.promotionIdVal+";"),d.push({cartId:c,itemId:b.itemId,skuId:b.skuId,quantity:a.getQuantity(),createTime:b.createTime,attr:h}),e.push(c),f[b.sellerId]=1;var j=a.getOrder();!j||"combo"!==j.type||j.isChecked()&&j.data.isValid||(g[b.cartId]=1)});var i=[];a.each(f,function(a,b){i.push(b)});var j=[];for(var k in g)j.push(k);var l={hex:"n",cartId:e,sellerid:i.join(","),cart_param:c.stringify({items:d}),unbalance:b.unbalance||"",delCartIds:e.concat(j).join(","),use_cod:b.isCod===!0||a.isUndefined(b.isCod)&&"cod"===b.group?1:"false",buyer_from:"cart",page_from:"cart"};return Global.cfg.tpId&&(l.tpId=Global.cfg.tpId),{params:l,api:h.tmall}}function f(b){var d=[],e=[],f=[],g=[],i=[],j=[],k=[],l="",m=[],n=[],o=[];a.each(b.items,function(e){if(e){var h=e.data;switch(h.type){case"redemption":var p=[h.cartId,h.itemId,e.getQuantity(),h.skuId,h.extraItemInfo.promotionIdVal];h.cartActiveInfo&&h.cartActiveInfo.cartBcParams&&p.push(h.cartActiveInfo.cartBcParams),p.push(h.extraItemInfo.type),g.push(p.join("|"));break;default:var q=[h.cartId,h.itemId,e.getQuantity(),h.skuId,h.sellerId,e.comboId||0,e.getAttr("cbopt")||0,h.tbComboId||0,h.cartActiveInfo&&h.cartActiveInfo.cartBcParams?h.cartActiveInfo.cartBcParams:"",h.toBuyInfo&&!a.isEmptyObject(h.toBuyInfo)?encodeURIComponent(c.stringify(h.toBuyInfo)):""];d.push(q.join("_")),j.push(h.cartId),h.isCod&&k.push(h.cartId),h.verticalParam&&i.push(h.cartId+"|"+h.verticalParam);var r=e.getAttr("ck");(r||h.services)&&m.push(h.cartId);var s=e.getAttr("from");s&&f.push(h.cartId),h.flushingPicId&&n.push(h.flushingPicId)}""===l&&(l=b.group||e.group);var t=e.getAttr("lottery");t&&o.push(h.cartId+":"+t)}});var p={},q="post",r=h.normal;switch(l.substr(0,2)){case"HK":p={cartId:j.join(",")},q="get",r=h.HK;break;default:p={item:d.join(","),buyer_from:b.buyer_from||"cart"},e.length&&(p.channelInfo=e.join(",")),f.length&&(p.cnData=f.join(",")),g.length&&(p.premium_item=g.join(",")),k.length&&(b.isCod===!0||a.isUndefined(b.isCod)&&"cod"===b.group)&&(p.use_cod=1),i.length&&(p.verticalParams=i.join(",")),n.length&&(p.flushingPictureServiceId=n.join("|")),m.length&&(p.serviceCartIds=m.join(":")),o.length&&(p.awardIds=o.join(","))}return{params:p,api:r,submitType:q}}var g=Global.cfg.api,h={normal:g.goAPI,HK:g.tmallIntlBuyAPI,tmall:g.tmallBuyAPI||"http://buy.tmall.com/order/confirm_order.htm",tmallOld:g.tmallStayBuyAPI||"http://stay.buy.tmall.com/order/confirm_order.htm",yiyao:g.tmallYiYaoBuyAPI||"http://buy.tmall.com/order/confirm_order.htm"};return{go:function(b){var c,g=0,i=0,j=0,k=0,l=0;a.each(b.items,function(a){if(a&&a.data)switch("HK"===a.data.host?a.data.toBuy="HK":"YY"===a.data.host&&(a.data.toBuy="YY"),a.data.toBuy){case"noGray":g++;break;case"tmall":i++;break;case"YY":k++;break;case"HK":l++;break;default:j++}});var m="taobao";if(0===j&&(l>0?m="tmallHK":g>0&&0===i?m="tmallOld":0===g&&i>0?m="tmall":k>0&&(m="YY")),"taobao"!==m)try{c=e(b),"tmallOld"===m?c.api=h.tmallOld:"YY"===m?c.api=h.yiyao:"tmallHK"===m&&(c.params.tmallhk=!0,c.api=h.HK)}catch(n){c=null,Global.utils.jstracker("tmall order data error","go.js","","fatal")}c?c.params&&b.sourceTime&&(c.params.source_time=b.sourceTime):c=f(b),d(c)}}},{requires:["dom","json"]}),KISSY.add("cart/mods/cart/floatbar/batch-fav",function(a,b,c,d,e,f){var g="[batch-fav] ";return{favTriggerEl:null,batchFav:function(c,e,h){var i=this;if(0===c.length)f.alert("\u8bf7\u9009\u62e9\u5b9d\u8d1d");else{var j=[];i.favTriggerEl=e,a.each(c,function(a){a&&j.push(a.itemId+":"+a.getSkuId())});var k={itemSkuList:j.join(","),_tb_token_:b.val("#_tb_token_")};d.jsonp(Global.cfg.api.favorite,k,function(b){a.isObject(b)&&(a.log(g+" result: "+b.result.status),e&&i._showTips(c,b.result.status,b.result.message),h&&h())})}},_showTips:function(c,d,f){b.remove("#fav-lay-prefix-batch");var g,h=this,i=b.create('<div id="fav-lay-prefix-batch" class="batch-fav-box"></div>');g=d?b.create('<div class="msg batch-fav-status"><p class="ok">\u6210\u529f\u79fb\u81f3\u6536\u85cf\u5939</p></div>'):8===f.errorCode?b.create('<div class="msg batch-fav-status"><p class="attention">'+f.error+"</p></div>"):b.create('<div class="msg batch-fav-status"><p class="error">'+f.error+"</p></div>"),i.appendChild(g),b.insertAfter(i,h.favTriggerEl),d&&e.batchDel(c,!0),a.later(function(){b.remove(i)},2e3)}}},{requires:["dom","event","ajax","./delete","../../../utils/dialog/dialog"]}),KISSY.add("cart/mods/cart/floatbar/share",function(a,b,c){return{share:function(b){var d=[];a.each(b,function(a){a&&d.push(a.itemId)}),d.length?a.getScript("http://a.tbcdn.cn/p/snsdk/core.js",function(){SNS.login(function(){SNS.ui("batchshare",{itemIds:d,client_id:"77",callback:{init:function(){},success:function(){},failure:function(){}}})})}):c.alert("\u60a8\u8fd8\u6ca1\u6709\u9009\u62e9\u4efb\u4f55\u5b9d\u8d1d")}}},{requires:["node","../../../utils/dialog/dialog"]}),KISSY.add("cart/mods/cart/floatbar/batch-compare",function(a,b){function c(a,b,c){var d="http://pk"+Global.utils.tbPath+"/index.htm?items=";a.attr("href",b?d+b:"javascript:void(0)").attr("data-tips",c||"")}b.all;return{update:function(b,d){var e=[];d.length>8?c(b,"","\u6700\u591a\u652f\u63018\u4ef6\u5b9d\u8d1d\u8fdb\u884c\u5bf9\u6bd4\uff0c\u60a8\u5df2\u9009\u62e9"+d.length+"\u4ef6"):d.length<2?c(b,"","\u81f3\u5c11\u8981\u9009\u62e9\u4e24\u4ef6\u5b9d\u8d1d\u624d\u80fd\u8fdb\u884c\u5bf9\u6bd4\uff01"):(a.each(d,function(a){var b=a.data;e.push(b.itemId+"_"+b.skuId+"_"+b.cartId)}),c(b,e.join(",")))}}},{requires:["node"]}),KISSY.add("cart/mods/cart/floatbar/floatbar",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p,q,r,s=b.all,t="[FloatBar] ",u=!1,v=function(){var a=d.viewportHeight(),b=d.scrollTop(),c=d.offset(q).top,e=c-a-b;e>=0?(p.replaceClass("default","fixed-bottom"),p.css("position","fixed"),d.insertAfter(p,q)):(p.replaceClass("fixed-bottom","default"),p.css("position","static"),d.append(p,q))},w=function(){if(u===!1||6===c.ie)return!1;var a=s(q).offset();return a?(r=a.top,v()):void 0};return{init:function(){if(u===!0)return!1;p=s("#J_FloatBar"),q=s("#J_FloatBarHolder");var b=this;return b.floatbarEl=f.render(),b.popupEl=s("#J_SelectedItems",b.floatbarEl),b.selectedItemsCountEl=s("#J_SelectedItemsCount",b.floatbarEl),b.showSelectedItemsEl=s("#J_ShowSelectedItems",b.floatbarEl),b.goEl=s("#J_Go",b.floatbarEl),b.smallGoEl=s("#J_SmallSubmit"),b.checkCodEl=s("#J_CheckCOD",b.floatbarEl),b.popupArrowEl=s(".arrow",b.popupEl),b.floatbarArrowEl=s(".arrow",b.showSelectedItemsEl),b.clearInvalidEl=s(".J_ClearInvalid",b.floatbarEl),Global.listen("G_ShowClearInvalid",function(){b.clearInvalidEl.show()}),b.showSelectedItemsEl.on("click",function(a){a.preventDefault(),b.togglePopup(),b.update(Global.getCart().getSelectedItemsAndGroups(),!0),Global.utils.makepoint("8.22")}),s(document).delegate("click",".submit-btn",function(c){c.preventDefault();var d=s(c.currentTarget);if(d.hasClass("submit-btn-disabled"))return m.show("\u8bf7\u52fe\u9009\u60a8\u9700\u8981\u7ed3\u7b97\u7684\u5b9d\u8d1d",{align:{node:d,points:["tl","bl"]},elCls:"submit-tips"}),void 0;if(d.hasClass("combine-not-supported")||d.hasClass("need-separate"))return b.showPopup(),void 0;var e={items:Global.getCart().getSelectedItems(),isCod:b.checkCodEl.one(".J_CheckCOD").hasClass("s-checkbox-selected"),sourceTime:a.now()};switch(d.attr("id")){case"J_Go":Global.utils.makepoint("8.2");break;case"J_SmallSubmit":Global.utils.makepoint("8.1")}return e.items&&e.items.length?(i.go(e),void 0):(n.alert("\u8bf7\u9009\u62e9\u5b9d\u8d1d"),!1)}),s(b.floatbarEl).delegate("click",".J_CheckCOD",function(a){a.preventDefault(),s(a.target).toggleClass("s-checkbox-selected"),b.update(Global.getCart().getSelectedItemsAndGroups()),Global.utils.makepoint("8.21")}).delegate("click",".J_ClearInvalid",function(a){a.preventDefault(),h.clearInvalid(Global.getCart().getTruelyInvalidItems()),Global.utils.makepoint("8.18")}).delegate("click",".J_DeleteSelected",function(a){a.preventDefault(),h.deleteSelected(Global.getCart().getSelectedItems()),Global.utils.makepoint("8.17")}).delegate("click",".J_BatchFav",function(a){a.preventDefault(),j.batchFav(Global.getCart().getSelectedItems(),s(a.currentTarget)),Global.utils.makepoint("8.20")}).delegate("click",".J_CancelSelect",function(a){a.preventDefault();var c=s(a.currentTarget),d=c.attr("data-comboid");if(d){var e=Global.getCart().getOrderById(d);e&&e.unselect()}else{var f=c.attr("data-cartid"),g=Global.getCart().getItemByCartId(f);g&&g.unselect()}b.floatbarEl.data("carousel-index",c.attr("data-index")),b.update(Global.getCart().getSelectedItemsAndGroups()),Global.utils.makepoint("8.23")}).delegate("click",".J_BatchShare",function(a){a.preventDefault(),k.share(Global.getCart().getSelectedItems()),Global.utils.makepoint("8.19")}).delegate("click",".J_BatchCompare",function(a){var b=s(a.currentTarget),c=b.attr("data-tips");c&&(a.preventDefault(),m.show(c,{align:{node:b,points:["tl","bl"],offset:[-20,10]},elCls:"submit-tips"}))}),6===c.ie?b.floatbarEl.delegate("mouseenter mouseleave",".J_Item",function(a){a.stopPropagation(),s(a.currentTarget).toggleClass("item-hover")}):a.ready(function(){var a=p.offset();a&&(r=a.top),s(window).on("scroll",function(){v(),b.hidePopup()},this),v()}),u=!0,!0},relocate:w,showPopup:function(){var a=this;if(a.isPopupOpened===!0)return!0;a.floatbarEl.addClass("show-selected-items"),a.popupEl.show();var b=a.floatbarArrowEl.offset(),d=a.floatbarEl.offset();return b&&d&&a.popupArrowEl.css("left",b.left-d.left),a.isPopupOpened=!0,a.goEl.addClass("combine-not-supported").one("span").html(o("\u9700\u8981\u5206\u7ec4\u7ed3\u7b97")),6===c.ie&&setTimeout(function(){s(".group-info",a.popupEl).hide().show()},100),!0},hidePopup:function(){var a=this;return a.isPopupOpened===!1?!1:(a.floatbarEl.removeClass("show-selected-items"),a.popupEl.hide(),a.isPopupOpened=!1,a.goEl.removeClass("combine-not-supported").one("span").html(o("\u7ed3&nbsp;\u7b97")),!1)},togglePopup:function(){return this[(this.isPopupOpen()?"hide":"show")+"Popup"]()},isPopupOpen:function(){return this.isPopupOpened},update:function(b,c){if(u===!1)return a.log(t+"it will not be updated cause it is no inited."),!1;var d=this,e=b.items,g=b.groups,h=e.length,i=b.itemsByGroup,j=d.goEl,k=d.smallGoEl,m=d.floatbarEl,n=d.checkCodEl,p=d.isPopupOpen(),q=a.inArray("cod",g),r=o("\u7ed3&nbsp;\u7b97"),v=o("\u4e0d\u652f\u6301\u5408\u5e76\u7ed3\u7b97");q?n.show():n.hide().one(".J_CheckCOD").removeClass("s-checkbox-selected"),d.selectedItemsCountEl.html(h);var x=d.floatbarArrowEl.offset(),y=d.floatbarEl.offset();x&&y&&d.popupArrowEl.css("left",x.left-y.left);var z=s("#J_SelectedItemsList").empty().html("");if(!(e.length>0))return j.addClass("submit-btn-disabled").removeClass("combine-not-supported").one("span").html(r),k.addClass("submit-btn-disabled").removeClass("combine-not-supported").html(r),m.removeClass("has-items"),d.hidePopup(),!0;j.removeClass("submit-btn-disabled"),k.removeClass("submit-btn-disabled"),m.addClass("has-items");var A=!1;if(g.length>1){var B=!0,C=p;if(q){var D=n.one(".s-checkbox").hasClass("s-checkbox-selected");D?(p||(C=!0),A=!0):2===g.length?a.inArray("normal",g)?B=p?!1:null:(i.normal=i.cod,i.normal.title="\u666e\u901a\u5b9d\u8d1d",i.normal.name="normal",delete i.cod,A=!0,C=!0):(C=!0,a.each(i.cod.items,function(a){a&&i.normal.items.push(a)}),i.normal.total+=i.cod.total,delete i.cod,A=!0)}else A=!0,p||(C=!0);B===!0?(f.renderMultiGroups(b),d.selectedItems=b,z.delegate("click",".J_GroupOp",d.groupEvent,d),!c&&C&&d.showPopup()):B===!1&&f.renderSingleGroup(e)
}else p&&f.renderSingleGroup(e);return A?(j.addClass("combine-not-supported").addClass("need-separate").one("span").html(v),k.addClass("combine-not-supported").html(v)):(j.removeClass("combine-not-supported").removeClass("need-separate").one("span").html(r),k.removeClass("combine-not-supported").html(r)),l.update(m.one(".J_BatchCompare"),e),w(),!0},groupEvent:function(a){a.preventDefault();var b=this,c=s(a.target),d=c.parent(".group"),e=d.attr("id").replace("J_Group_","");c.hasClass("J_GroupCheckout")?(i.go({items:b.selectedItems.itemsByGroup[e].items,group:e}),Global.utils.makepoint("8.3")):c.hasClass("J_GroupExpand")&&(Global.resetTemp(),f.renderMultiGroups(b.selectedItems,e))},destroy:function(){u=!1}}},{requires:["node","ua","dom","event","./tpl/floatbar.tpl","../select/select","./delete","./go","./batch-fav","./share","./batch-compare","../../../utils/tip/tip","../../../utils/dialog/dialog","../../../utils/tpl/render"]}),KISSY.add("cart/mods/cart/filterbar/status-bar",function(a,b,c,d){var e=b.all,f="status-disabled",g=e("#J_StatusBar");return{init:function(){},update:function(a){},disable:function(){g.html("").addClass(f)}}},{requires:["node","gallery/template/1.0/","../../../utils/tpl/render"]}),KISSY.add("cart/utils/url/url",function(){return{add:function(a,b){var c=this.remove(a);return c+(b?(c.indexOf("?")>-1?"&":"?")+a+"="+b:"")},remove:function(a){for(var b="",c=location.href,d=0;d<a.length;d++){var e=a.substring(d,d+1);b+=/[A-Z]/.test(e)&&0!==d?"_"+e.toLowerCase():e}if(b){var f=new RegExp("[?&]?"+b+"=[^#&]+");c=c.replace(f,"")}var g=new RegExp("[?&]?"+a+"=[^#&]+");return c.replace(g,"").replace(/#\.?$/,"")}}}),KISSY.add("cart/mods/cart/filterbar/switchMap",function(){return{totleCount:{status:0,name:"\u5168\u90e8\u5546\u54c1",makepoint:"8.35"},promotionCount:{status:2,name:"\u964d\u4ef7\u5546\u54c1",makepoint:"8.34"},quailtyTenseCount:{status:4,name:"\u5e93\u5b58\u7d27\u5f20",makepoint:"8.36"}}}),KISSY.add("cart/mods/cart/filterbar/switchTPL",function(a,b,c,d,e){function f(a){return'<li class="btn-switch-cart switch-cart-'+a.type+" "+a._class+'"><a href="'+a.url+'" class="J_MakePoint" data-point="tbcart.'+a.makepoint+'"><em>'+a.name+'</em><span class="number">'+a.value+'</span><span class="pipe"></span></a></li>'}var g=b.all;return{generate:function(b){var g="";return a.each(d,function(a,d){var e="",h=0===a.status?c.remove("extStatus"):c.add("extStatus",a.status);a.status===Global.cfg.type?e="current":a.status>0&&0===b[d]&&(e="disabled",h="javascript: void(0);"),g+=f({type:a.status,name:a.name,url:h,value:b[d]>0?b[d]:0,_class:e,makepoint:a.makepoint})}),e(g)},render:function(a){return g(this.generate(a))}}},{requires:["node","../../../utils/url/url","./switchMap","../../../utils/tpl/render"]}),KISSY.add("cart/mods/cart/filterbar/switch-effect",function(a,b){var c=b.all,d=!1;return{init:function(a){if(d!==!0){var b=a.siblings(".wrap-line"),e=b.all(".floater"),f=c(".current",a),g=null,h=f.outerWidth()-1,i=0;e.width(h);try{i=f.offset().left-a.offset().left}catch(j){i=0}e.css("left",i),a.delegate("mouseenter","li.btn-switch-cart",function(b){g&&g.stop(!0);var d=c(b.currentTarget);try{var f=d.offset().left-a.offset().left;e.animate({left:f,width:d.outerWidth()-1},{easing:"easeIn",duration:.2})}catch(h){}}),a.on("mouseleave",function(){g&&g.stop(!0),g=e.animate({left:i,width:h},{easing:"easeIn",duration:.2})}),d=!0}}}},{requires:["node"]}),KISSY.add("cart/mods/cart/filterbar/switch-cart",function(a,b,c,d,e,f,g){var h,i,j=c.all;return{init:function(){return h?h:(h=j("#J_CartSwitch").delegate("click",".J_SwitchCart",function(a){a.halt();var b=j(a.currentTarget);b.hasClass("disabled")||(location.href=e.add("extStatus",b.attr("data-type")))}),!0)},request:function(b){var c=this;d.jsonp("json/asyncGetMiniCount.do",{t:a.now},function(d){d=d||{},b&&a.mix(d,b),c.render(d)})},render:function(a){h.html(f.generate(a)),g.init(j("#J_CartSwitch"))},update:function(a){var b=this,c=b.init()===!0;if(h){var d=Global.globalData;if(c&&d)b.render({promotionCount:d.promotionCount,quailtyTenseCount:d.stockTenseCount,totleCount:d.totalSize});else{if(a&&a.page>1)return;if(a&&"check"===a.type)return;b.request(a)}}},back:function(a){var b=this;b.init(),i=null,h.html('<a href="cart.htm" class="J_SwitchCart btn-switch-cart J_MakePoint" data-point="tbcart.8.35"><span class="txt"><i class="lt">&lt;&lt;</i>\u8fd4\u56de\u5168\u90e8\u5546\u54c1</span></a> '+a)},to:function(a){switch(a){case"promo":a=1;break;default:a=0}window.location.href=e.add("extStatus",a)}}},{requires:["dom","node","ajax","../../../utils/url/url","./switchTPL","./switch-effect"]}),KISSY.add("cart/mods/global/config",function(a,b){var c;return{init:function(a){c?a&&a(c):new b({url:"http://www.taobao.com/go/rgn/cart/config.php",dataType:"jsonp",type:"get",success:function(b){c=b,a&&a(b)},error:function(){a&&a({})}})},get:function(a,b){this.init(function(c){var d={};c&&c[a]&&(d=c[a]),b&&b(d)})}}},{requires:["ajax"]}),KISSY.add("cart/mods/global/plugin",function(a,b,c){var d="[plugin] ",e=[];return{init:function(f){c.get("plugins",function(c){if(c&&c.list&&!a.isEmptyObject(c.list)){var g=c.version||Global.cfg.version;a.config({packages:{plugin:{base:Global.cfg.guiServer+"/tb/cart/"+g+"/",charset:"gbk"}}}),a.each(c.list,function(c,g){var h=d+"["+g+"] ",i=a.now();if(!a.isUndefined(c.startTime)&&i<c.startTime&&(a.log(h+"time < start time, exit;"),c.on=!1),!a.isUndefined(c.endTime)&&i>c.endTime&&(a.log(h+"time > start time, exit;"),c.on=!1),c.mobile===!1&&b.mobile&&(a.log(h+" disabled on mobile devices, exit;"),c.on=!1),c.on!==!1){var j=function(){a.use("plugin/"+g+"/"+g,function(a,b){b&&b.init&&(b.init(c,f),e.push(b),a.log(d+g+" inited."))})};c.version?a.getScript(Global.cfg.guiServer+"/tb/cart/"+c.version+"/plugin/"+g+"/"+g+".js",{success:j}):j()}})}})},update:function(b){e.length&&a.each(e,function(a){a&&a.update&&a.update(b)})},destroy:function(b){e.length&&a.each(e,function(a){a&&a.destroy&&a.destroy(b)})}}},{requires:["ua","./config"]}),KISSY.add("cart/mods/global/footer/footer",function(a,b){var c=b.all;return{inited:!1,init:function(){var a=this;a.inited!==!0&&(a.inited=!0,c("#footer").show())}}},{requires:["node","ajax"]}),KISSY.add("cart/mods/global/scrollToCartId",function(a,b){var c=function(){var b=location.hash.match(/#(.*)$/),c=b?b[1]:"",d=a.unparam(c);return d.cartId};return{go:function(a){if(!a){var d=c();if(!d)return;a=d}var e=b.get("#J_Item_"+a);if(e){var f=b.offset(e).top;b.scrollTop("body",f-20)}}}},{requires:["dom"]}),KISSY.add("cart/mods/cart/baseCart",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){function s(b){a.mix(this,b),this._init()}var t,u="[baseCart] ",v=b.all,w={normal:"\u666e\u901a\u5546\u54c1",HK:"\u5929\u732b\u56fd\u9645",cod:"\u8d27\u5230\u4ed8\u6b3e",YY:"\u533b\u836f\u9986",LG:"\u4fea\u4eba\u8d2d"};return a.augment(s,{_init:function(){var a=this;a.orders={},a.cartIdsSelected=[],a.itemsSelected={};var b=!0;a.loader=new f({diff:500,container:"#J_Cart",extraParams:this.loadExtraParams,loadCfg:this.loadCfg||{success:function(a){0===a.globalData.totalSize&&Global.empty()},error:function(){},end:function(a){b===!0&&Global.utils.goldlog("cart_nums",{totalSize:a.globalData.totalSize,bItemsCount:a.globalData.bItemsCount,cItemsCount:a.globalData.cItemsCount,shopCount:a.list?a.list.length:0,cShopsCount:a.globalData.cShopsCount,bShopsCount:a.globalData.bShopsCount}),setTimeout(r.go,0)}},Cart:a}),setTimeout(function(){k.init(a),j.init()},10)},getTotalPrice:function(){var b=this,c=0,d={};return a.each(this.itemsSelected,function(a){a&&(c+=a.getPrice()),d[a.orderId]=a.orderId}),"SM"===Global.cfg.layout&&a.each(d,function(a){var d=b.orders[a];d&&d.data.promView&&d.data.promView.discount&&(c-=d.data.promView.discount)}),c=c>0?c:0},calc:function(){h.calc(this.getTotalPrice())},addSelectedItem:function(b){var c=b.cartId;return a.inArray(c,this.cartIdsSelected)||this.cartIdsSelected.unshift(c),this.itemsSelected[c]=b,b},removeSelectedItem:function(b){var c=b.cartId,d=a.indexOf(c,this.cartIdsSelected);return d>-1?(this.cartIdsSelected.splice(d,1),delete this.itemsSelected[c],b):null},getItems:function(b,c,d){var e=[],f=0,g=!1;return a.each(this.orders,function(h){return a.each(h.bundles,function(h){return a.each(h.items,function(h){if(h&&g===!1){var i=!0;if(b&&a.each(b,function(a,b){var c=d===!0?h.data[b]:h[b];return c!==a?(i=!1,!1):void 0}),i&&(e.push(h),c>0&&c===e.length))return g=!0,!1;f++}}),g===!0?!1:void 0}),g===!0?!1:void 0}),0>=c&&(this.itemsCount=f),e},getItemsByAttr:function(b,c,d){var e=[],f=!1;return a.each(this.orders,function(g){return a.each(g.bundles,function(g){return a.each(g.items,function(g){if(g&&f===!1){var h=!0;if(b&&a.each(b,function(b,c){var e=g.getAttr(c);if(d){if(e!==b)return h=!1,!1}else if(a.isUndefined(e))return h=!1,!1}),h&&(e.push(g),c>0&&e.length===c))return f=!0,!1}}),f===!0?!1:void 0}),f===!0?!1:void 0}),e},getSelectedItems:function(b){var c=this,d=[];return b?a.each(this.cartIdsSelected,function(e){var f=c.itemsSelected[e];f&&a.each(b,function(a,b){f[b]===a&&d.push(f)})}):a.each(this.cartIdsSelected,function(a){d.push(c.itemsSelected[a])}),d},getSelectedItemsLength:function(){return this.cartIdsSelected.length||0},getInvalidItems:function(){return this.getItems({isValid:!1},-1,!0)},getTruelyInvalidItems:function(){var b=this.getInvalidItems(),c=[];return a.each(b,function(a){a.data&&"ju11"!==a.data.type&&c.push(a)}),c},getSelectedItemsAndGroups:function(){var b=this,c=[],d=[],e={};return a.each(this.cartIdsSelected,function(f){var g=b.itemsSelected[f];g&&g.isSelected()&&g.isValid&&(c.push(g),a.inArray(g.group,d)||d.push(g.group),e[g.group]=e[g.group]||{name:g.group,title:"HK"===g.group.substr(0,2)?"\u5929\u732b\u56fd\u9645":w[g.group],items:[],total:0,expand:!0},e[g.group].items.push(g),e[g.group].total+=g.getPrice())}),{items:c,groups:d,itemsByGroup:e}},getSelectedItemsByGroup:function(){var b=this,c={normal:[]},d=[];return a.each(this.cartIdsSelected,function(a){var d=b.itemsSelected[a];d&&d.isSelected()&&d.group&&(c[d.group]=c[d.group]||[],c[d.group].push(d))}),a.each(c,function(a,b){d.push({name:b,title:w[b]||b,items:a})}),d},isAllSelected:function(){var b=!0;return a.each(this.orders,function(a){return a&&!a.isChecked()?(b=!1,!1):void 0}),b},check:function(a){if(t&&clearTimeout(t),a+1)this.isChecked=a,j.toggle(a);else{var b=this;t=setTimeout(function(){b.check(b.isAllSelected())},100)}},select:function(){var b=!0,c=this.getItems({skuStatus:1},1,!0);if(c.length&&(c[0].select(),b=!1),b===!0){var d=[];a.each(this.orders,function(a){if(a){if(!a.select(!1))return b=!1,!1;d.push(a)}}),this.check(b),Global.request({type:"check",orders:d}),Global.updateCart()}return b},unselect:function(){a.each(this.orders,function(a){a&&a.unselect()}),this.check(!1)},update:function(b){a.log(u+"Start to update Cart.");var c=this;a.each(this.orders,function(a){a.correct(!0)});var d=this.getSelectedItemsAndGroups(),e=this.getItems({isValid:!0},-1,!0);j.update(e,d.items);var f=!1,g=a.isEmptyObject(this.orders);if(p.inited===!1){var h=v("#J_Cart");h&&h.length&&h.offset().top+h.height()<v(window).height()&&(f=!0)}if(Global.utils.isDaily&&g===!0&&(/[\?&]fallback=false/.test(location.href)?(q.error("\u8d2d\u7269\u8f66\u52a0\u8f7d\u5931\u8d25\uff0c\u5bb9\u9519\u673a\u5236\u5173\u95ed"),f=!1,g=!1):q.error("\u8d2d\u7269\u8f66\u52a0\u8f7d\u5931\u8d25\uff0c\u91cd\u8bd5\u4e2d...")),g=!1,g===!0){var l=Global.globalData?parseInt(Global.globalData.page,10):1;l=l||1,a.log(u+"Cart retries loading page: "+l),this.loader.load({page:l},this.retryLoadCfg||{success:function(a){0===a.globalData.totalSize&&Global.empty()},error:function(){}})}else f===!0?(a.log(u+"Cart empty....Start to load more"),this.loader.load({},{success:function(){},error:function(){}})):k.update(d);return this.calc(),i.render(),this._updateFilterBar(a.mix({normal:e.length,invalid:c.itemsCount-e.length},b)),o.update({selectedItems:d,validItems:e,invalidCount:c.itemsCount-e.length}),!0},_updateFilterBar:function(a){l.update(a),m.update(a)},render:function(b,c,d,f){var h=this;a.log(u+"start to render cart."),a.each(b,function(b){b.uniqueId=b.id+"_"+c;var e=h.orders[b.uniqueId];e&&(d=d||e.data.startTime,f=f||e.data.endTime,e.orderHolderEl.height(e.orderHolderEl.height()),b=e.mixData(b),delete h.orders[b.uniqueId]),b.startTime=d,b.endTime=f,b.page=c;try{h.orders[b.uniqueId]=g.create({uniqueId:b.uniqueId,id:b.id,data:b})}catch(i){var j="order "+b.id+" construct error: "+i;a.log(j,"warn"),Global.utils.jstracker(j)}}),6===e.ie&&setTimeout(function(){v(".J_Order").css("zoom",1)},150)},getItemByCartId:function(b){var c=this,d=null;return a.each(c.orders,function(a){return a&&(d=a.getItemByCartId(b))?!1:void 0}),d},getOrderById:function(a){var b=this.getOrders({id:a});return b?b[0]:null},getOrders:function(b){var c=this,d=[];return a.each(c.orders,function(c){a.each(b,function(a,b){return c&&c[b]===a&&(d.push(c),"id"===b)?!1:void 0})}),d},removeOrder:function(a){delete this.orders[a]},destroy:function(){this.loader&&this.loader.disable(),v("#J_OrderList").html(""),i.clear(),o.destroy()}}),s},{requires:["node","dom","event","ua","../global/loader","../order/orderFactory","./floatbar/totalpay","./undo/undo","./select/select","./floatbar/floatbar","./filterbar/status-bar","./filterbar/switch-cart","../../utils/dialog/dialog","../global/plugin","../global/footer/footer","../../utils/debug/debug","../global/scrollToCartId"]}),KISSY.add("cart/mods/cart/cartTPL",function(a,b,c,d){var e=b.all,f="[cartTPL] ",g={empty:'<div id="crumbs"><strong>\u60a8\u7684\u4f4d\u7f6e\uff1a</strong><ol class="crumbs"><li><a href="http://www.taobao.com">\u9996\u9875</a></li><li><a href="http://i.taobao.com/my_taobao.htm" data-spm-anchor-id="a1z0d.1.0.0">\u6211\u7684\u6dd8\u5b9d</a></li><li class="current">\u6211\u7684\u8d2d\u7269\u8f66</li></ol><span class="cart-tip">\u8d2d\u7269\u8f66\u5e2e\u60a8\u4e00\u6b21\u6027\u5b8c\u6210\u6279\u91cf\u8d2d\u4e70\u4e0e\u4ed8\u6b3e\uff0c\u4e0b\u5355\u66f4\u4fbf\u6377\uff0c\u4ed8\u6b3e\u66f4\u7b80\u5355\uff01<a href="http://service.taobao.com/support/help-11746.htm?spm=a1z0d.1.0.0.ogEwpx" target="_blank" data-spm-anchor-id="a1z0d.1.0.0">\u5982\u4f55\u4f7f\u7528\u8d2d\u7269\u8f66</a></span></div><div id="empty"><h2>\u60a8\u7684\u8d2d\u7269\u8f66\u8fd8\u662f\u7a7a\u7684\uff0c\u8d76\u7d27\u884c\u52a8\u5427\uff01\u60a8\u53ef\u4ee5\uff1a</h2><ul><li>\u770b\u770b <a href="http://shoucang.taobao.com/shop_collect_list.htm" target="_blank">\u6211\u7684\u6536\u85cf\u5939</a></li><li>\u770b\u770b <a href="http://trade.taobao.com/trade/itemlist/list_bought_items.htm" target="_blank">\u5df2\u4e70\u5230\u7684\u5b9d\u8d1d</a></li></ul></div>'},h={};return{render:function(a){var b=e("#J_Cart");if(a.type&&g[a.type]){h[a.type]||(h[a.type]=c(g[a.type]));var i=d(h[a.type],a,f);b.html(i)}return b}}},{requires:["node","gallery/template/1.0/","../../utils/tpl/render"]}),KISSY.add("cart/mods/cart/emptyCart",function(a,b,c,d){function e(b){a.mix(this,b),c.render({type:"empty"}),Global.renderFooter()}b.all;return a.augment(e,{update:function(){d.update()}}),e},{requires:["node","./cartTPL","../global/plugin"]}),KISSY.add("cart/mods/cart/promoCart",function(a,b,c,d,e){function f(b){a.mix(this,b),this._init()}b.all;return a.extend(f,c,{_init:function(){d.to("normal")},_updateFilterBar:function(){e.disable(),d.back('<span class="promo-cart-tips">\u4ee5\u4e0b\u5546\u54c1\u6709\u65b0\u4f18\u60e0\u5566\uff0c\u8d76\u7d27\u53bb\u8d2d\u4e70\u5427</span>')},switchToNormal:function(){d.to("normal")}}),f},{requires:["node","./baseCart","./filterbar/switch-cart","./filterbar/status-bar"]}),KISSY.add("cart/mods/cart/newPromoCart",function(a,b,c,d){function e(b){a.mix(this,b),this._init()}b.all;return a.extend(e,c,{_init:function(){var a=this;a.loadExtraParams={extStatus:2},a.loadCfg={success:function(b){return a.loader&&a.loader.disable(),0===b.globalData.currentPageSize?(d.to("normal"),!1):(Global.renderFooter(),!0)}},this.retryLoadCfg=this.loadCfg,e.superclass._init.call(this)},update:function(){return a.isEmptyObject(this.orders)?(d.to("normal"),void 0):(e.superclass.update.call(this),void 0)},switchToNormal:function(){d.to("normal")},_updateFilterBar:function(b){d.update(a.mix(b,{showPipe:!1}))}}),e},{requires:["node","./baseCart","./filterbar/switch-cart"]}),KISSY.add("cart/mods/cart/lowAmountCart",function(a,b,c,d){function e(b){a.mix(this,b),this._init()}b.all;return a.extend(e,c,{_init:function(){var a=this;a.loadExtraParams={extStatus:4},a.loadCfg={success:function(b){return a.loader&&a.loader.disable(),0===b.globalData.currentPageSize?(d.to("normal"),!1):(Global.renderFooter(),!0)}},this.retryLoadCfg=this.loadCfg,e.superclass._init.call(this)},update:function(){return a.isEmptyObject(this.orders)?(d.to("normal"),void 0):(e.superclass.update.call(this),void 0)},switchToNormal:function(){d.to("normal")},_updateFilterBar:function(b){d.update(a.mix(b,{showPipe:!1}))}}),e},{requires:["node","./baseCart","./filterbar/switch-cart"]}),KISSY.add("cart/mods/cart/cartFactory",function(a,b,c,d,e,f){var g="[cartFactory] ";return{create:function(h){var i;switch(h.type){case"empty":i=new c(h);break;case"promo":i=new d(h);break;case"newPromo":i=new e(h);break;case"lowAmount":i=new f(h);break;default:i=new b(h)}return a.log(g+" current type is "+h.type),i}}},{requires:["./baseCart","./emptyCart","./promoCart","./newPromoCart","./lowAmountCart"]}),KISSY.add("cart/mods/global/request",function(a,b,c,d,e,f,g){function h(b,c){var d={shopId:b.shopId,comboId:b.comboId,shopActId:b.shopActId,cart:[],operate:[],type:c.type},e=c.updateUnselect?a.makeArray(c.operate):b.getItems(),f={},g=!0;return a.each(e,function(a){if(a&&(f[a.cartId]=!0,a.isSelected()||a.isCombo||a.isRedemption||a===c.operate)){{var b="update"===c.type&&a===c.operate?c.quantity:a.getQuantity();d.cart.push({quantity:b,cartId:a.cartId,skuId:a.getSkuId(),itemId:a.itemId})}g=!1}}),"addExtraItem"===c.type&&(f[0]=!0,d.cart.push(c.operate)),"undelete"===c.type&&a.each(a.makeArray(c.operate),function(a){a&&a.orderId===b.uniqueId&&(f[a.cartId]=!0,d.cart.push({quantity:a.getQuantity(),cartId:a.cartId}))}),g&&"check"===c.type?!1:(a.each(a.makeArray(c.operate),function(a){f[a.cartId]&&d.operate.push(a.cartId)}),c.extraParams&&a.mix(d,c.extraParams),d)}function i(b,i){var l=this;a.log(k+"start request, type: "+b.type);var m=[],n={},o=a.now();if(a.each(a.makeArray(b.orders),function(a){var c=h(a,b);if(c){m.push(c);var d=a&&a.data&&a.data.page?a.data.page:1;n[d]=n[d]||[],n[d].push(c)}},this),!m.length)return!1;var p=a.now();return a.each(n,function(h,m){var n=d.stringify(h);a.log(k+"post data for page "+m+": "+n);var q={_input_charset:"utf-8",tk:j("#_tb_token_").val(),data:n,shop_id:Global.data.shopId||0,t:+new Date,type:b.type,ct:e.get("t"),page:m};Global.cfg.type&&(q.extStatus=Global.cfg.type),Global.cfg.tpId&&(q.tpId=Global.cfg.tpId),b.globalParams&&a.mix(q,b.globalParams),c({type:"POST",dataType:"json",url:Global.cfg.api.update,data:q,success:a.bind(function(c){var d=a.now();if(a.log("update result got, status is: "+(c.success?"success":"error")),c.success){var e=c.globalData;e&&-1!==e.totalSize&&(Global.totalSize=e.totalSize),g.transform(c),b.success&&b.success(c),i&&i.render(c.list,c.globalData.page)}else!b.silent&&c.error&&f.alert(c.error.errorMessage||"\u5bf9\u4e0d\u8d77\u7cfb\u7edf\u9519\u8bef\uff0c\u8bf7\u5237\u65b0\u91cd\u8bd5"),b.error&&b.error(c),Global.utils.jstracker("async update return "+(c&&c.error&&c.error.errorCode?c.error.errorCode:"unknown")+" error: "+n,"request.js",0,"updateCart_return_error");var h=a.now();Global.updateCart({page:m,type:b.type}),Global.utils.goldlog("cart3-request_time",{dataTime:(p-o)/1e3,requestTime:(d-p)/1e3,renderTime:(h-d)/1e3,updateTime:(a.now()-h)/1e3,updateType:b.type}),Global.queue.next()},l),error:function(){b&&b.error&&b.error(),Global.queue.next(),Global.utils.jstracker("async update request error","request.js",0,"updateCart_request_error")},timeout:10})}),!0}var j=b.all,k="[Global Request] ",l={};return function(a,b){var c=this;l[a.type]&&clearTimeout(l[a.type]),l[a.type]=setTimeout(function(){i.call(c,a,b)},50)}},{requires:["node","ajax","json","cookie","../../utils/dialog/dialog","./data"]}),KISSY.add("cart/mods/global/makepoint/makepoint",function(a,b,c){var d=document.body,e=function(b){b=b+(-1===b.indexOf("?")?"?":"&")+"cache="+a.now();var c=window["g_makepoint_"+a.guid()]=new Image;c.src=b};return{init:function(){var a=this;c.on(d,"click",function(c){if(c&&c.target)if(b.hasClass(c.target,"J_MakePoint")){var d=b.attr(c.target,"data-point");d&&a.track({data:d})}else b.hasClass(c.target,".ww-inline")&&a.track({data:"tbcart.8.16"})})},track:function(b){if(b&&(b.data||b.url)){a.isString(b)&&(b={data:b});var c=b.data?"http://gm.mmstat.com/"+b.data:b.url;e(c)}}}},{requires:["dom","event"]}),KISSY.add("cart/mods/global/sidefloat/sidefloat.tpl",function(){return'<div id="J_SideFloat" class="side-float"><a id="J_GoToTop" class="go-to-top J_GoToTop J_MakePoint" data-point="tbcart.8.28"><span class="iconfont">&#61534</span><em>\u56de\u5230\u9876\u90e8</em></a><a class="suggestion J_Suggestion J_MakePoint" data-point="tbcart.8.29" target="_blank" href="http://ur.taobao.com/survey/view.htm?id=1884"><span class="iconfont">&#61535</span><em>\u6211\u8981\u53cd\u9988</em></a></div>'}),KISSY.add("cart/mods/global/sidefloat/sidefloat",function(a,b,c,d,e){var f,g,h=b.all,i=h(window),j=function(b){var c=b&&b.offset()?b.offset().top:0,d=b.height(),e=500,f=a.later(function(){},0);b.css("top",c+i.scrollTop()),i.on("scroll resize",function(){var g=i.scrollTop();c=(i.height()-d)/3*2,f.cancel(),f=a.later(function(){i.scrollTop()===g&&b.css("top",c+i.scrollTop())},e)})};return{init:function(){function a(){if(i.width()<1060){var a=h("#J_OrderList"),b=a.offset();b&&f.css({left:b.left+a.width()-20,right:"auto"})}else f.css({left:"auto",right:"6px"})}var b=this;f=h(e).appendTo("body").delegate("click",".J_GoToTop",function(a){a.preventDefault(),c(window,{scrollTop:0},.5,"easeOutStrong").run()}),g=h("#J_GoToTop"),b.toggleGoToTop(),i.on("scroll",b.toggleGoToTop,b),a(),i.on("resize",a),6===d.ie&&j(f)},toggleGoToTop:function(){g.css("visibility",i.scrollTop()?"visible":"hidden")}}},{requires:["node","anim","ua","./sidefloat.tpl"]}),KISSY.add("cart/utils/my-path/my-path",function(a,b,c){b.all;return{init:function(b){new c({type:"get",url:"http://lu"+Global.utils.tbPath+"/api/item?type=cart_items&p=u&from=mypath&f=jp&count=5",success:function(c){var d=[];if(c&&c.listDesc&&c.listDesc.items){var e={url:"url",id:"itemId",pic:"pic",price:"price",name:"title"};a.each(c.listDesc.items,function(b){a.each(b,function(b){var c={};for(var f in e)c[e[f]]=b[f],c.price=parseFloat(c.price).toFixed(2),c.xid="",c.itemIdStr=b.id,c.isDaily=Global.utils.isDaily;!a.isEmptyObject(c)&&d.push(c)})})}b.callback&&b.callback(d)},dataType:"jsonp"})}}},{requires:["node","ajax"]}),KISSY.add("cart/mods/global/relative/relative-effect",function(a,b){var c=b.all,d=!1,e=null;return{init:function(a){d||(d=!0,c('<div class="wrap-line"><div class="floater" style="width: 0;"></div></div>').insertAfter(a.one(".tabs")),this.update(a))},update:function(a){var b=a.one(".wrap-line"),d=b.one(".floater"),f=c(".current",a),g=0;try{g=f.offset().left-a.offset().left}catch(h){g=0}e&&e.stop(!0),d.animate({left:g,width:f.outerWidth()-1},{easing:"easeIn",duration:.2})}}},{requires:["node"]}),KISSY.add("cart/utils/price-level/price-level",function(){return{parse:function(a){var b="0";return a>9999.99?b="w":a>99999.99?b="sw":a>999999.99?b="bw":a>9999999.99?b="qw":a>99999999.99?b="y":a>999999999.99&&(b="sy"),b}}},{requires:[]}),KISSY.add("cart/mods/global/relative/relative",function(a,b,c,d,e,f,g,h,i,j,k){var l,m=b.all,n="[Relative] ",o={"\u987a\u4fbf\u5e26\u8d70":"ebook","\u6700\u8fd1\u6536\u85cf\u7684":"fav","\u6700\u8fd1\u6d4f\u89c8\u8fc7\u7684":"browser","\u731c\u4f60\u559c\u6b22\u7684":"like"},p='<p class="tip-nodata tip">\u6682\u65e0\u731c\u4f60\u559c\u6b22\u7684\u5b9d\u8d1d</p>',q='<p class="tip-loading tip"><img src="http://img02.taobaocdn.com/tps/i2/T1Q2BUXaxFXXXXXXXX-32-32.gif" />\u6570\u636e\u52a0\u8f7d\u4e2d...</p>',r=m("#interested"),s=(Global.cfg.api.likeAPI,Global.cfg.api.favoriteListAPI),t=(Global.cfg.api.ebookAPI,m("#J_Auctions")),u=t.all(".J_Panel"),v=t.all(".J_Triggers"),w=(m(".J_ClearBrowse",r),{}),x=!1,y={_init:function(){r&&x!==!0&&""==Global.cfg.client&&(r.show(),Global.lazyload(r,this._loadTabData,this))},_initTabs:function(b){var c=this;a.use("gallery/switchable/1.3.1/",function(a,d){l&&l.destroy(!0),l=new d.Tabs("#J_Auctions",{markupType:2,activeTriggerCls:"current",triggers:v,panels:u,autoplay:!0,triggerType:"mouse",pauseOnHover:!0,interval:5,switchTo:b});var e=m("#J_Auctions");h.init(e),l.on("switch",function(a){c._loadTabData(a.currentIndex),h.update(e)},c),e.on("click mouseenter",function(){l.stop()})})},_loadTabData:function(b){b=parseInt(b,10)||0;var d=a.trim(c.attr(v[b],"data-method"));d||(d=o[a.trim(c.text(v[b]))]),w[b]||(w[b]="loading",d&&"_loadData_"+d in this&&this["_loadData_"+d](b),this._initTabs(b))},_loadData_fav:function(b){var d=this,e=function(){c.remove(v[b]),c.remove(u[b]),Array.prototype.splice.call(v,b,1),Array.prototype.splice.call(u,b,1),d._initTabs(b),w[b]="",d._loadTabData(b)};d._showLoading(b),a.getScript(s+"&t="+a.now()+"&_tb_token_="+c.val("#_tb_token_"),{success:function(){var c=window.result;if(!c||!c.collectList)return e();try{var f=d._parseData(c.collectList.slice(0,5),"fav");f+='<a class="relative-extra gotomyfav" href="http://favorite.taobao.com/collect_list.htm?scjjc=d2" target="_blank">\u53bb\u6211\u7684\u6536\u85cf\u5939&nbsp;<span class="gt">&gt;&gt;</span></a>',u[b].innerHTML=i(f),a.log(n+"fav data loaded.")}catch(g){e()}},error:e,timeout:2}),x=!0},_loadData_browser:function(a){var b=this;b._showLoading(a),g&&g.init({callback:function(d){var e;d&&d.length?(e=b._parseData(d.slice(0,5),"browser"),e+='<a class="relative-extra btn-to-my-path" href="http://lu.taobao.com/newMyPath.htm" target="_blank">\u53bb\u6211\u7684\u8db3\u8ff9&nbsp;<span class="gt">&gt;&gt;</span></a>',u[a||0].innerHTML=i(e)):(c.remove(v[a]),c.remove(u[a]),Array.prototype.splice.call(v,a,1),Array.prototype.splice.call(u,a,1),b._initTabs(a),w[a]="",b._loadTabData(a))},type:"r"})},_loadData_like:function(b){var c=this;c._showLoading(b),f({type:"get",url:"http://tui.taobao.com/recommend",data:{t:a.now(),appid:Global.cfg.tuiAppId||8,count:5},dataType:"jsonp",success:function(d){var e;if(d.list&&d.list.length)e=c._parseData(d.list,"oldlike");else if(d.result&&d.result.length){e=c._parseData(d.result,"like");var f=!1;a.each(d.result,function(a){return f===!1&&a&&a.extMap&&1===a.extMap.presell20141212?(f=!0,!1):void 0}),f&&(e+='<a class="relative-extra btn-to-my-like" href="http://1212.taobao.com/" target="_blank">\u66f4\u591a\u9884\u552e&nbsp;<span class="gt">&gt;&gt;</span></a>')}else e=p;u[b||0].innerHTML=i(e),j.init()},error:function(){u[b||0].innerHTML=i(p)},timeout:3})},_loadData_ebook:function(){var a=c.get("#p4p-block");if(a){if(""===c.html(a)){var b=c.create("<div></div>");c.hide(b),c.html(b,c.val("#J_P4PBlockData"),!0)}}},_parseData:function(b,c){"_formatData_"+c in this&&(b=this["_formatData_"+c](b));var d="&ad_id=&am_id=&cm_id=&pm_id=",f={fav:d+"15001250084ca92e6beb",browser:d+"1500121087bd5308a47e",like:d+"150012108882a30a058e"},g=/_sum\.jpg|_70x70\.jpg/;a.each(b,function(b){b.detailUrl="like"===c||"oldlike"===c?b.detailUrl:"http://ju.atpanel.com/?url="+b.detailUrl+f[c],b.imageUrl=b.imageUrl.replace(g,"_220x220.jpg"),b.title=a.escapeHTML(b.title.replace("\\u"," "))}),b={data:b};var h=e('<ul class="relative-list relative-list-'+c+'">{{#each data as item}}<li class="relative-item"><div class="recommend-item-pic cart-pic s220"><a href="{{item.detailUrl}}" target="_blank" class="pic"><img src="{{item.imageUrl}}" /></a></div><div class="recommend-item-info"><p>{{#if item.extMap}}{{#if item.extMap.presell20141212 === 1}}<span class="tbc-double-12-label tbc-hongbao-label-common tbc-hongbao-label-pc tbc-hongbao-label-presale-normal" data-type="presale" data-render-finish="done" title="1212\u9884\u552e">1212\u9884\u552e</span>{{#elseif item.extMap.redpack20141212}}<span class="tbc-double-12-label" data-type="coupon" data-value="{{item.extMap.redpack20141212}}"></span>{{#elseif item.extMap.mark20141212}}<span class="tbc-double-12-label tbc-hongbao-label-common tbc-hongbao-label-pc tbc-hongbao-label-normal" data-type="label" data-render-finish="done" title="1212\u4e07\u80fd\u76db\u5178">1212\u4e07\u80fd\u76db\u5178</span>{{/if}}{{/if}}<span class="price g_price price-level-{{item.priceLevel}}">&yen;<em>{{item.price}}</em></span></p><p><a href="{{item.detailUrl}}" target="_blank" class="item-title">{{item.title}}</a></p></div></li>{{/each}}</ul>');return h.render(b)},_formatData_browser:function(b){var c=[];return a.each(b,function(a){c.push({title:a.title||"",price:parseFloat(a.price).toFixed(2),detailUrl:a.url,imageUrl:a.pic+"_220x220.jpg"})}),c},_formatData_oldlike:function(b){var c=[];return a.each(b,function(a){c.push({title:a.name,price:parseFloat(a.price).toFixed(2),detailUrl:a.url,imageUrl:a.pic+"_220x220.jpg",extMap:a.extMap})}),c},_formatData_like:function(b){var c=[];return a.each(b,function(a){var b,d=!1;a.extMap&&(a.extMap.price20141212?b=a.extMap.price20141212:a.extMap.preprice20141212&&(b=a.extMap.preprice20141212),a.extMap.redpack20141212&&(a.extMap.redpack20141212=100*a.extMap.redpack20141212,d=!0),(a.extMap.mark20141212||a.extMap.presell20141212)&&(d=!0)),"undefined"==typeof b&&(b=a.promotionPrice||a.price),b=parseFloat(b).toFixed(2),c.push({title:a.itemName,price:b,priceLevel:d===!0?k.parse(b):"00",detailUrl:a.url,imageUrl:a.pic+"_220x220.jpg",extMap:a.extMap})}),c},_showLoading:function(a){u[a].innerHTML=q}};return{init:function(){y._init()}}},{requires:["node","dom","event","gallery/template/1.0/","ajax","../../../utils/my-path/my-path","./relative-effect","../../../utils/tpl/render","../../../utils/20141212/hongbao-label","../../../utils/price-level/price-level"]}),KISSY.add("cart/mods/global/banner/banner",function(a,b,c){var d=b.all,e="[banner] ";return{inited:!1,init:function(){if(this.inited!==!0&&(this.inited=!0,new c({url:"http://www.taobao.com/go/rgn/cart/top-banner.php",data:{domain:Global.cfg.domain,tpId:Global.cfg.tpId,layout:Global.cfg.layout},dataType:"jsonp",type:"get",success:function(b){if(b&&b.result===!0){var c='<a href="'+b.link+'" target="_blank" data-spm="d4916709"><img alt="'+b.text+'" src="'+b.img+'"></a>',f=d('<div class="cart-banner wp" data-spm="1996481313"></div>').insertBefore("#J_Cart").html(c);b.width&&b.height&&(f.height(b.height).addClass("cart-banner-center"),f.one("a").width(b.width).height(b.height)),a.log(e+"inited.")}}}),parseInt(Global.cfg.period,10)<2)){var b=d("#logo");b&&b.length&&d("a",b).attr("href","http://1111.tmall.com/?20141103&ad_id=&am_id=13013028239339c3ff34&cm_id=&pm_id=")}}}},{requires:["node","ajax"]}),KISSY.add("cart/mods/global/search/search",function(a,b){b.all;return{init:function(){var b="1.1.7/",c=",tbc/search-suggest/"+b,d=["dom","index","plugin/cloud","plugin/tab","plugin/bts","new_suggest.css"];a.use(d.join(c),function(a,b,c,d,e,f){var g=(new f).getBucket(),h=["history","dapei_top","cat","global","list","shop","scene","dapei_bottom","tmall","cloud"],i=[new e({activeCls:"selected",node:"#J_Search li.J_SearchTab"}),new d],j="http://suggest.taobao.com/sug?area=c2c&k=1&bucketid="+g,k="",l=!1;location.href.indexOf("debug=test")>-1&&(l=!0,j="http://suggest.proxy.taobao.org/sug1.php?area=c2c&k=1&bucketid="+g);var m=new c({plugins:i,sugConfig:{sourceUrl:j,node:"#q",resultFormat:k,focused:!0,placeholderEl:"#J_TSearchForm label"},mods:{sort:h,tmall:{tmpl:'<div class="{prefixCls}menu-extras-cate extras-mall" data-key="q={tmall}&suggest=tmall_{$index}&tab=mall"><span class="{prefixCls}menu-key">{tmall}</span><b>\u5929\u732b\u76f8\u5173</b></div>'}}});m.on("beforeFocus",function(){var a=m.get("input"),c=b.parent(a,"form"),d=b.parent(a,2),e=b.prev(d,"label"),f=b.next(d,"i");e&&b.css(e,{color:"#ccc"}),f&&b.hide(f),c.className="search-panel-focused"}),m.on("afterQueryChange",function(a){var c=a.query,d=m.get("input"),e=b.parent(d,2),f=b.prev(e,"label");""!==c&&b.hide(f)}),m.on("beforeBlur",function(){var c=m.get("input"),d=b.parent(c,"form"),e=b.parent(c,2),f=b.prev(e,"label"),g=b.next(e,"i");""===a.trim(c.val())&&(f&&(b.show([f]),b.css(f,{color:"#999"})),g&&b.show(g)),d.className=""}),a.one(".search-triggers").on("mouseenter mouseleave",function(a){var c,d=this,e="add";"mouseleave"===a.type&&(e="remove",c=b.query("li",d),b[e+"Class"].call(d,c,"selected"),b.addClass.call(d,c[0],"selected")),b[e+"Class"].call(d,".search-triggers","triggers-hover")});var n=a.all(".J_SearchTab");n.on("mouseenter",function(){var a=this,c=b.siblings(a);b.addClass(a,"selected"),b.removeClass(c,"selected")}),n.on("click",function(a){var c=this,d=b.parent(c),e=b.children(d)[0];c!==e&&(b.insertBefore(c,e),b.removeClass.call(c,".search-triggers","triggers-hover"),b.addClass.call(c,"#J_TSearchForm","search-panel-focused"),a.halt())})})}}},{requires:["node"]}),KISSY.add("cart/utils/storage/storage",function(a,b){function c(){try{return j in g&&g[j]}catch(a){return!1}}function d(a){return function(){var b=Array.prototype.slice.call(arguments,0);b.unshift(f),l.appendChild(f),f.addBehavior("#default#userData"),f.load(j);
var c=a.apply(h,b);return l.removeChild(f),c}}function e(a){return a.replace(o,"___")}var f,g=window,h={},i=g.document,j="localStorage",k="script";if(h.disabled=!1,h.set=function(){},h.get=function(){},h.remove=function(){},h.clear=function(){},h.transact=function(a,b,c){var d=h.get(a);null==c&&(c=b,b=null),"undefined"==typeof d&&(d=b||{}),c(d),h.set(a,d)},h.getAll=function(){},h.forEach=function(){},h.serialize=function(a){return b.stringify(a)},h.deserialize=function(a){if("string"!=typeof a)return void 0;try{return b.parse(a)}catch(c){return a||void 0}},c())f=g[j],h.set=function(a,b){return void 0===b?h.remove(a):(f.setItem(a,h.serialize(b)),b)},h.get=function(a){return h.deserialize(f.getItem(a))},h.remove=function(a){f.removeItem(a)},h.clear=function(){f.clear()},h.getAll=function(){var a={};return h.forEach(function(b,c){a[b]=c}),a},h.forEach=function(a){for(var b=0;b<f.length;b++){var c=f.key(b);a(c,h.get(c))}};else if(i.documentElement.addBehavior){var l,m;try{m=new ActiveXObject("htmlfile"),m.open(),m.write("<"+k+">document.w=window</"+k+'><iframe src="/favicon.ico"></iframe>'),m.close(),l=m.w.frames[0].document,f=l.createElement("div")}catch(n){f=i.createElement("div"),l=i.body}var o=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g");h.set=d(function(a,b,c){return b=e(b),void 0===c?h.remove(b):(a.setAttribute(b,h.serialize(c)),a.save(j),c)}),h.get=d(function(a,b){return b=e(b),h.deserialize(a.getAttribute(b))}),h.remove=d(function(a,b){b=e(b),a.removeAttribute(b),a.save(j)}),h.clear=d(function(a){var b=a.XMLDocument.documentElement.attributes;a.load(j);for(var c,d=0;c=b[d];d++)a.removeAttribute(c.name);a.save(j)}),h.getAll=function(){var a={};return h.forEach(function(b,c){a[b]=c}),a},h.forEach=d(function(a,b){for(var c,d=a.XMLDocument.documentElement.attributes,e=0;c=d[e];++e)b(c.name,h.deserialize(a.getAttribute(c.name)))})}try{var p="__storejs__";h.set(p,p),h.get(p)!=p&&(h.disabled=!0),h.remove(p)}catch(n){h.disabled=!0}return h.enabled=!h.disabled,h},{requires:["json"]}),KISSY.add("cart/utils/add2cart/add2cart",function(a,b,c,d){var e=b.all;return{addItem:function(a,b){c({url:"/cart/addCartItems.do",data:{_tb_token_:e("#_tb_token_").val(),add:JSON.stringify({tpId:parseInt(Global.cfg.tpId,10),items:[{itemId:a.item_id,skuId:a.sku_id,quantity:a.quantity||1}]})},dataType:"jsonp",success:function(a){var c=null;return a.success?Global.reload():c="CART_ITEM_HAS_SKU_MUST_CHOSE_SKU"===a.errorCode?"\u65e0\u6cd5\u52a0\u5165\u8d2d\u7269\u8f66\uff0c\u8bf7\u5230\u8be5\u5546\u54c1\u9875\u9762\u6dfb\u52a0":a.error||"\u52a0\u5165\u8d2d\u7269\u8f66\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",c&&d.alert(c),b&&b(c)},error:function(){d.alert("\u52a0\u5165\u8d2d\u7269\u8f66\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5"),b&&b("\u52a0\u5165\u8d2d\u7269\u8f66\u5931\u8d25")}})}}},{requires:["node","ajax","../dialog/dialog"]}),KISSY.add("cart/mods/global/relative/sm-rec",function(a,b,c){var d=b.all,e=!1;return{init:function(){if(!e){var b=d("#J_RecTabs");b&&b.length&&(a.use("gallery/switchable/1.3.1/",function(a,b){switchable=new b.Tabs("#J_RecTabs",{switchTo:0,navCls:"recTabsNav",contentCls:"recTabsContent",activeTriggerCls:"recTabsNavActive"})}),a.config({packages:{tbc:{base:"http://g.tbcdn.cn/"}}}),a.use("tbc/add-to-cart/0.0.7/",function(a,d){window.CartPlugin.add2Cart=c.addItem,d.init(b,{preventAll:!0}),d.on("addToCartSuccess",function(){setTimeout(function(){Global.reload()},100)})}),b.all("a.j_AddCart").addClass("J_CartPluginTrigger"),e=!0)}}}},{requires:["node","../../../utils/add2cart/add2cart"]}),KISSY.add("cart/mods/global/chaoshi/address.tpl",function(a,b,c){var d=(b.all,'<ul class="j_Address address">{{#each areas as area}}<li><b code="{{area.province.code}}">{{area.province.text}}</b><span>{{#each area.cities as city}}<a {{#if city.code == value}}class="selected"{{/if}} href="javascript:;" code="{{city.code}}">{{city.text}}</a>{{/each}}</span></li>{{/each}}</ul>');return c(d)},{requires:["node","gallery/template/1.0/"]}),KISSY.add("cart/mods/global/chaoshi/address",function(a,b,c,d,e){function f(a){f.superclass.constructor.call(this,a||{}),this.get("autoInit")&&this.init()}return a.extend(f,d,{pluginInitializer:function(){this.init()},init:function(){this._render(),this._bindEvents()},_render:function(){var a=this._extractData();if(e&&a){var c=e.render(a),d=b.create(c),f=this.get("container");b.append(d,f),this.set("el",this._node=d)}},_extractData:function(){var a=this.get("broadcast"),b=this.get("channel"),c=this.get("data");return a&&a.fire&&(c=a.fire("address."+b+"extractdata")||c),c},_bindEvents:function(){var a=this._node,d=this;a&&c.delegate(a,"click","a",function(c){c.preventDefault();var e=c.currentTarget,f=b.attr(e,"code"),g=b.text(e),h=d.get("broadcast"),i=d.get("channel");h&&h.fire&&h.fire("address."+i+"itemclick",{city:{code:f,text:g||""},currentTarget:e,el:a})})}},{ATTRS:{pluginId:{value:"address"},container:{value:"",setter:function(a){return b.get(a)}},el:{value:"",setter:function(a){return b.get(a)}},broadcast:{value:null},channel:{value:"",setter:function(b){return a.isString(b)&&b?b+".":""}},autoInit:{value:!0},data:{value:{areas:[{province:{text:"\u6c5f\u82cf",code:"1000"},cities:[{text:"\u5357\u4eac",code:"1001"},{text:"\u5f90\u5dde",code:"1002"},{text:"\u5e38\u5dde",code:"1003"}]}]}}}}),f},{requires:["dom","event","base","./address.tpl"]}),KISSY.add("cart/mods/global/chaoshi/area",function(a,b,c){var d=b.all;return{init:function(){c({url:"http://chaoshi.tmall.com/site/getSmSiteInfo.htm",dataType:"jsonp",success:function(b){function c(){i!==!0&&(i=!0,a.use("mui/searchbar/instance/chaoshi",function(a,c){c.build({extraParams:{user_id:b.current.sellerId,cat:"50514008"},autoFocus:!0})}),g.remove(),e.detach("mouseenter",c),f.detach("keydown",c))}if(b&&b.sites&&b.current&&b.current.areaId){a.each(b.sites,function(a){return a.areas&&a.areas[b.current.areaId]?(d("h3","#J_AreaSelector").html(a.siteName+"&nbsp;"+a.areas[b.current.areaId].areaName),!1):void 0});var e=d("#mallSearch");if(!e||0===e.length)return!1;var f=d("#mq"),g=d("label",e),h="\u641c\u7d22\u5929\u732b\u8d85\u5e02\u5546\u54c1";a.trim(f.val())||(g.css("visibility","visible"),g.html(h)),d('<input type="hidden" name="user_id" value="'+b.current.sellerId+'"/>').insertAfter(f);var i=!1;e.on("mouseenter",c),f.on("keydown",c)}}})}}},{requires:["node","ajax","dom","event","./address"]}),KISSY.add("cart/mods/global/chaoshi/chaoshi",function(a,b,c){b.all;return{init:function(){Global.cfg.tpId>0&&c.init()}}},{requires:["node","./area"]}),KISSY.add("cart/mods/global/relative/recommend",function(a,b,c,d){function e(){var b=Global.getCart();if(b){var c=b.getItems(null,20),d=[];return a.each(c,function(a){d.push(a.itemId)}),d.join(",")}return""}var f="recentViewItemList",g="interestItemList",h="recentFavItemList",i=function(a,b){if(-1===a.indexOf(".taobaocdn.")){for(var c=0,d=0,e=a.length;e>d;d++)c+=a.charCodeAt(d);c%=4,c+=2,a="http://img0"+c+".taobaocdn.com/"+(b||"tps")+"/i"+c+"/"+a}return a},j=!1,k=!1,l={init:function(){var d=this;if(d.container=b.get("#interested"),d.container){b.addClass(d.container,"recommendBox"),d.container.innerHTML='<div class="hd"><h2><span>Tmall\u4e3a\u60a8\u63a8\u8350</span></h2><ul class="recommendNav"><li data-idx="0" class="'+f+'">\u6700\u8fd1\u6d4f\u89c8\u8fc7\u7684\u5546\u54c1</li><li data-idx="1" class="'+g+'">\u60a8\u53ef\u80fd\u611f\u5174\u8da3\u7684\u5546\u54c1</li><li data-idx="2" class="'+h+'">\u6700\u8fd1\u6536\u85cf\u7684\u5546\u54c1</li></ul></div><div class="bd"><div class="recommendCont '+f+'"></div><div class="recommendCont '+g+'"></div><div class="recommendCont '+h+'"></div></div>',b.show(d.container),d.carousels=[],d.triggers=b.query("li",d.container),d.panels=b.query("div.recommendCont",d.container),d.length=d.triggers.length,c.on(d.triggers,"click",function(){k=!0,d.switchTo(b.attr(this,"data-idx")-0)}),d.isMouseFocusInPanel=!1,c.on(d.container,"mouseover mouseout",function(a){d.isMouseFocusInPanel="mouseover"===a.type}),d.loadedMod={};var i=a.now(),j=e();a.each(["appId=03038&callback=recommend.renderRecentFavList","appId=03004&callback=recommend.renderRecentViewItemList","appId=03005&callback=recommend.renderInterestItemList"],function(b){a.getScript("http://ald.taobao.com/recommend.htm?"+b+"&t="+i+a.guid()+"&itemIds="+j)})}},renderRecentFavList:function(a){this.render(h,a)},renderRecentViewItemList:function(a){this.render(f,a)},renderInterestItemList:function(a){this.render(g,a)},render:function(c,d){if(!a.isArray(d)||0===d.length)return!1;var e=this.container,f=b.get("div."+c,e),h=b.get("li."+c,e);f.innerHTML="<textarea> "+this.renderList(d)+" </textarea>",f.style.display="block",h.style.display="block",b.data(h,"loaded",!0);var i=d[0].area_url;return i&&b.attr(h,"data-area-url",i),j||(j=!0,k=!0,this.container.style.display="block"),g in this.loadedMod||this.switchTo(c),this.loadedMod[c]=!0,!0},switchTo:function(a){if("string"==typeof a){var c=b.get("li."+a,this.container);if(!c)return;a=b.attr(c,"data-idx")-0}if(!(a>=this.length||a==this.idx)){this.checkLazyload(a),this.prevTrigger&&(b.removeClass(this.prevTrigger,"curNav"),this.prevPanel.style.display="none"),this.prevTrigger=this.triggers[a],this.prevPanel=this.panels[a],this.idx=a;for(var e=this.carousels,f=0,g=e.length;g>f;f++){var h=e[f];h.panelIdx===a?h.start():h.stop()}b.addClass(this.prevTrigger,"curNav"),this.prevPanel.style.display="block";var i=b.attr(this.prevTrigger,"data-area-url");i&&(d.track({url:i}),b.attr(this.prevTrigger,"data-area-url",""))}},autoNext:function(){if(!this.isMouseFocusInPanel&&k){for(var a=this.idx,c=this.length;;){a++,a>=c&&(a=0);var d=this.triggers[a];if(b.data(d,"loaded"))break}this.switchTo(a)}},checkLazyload:function(c){var d=this,e=this.panels[c],f=b.get("textarea",e);if(f)if(e.innerHTML=f.value,b.get("ul.ks-switchable-nav",e))a.use("gallery/switchable/1.3.1/,gallery/datalazyload/1.0.1/",function(a,b){var f=new b.Carousel(e,{effect:"scrollx",easing:"easeOutStrong",viewSize:[915,297],circular:!0,prevBtnCls:"prev",nextBtnCls:"next",steps:5,interval:5,autoplay:!0,nativeAnim:!1,lazyDataType:"img-src"});f.on("beforeSwitch",function(a){0!==a.toIndex||d.isMouseFocusInPanel||d.autoNext()}),f.panelIdx=c,d.carousels.push(f)});else{var g={panelIdx:c,paused:!1,stop:function(){this.timer&&clearInterval(this.timer),this.paused=!0},start:function(){var a=this;a.stop(),a.paused=!1,a.timer=setInterval(function(){a.paused||d.autoNext()},5e3)}};g.start(),d.carousels.push(g)}},renderHeader:function(a){return'<li data-url="#">'+a+"</li>"},renderList:function(a){for(var b=[],c=0,d=a.length;d>c;c++){var e=a[c];e.url=e.url.replace(".N","."+c);var f='<li><p class="img"><a target="_blank" href="'+e.url+'" title="'+e.title+'"><img '+(5>c?"src":"data-ks-lazyload-custom")+'="'+i(e.img)+'" alt="'+e.title+'"/></a></p>';f+=e.promotion_price?'<p class="price"><strong>'+e.promotion_price+"</strong><del>"+e.price+"</del>":'<p class="price"><strong>'+e.price+"</strong>",f+="</p>",f+='<p class="title"><a target="_blank" href="'+e.url+'" title="'+e.title+'">'+e.title+"</a></p>";var g="weekly_sell"in e,h="commentNum"in e;(g||h)&&(f+='<p class="summary">',g&&(f+="\u5468\u9500\u91cf:<b>"+e.weekly_sell+"</b>"),h&&(f+='<a target="_blank" title="'+e.commentNum+'\u4e2a\u8bc4\u8bba" class="commentUrl" href="'+e.url+'&on_comment=1&J_TabBar">\u603b\u8bc4\u8bba:'+e.commentNum+"</a>"),f+="</p>"),f+="</li>",b.push(f)}if(b='<div class="recommendList"><ul class="ks-switchable-content">'+b.join("")+"</ul></div>",d>5){for(var j=['<li class="ks-active">&bull;</li>'],k=Math.ceil(d/5)-1;k;)k--,j.push("<li>&bull;</li>");b+='<div class="trigger prev"><s></s></div><div class="trigger next"><s></s></div><ul class="ks-switchable-nav">'+j.join("")+"</ul>"}return b}};return window.recommend=l,l},{requires:["dom","event","../makepoint/makepoint"]}),KISSY.add("cart/mods/global/toolbar",function(){var a=Global.cfg.guiServer;return KISSY.config({modules:{"toolbar/toolbar":{requires:["./toolbar.css"]}},packages:{toolbar:{base:a+"/tb/toolbar/0.0.3/",ignorePackageNameInUri:!0}}}),{init:function(){KISSY.use("toolbar/toolbar",function(a,b){b.config("feedback",{url:"http://ur.taobao.com/survey/view.htm?id=1884"}),Global.toolbar=new b({items:[{},{list:["pk","feedback","gotop"]}]}),Global.toolbar.render()})}}},{requires:[]}),KISSY.add("cart/mods/global/makepoint/udata",function(a){return{init:function(){a.getScript("http://g.tbcdn.cn/alilog/mlog/xwj.js",function(){try{window._ap_xwj&&_ap_xwj.monitor("201409103146532264",{"sample_rate\u201d:0.01,\u201ddead_line":14259168e5})}catch(a){}})}}},{requires:[]}),KISSY.add("cart/mods/global/makepoint/performance",function(a){function b(a,b){return Math.floor(Math.random()*(b-a))+a}var c=window;return{init:function(){66===b(1,100)&&c.goldlog&&c.goldlog.record&&Global.cfg.from&&Global.cfg.sourceTime&&c.goldlog.record("/xn.10.10","","name="+Global.cfg.from+"_cart&st="+Global.cfg.sourceTime+"&lt="+window.g_config.startTime+"&ft="+a.now(),"H1733390")}}}),KISSY.add("cart/mods/global/other",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=b.all;return{init:function(){if(a.ready(function(){c.init(),l.init(),d.init(),a.later(function(){f.init(),"TB"===Global.cfg.layout&&g.init(),i.init(),o.init(),p.init()},100),q(document).on("click",function(a){Global.broadcast("hidePopup",{ev:a,type:"click"})})}),g_config&&g_config.startTime){var b=(a.now()-g_config.startTime)/1e3;a.log("[Cart] load time: "+b),Global.utils.goldlog("cart3-onload_time",{loadTime:b,useVmData:1})}},renderFooter:function(){"tmall"===Global.cfg.domain?m.init():e.init(),k.init(),h.init()}}},{requires:["node","./makepoint/makepoint","./sidefloat/sidefloat","./relative/relative","./banner/banner","./search/search","./footer/footer","./plugin","../../utils/storage/storage","./relative/sm-rec","./chaoshi/chaoshi","./relative/recommend","./toolbar","./makepoint/udata","./makepoint/performance"]}),KISSY.add("cart/mods/global/lazyload",function(a,b,c){function d(a,c){c=c||1e3;var d=b.get(a);if(null===d)return!1;for(;d!=document&&--c;)if(d=d.parentNode||d.parentElement,null==d)return!1;return!0}function e(){i=b.viewportHeight()+ +l+b.scrollTop()}function f(a){function c(c){b.attr(a,"src",c),b.addClass(b.parent(a,".J_ItemPic"),"img-loaded"),b.removeAttr(a,"lazyload")}var d=b.attr(a,"lazyload");if(d){var e=new Image;e.onerror=function(){c("http://a.tbcdn.cn/p/fp/2011a/assets/space.gif")},e.onload=function(){c(e.src)},e.src=d}}function g(c){var e=c[0];if(!e)return a.log(j+"el not exists."),!1;if(!d(e))return a.log(j+"el not in document."),!1;var g=b.offset(e).top<=i;return g&&("img"===b.nodeName(e)?f(e):c[1].call(c[2])),!g}function h(){if(k.length){e();var b=k.length;k=a.filter(k,g),b!==k.length&&a.log(j+"loadEls, old length: "+b+", new length: "+k.length||0)}else a.log(j+"cache empty.")}var i,j="[lazyload] ",k=[],l=200;return function(b,c,d){var f=a.makeArray(arguments);if(0===f.length)h();else{if(!b)return c.call(d),void 0;e();var i=g(f);i&&k.push(f)}}},{requires:["dom","event"]}),KISSY.add("cart/mods/global/queue",function(a){var b="[queue] ",c=[],d=!1;return{add:function(e,f,g){f=f||window,g=g||[];var h=function(){d=!0,e.apply(f,g)};d===!0||c.length>0?(a.log(b+"processing... add it to queue."),c.push(h)):h()},next:function(){d=!1,this.flush()},flush:function(){if(c.length>0&&d===!1){var a=c.shift();a&&a()}}}}),KISSY.add("cart/mods/global/core",function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n="[Global] ",o=window,p=a.mix({},c.Target),q={},r={GLOBAL_RENDERONCE:"G_RenderOnce",GLOBAL_SHOWCLEARINVAILD:"G_ShowClearInvalid",GLOBAL_RECORDUNDO:"G_RecordUndo",USER_RELOCATEBAR:"U_RelocateBar"},s=null,t=null,u=null,v=null,w=!!~location.hostname.indexOf("daily.taobao.net"),x=!!~location.hostname.indexOf("unit."),y=w?".daily.taobao.net":".taobao.com";return a.mix(Global,{init:function(){var b=this;b.isScrolling=!1;var d="normal",e=parseInt(Global.cfg.type,10);switch(e){case 1:d="promo";break;case 2:d="newPromo";break;case 4:d="lowAmount"}var f=Global.firstData;f&&f.success===!0&&(0===f.globalData.totalSize||f.globalData.totalSize>0&&f.globalData.tpId>0&&f.list&&0===f.list.length)&&(d="empty"),c.on(window,"scroll resize",function(){v&&v.cancel(),v=a.later(Global.lazyload,100)}),s=h.create({type:d,extStatus:e}),j.init()},broadcast:function(b,c){return a.log("[global]:broadcast event:"+b),q[b]=c,p.fire(b,c)},listen:function(b,c){p.on(b,c),q[b]&&c.call(this,a.mix(q[b],{target:this,type:b}))},detach:function(a,b){p.detach(a,b)},request:function(a){return i.call(this,a,s)},Evt:r,updateCart:function(b){b=b||{},t&&clearTimeout(t),t=setTimeout(function(){a.log(n+"start to update."),s.update(b),Global.lazyload(),Global.utils.light()},150)},getSelectedItemsLength:function(){return s.getSelectedItemsLength()},getItemByCartId:function(a){return s.getItemByCartId(a)},addSelectedItems:function(b){a.each(a.makeArray(b),function(a){a&&s.addSelectedItem(a)})},removeSelectedItems:function(b){a.each(a.makeArray(b),function(a){a&&s.removeSelectedItem(a)})},selectAll:function(){s.select()},unselectAll:function(){s.unselect()},getViewPortPage:function(){var c=b.scrollTop(o),d=null,e="",f="",g=0;return a.each(s.orders,function(a){return d=a,a.orderEl.scrollTop()>=c?(e=a.data.startTime,f=a.data.endTime,g=a.data.page,!1):void 0}),f||(e=d.data.startTime,f=d.data.endTime,g=d.data.page),{startTime:e,endTime:f,page:g}},utils:{isDaily:w,tbPath:y,cartPath:(x?"unit.":"")+"cart"+y,toMoney:function(a){return parseFloat(a/100).toFixed(2)},removePicSuffix:function(a){return a.replace(/_(sum|\d{2,5}x\d{2,5})\.jpg$/,"")},light:function(){"undefined"!=typeof Light?Light.light():(u&&clearTimeout(u),u=setTimeout(function(){Global.utils.light(),a.log("[global] retry light.")},1e3))},isEmpty:function(a){for(var b in a)if(void 0!==b&&void 0!==a[b]&&null!==a[b])return!1;return!0},makepoint:function(a){l.track({data:"tbcart."+a})},goldlog:function(b,c){if(c){var d=g.shell;c.browser=d+(d?" "+g[d]:""),c.os=g.os,c.mobile=g.mobile,c.href=location.href,Global.globalData&&(c.cartSize=Global.globalData.totalSize),Global.cfg.client&&(c.client=Global.cfg.client)}o.goldlog&&goldlog.emit?goldlog.emit(b,c):l.track("ued.1.1.2?type=9&_gm:id="+b+(c?"&"+a.param(c):""))},jstracker:function(b,c,d,e){return b?(o._ap&&_ap.push&&_ap.push(["jstracker","_trackCustom","msg="+b+(c?"&file="+c:"")+(a.isUndefined(d)?"":"&line="+d)+(a.isUndefined(e)?"":"&category="+e)]),!0):!1}},lazyload:k,renderFooter:function(){j.renderFooter()},switchCart:function(a){"undefined"==typeof a&&(a="normal"),Global.globalData=null,s&&s.destroy&&s.destroy(),s=h.create({type:a})},empty:function(){"promo"===s.type?s.switchToNormal():Global.switchCart("empty")},temp:{},resetTemp:function(){a.each(Global.temp,function(a,b){Global.temp[b]=void 0})},queue:m,getCart:function(){return s},getCartType:function(){return s.type||"normal"},execCart:function(a,b){var c;return s&&s[a]&&(c=s[a].apply(s,b)),c},reload:function(){s&&"empty"===s.type&&location.reload(),this.switchCart(),b.scrollTop(0)}}),Global},{requires:["dom","event","ajax","cookie","json","ua","../cart/cartFactory","./request","./other","./lazyload","./makepoint/makepoint","./queue"]}),KISSY.add("cart/mods/global/layout",function(a,b,c){var d=b.all,e='<div id="J_FilterBar" class="cart-filter-bar"><ul id="J_CartSwitch" class="switch-cart"></ul><div class="cart-sum">\u5df2\u9009\u5546\u54c1(\u4e0d\u542b\u8fd0\u8d39)\uff1a<strong class="price">&yen;<em id="J_SmallTotal">0.00</em></strong><a id="J_SmallSubmit" class="submit-btn submit-btn-disabled">\u7ed3&nbsp;\u7b97</a></div><div class="wrap-line"><div class="floater" style="width: 0;"></div></div></div><div id="J_CartMain" class="cart-main"><div class="cart-table-th"><div class="wp"><div class="th th-chk"><div id="J_SelectAll1" class="select-all select-all-disabled J_SelectAll"><div class="cart-checkbox"><input class="J_CheckBoxShop" id="J_SelectAllCbx1" type="checkbox" name="select-all" value="true" /><label for="J_SelectAllCbx1">\u52fe\u9009\u8d2d\u7269\u8f66\u5185\u6240\u6709\u5546\u54c1</label></div>&nbsp;&nbsp;\u5168\u9009</div></div><div class="th th-item"><div class="td-inner">\u5546\u54c1\u4fe1\u606f</div></div><div class="th th-info"><div class="td-inner">&nbsp;</div></div><div class="th th-price"><div class="td-inner">\u5355\u4ef7\uff08\u5143\uff09</div></div><div class="th th-amount"><div class="td-inner">\u6570\u91cf</div></div><div class="th th-sum"><div class="td-inner">\u91d1\u989d\uff08\u5143\uff09</div></div><div class="th th-op"><div class="td-inner">\u64cd\u4f5c</div></div></div></div><div id="J_OrderList" data-spm="1997196601"></div><div id="J_Loading" class="loading-bar"><p>\u6b63\u5728\u52aa\u529b\u52a0\u8f7d\u4e2d...</p></div></div><div id="J_FloatBarHolder" class="float-bar-holder"></div><div id="J_FloatBar" class="float-bar clearfix"></div>';return{init:function(){d("#J_Cart").addClass(".cart").html(c(e))}}},{requires:["node","../../utils/tpl/render"]}),KISSY.add("cart/cart",function(a,b,c,d){return{init:function(){d.init(),c.init()}}},{requires:["node","./mods/global/core","./mods/global/layout"]});