/*! umpp 2015-02-28 */
KISSY.add("tbc/umpp/1.4.36/mods/messenger",function(a){function b(a,b){return t.push([a,b])-1}function c(a){return t[a]=null}function d(b,c,d){var e={type:b,content:c},f=d;if(a.isString(d)?(f=m.get("#"+d),d=f.contentWindow):d.contentWindow&&(d=d.contentWindow),i())try{return d.KISSY.TBC.Messenger.fire(b,c)}catch(g){}o?j&&(j.callSWF?j.callSWF("send",[e,h(f)]):j.send(e,h(f))):d.postMessage(n.stringify(e),"*")}function e(b,c){a.each(t,function(a){a&&a[0]===b&&a[1](c)})}function f(b,c){var d,e=(o?"parentFlash="+w+"&childFlash=_MessengerChildFlash_"+a.now()+"&":"")+"domain=taobao.org";a.isString(b)?(d=b,b={}):d=b.src,b.src=d+(d.indexOf("?")>-1?"&":"?")+e;var f=m.create("<iframe>",b);return f.setAttribute("width",1),f.setAttribute("height",1),f.style.position="absolute",m.get(c||"body").appendChild(f)}function g(a,b){u?f(a,b):v.push([a,b])}function h(a){var b=a.src,c=/childFlash=([^&]+)/;if(b){var d=b.match(c);if(d&&d[1])return d[1];throw"iframe has no flashName param"}}function i(){return!1}var j,k=window,l=a.namespace("TBC.Messenger"),m=a.DOM,n=(a.Event,a.UA,a.JSON),o=(document.domain,"undefined"==typeof postMessage||!k.addEventListener),p=-1===location.host.indexOf("daily")&&-1===location.host.indexOf("net"),q="//"+(p?"g.alicdn.com":"assets.daily.taobao.net/g"),r="1.4.36",s=parseFloat(r)?q+"/tbc/umpp/"+r+"/flash-post-message.swf":"flash-post-message.swf",t=[],u=!o,v=[],w="_MessengerFlash_"+a.now();if(!i()||o)if(o){var x=!(a.version<=1.2||a.version>=1.4);a.use(x?"swf":"flash",function(a,b){window._Messenger_Flash_PostMessage=function(a,b){var c=b.type,d=b.msg;if("swfReady"===c){u=!0;for(var g;g=v.pop();)f.apply(null,g)}else"message"==c&&d&&e(d.type,d.content)};var c={src:s,attrs:{width:1,height:1,style:"position:absolute;top:0",id:"umpp-message-id",name:"umpp-message-name"},params:{flashVars:{jsentry:"_Messenger_Flash_PostMessage",swfid:"J_MessengerFlashPostMessage",name:w},allowscriptaccess:"always"}};b&&x?j=new b(c):a.Flash&&a.Flash.add&&a.Flash.add("#J_FlashPostMessageContainer",c,function(a){j=a.swf})})}else k.addEventListener("message",function(b){var c=b.data;if(c&&a.isString(c))try{var d=n.parse(c);e(d.type,d.content)}catch(f){}},!1);else u=!0;return a.mix(l,{register:b,unregister:c,send:d,createIframe:g,fire:e,flashName:w})},{requires:["core"]}),KISSY.add("tbc/umpp/1.4.36/mods/getNick",function(a){var b=a.namespace("TBC.umpp");return b.getNick=function(b){var c=a.Cookie.get("_nk_")||a.Cookie.get("lgc");return b&&c?encodeURIComponent(unescape(c.replace(/\\u/g,"%u"))):c}},{requires:["cookie"]}),KISSY.add("tbc/umpp/1.4.36/mods/trinity",function(a){function b(a,b,c){this.nick=a||"umpp-guest",this.swfurl=b,this.evs=c,this._init()}var c=a.DOM,d=(a.JSON,a.namespace("TBC.umpp")),e="UM_",f=window,g="J_UmppUserContainer",h="_umpp_trinity_",i=b.prototype;return i._init=function(){var b=this,d={src:b.swfurl,attrs:{width:1,height:1,id:"umpp-trinity-id",name:"umpp-trinity-name"},params:{flashVars:{jsentry:h,swfid:e+b.nick+a.now(),group:b.nick},allowscriptaccess:"always"}};f[h]=function(a,c){var d=c.type,e=c.data,f=b.evs,g=f[d];g&&g.call(b,"message"===d?e:null)};var i=!(a.version<=1.2||a.version>=1.4);a.use(i?"swf":"flash",function(a,e){i&&e?b.swf=new e(d):a.Flash&&a.Flash.add&&(c.get("#"+g)||document.body.appendChild(c.create('<div id="'+g+'" style="height:1px;width:1px;overflow:hidden;position:absolute;bottom:1px"></div>')),a.Flash.add("#"+g,d,function(a){b.swf=a.swf}))})},i.fire=function(a,b){return this.swf.callSWF?this.swf.callSWF("fire",[a,b]):(this.swf.fire(a,b),void 0)},i.destroy=function(){var a=this;try{a.swf.destroy?a.swf.destroy():c.remove("#"+g),delete f[h]}catch(b){}},d.Trinity=b},{requires:["dom","json"]}),KISSY.add("tbc/umpp/1.4.36/mods/initGuest",function(a){function b(b,f,g){return e._guestTimer=setTimeout(function(){a.getScript(parseFloat(c)?f+"/tbc/umpp/"+c+"/guest-min.js":"guest.js",function(){parseFloat(a.version,10)>1.1&&a.use(parseFloat(c)?"tbc/umpp/"+c+"/guest":"tbc/umpp/guest")})},d),a.mix(e,{isOnline:b,cdnPath:f,Trinity:g}),e}var c="1.4.36",d=18e4,e=a.namespace("TBC.umpp");return a.mix(e,{register:function(){},send:function(){},destroy:function(){this.trinity&&(this.trinity.destroy(),delete this.trinity),this._guestTimer&&(clearTimeout(this._guestTimer),this._guestTimer=null)}}),e.initGuest=b}),KISSY.add("tbc/umpp/1.4.36/mods/initUser",function(a){function b(b){var c=/onerror|onload|script|svg|eval|function/gi;if(a.isString(b))return b.replace(c,"_");if(a.isObject(b)){for(var d in b)a.isString(b[1])&&(b[d]=b[d].replace(c,"_"));return b}return a.isArray(b)?(b=a.JSON.stringify(b).replace(c,"_"),a.JSON.parse(b)):b}function c(a){o.get("#"+q)||p.createIframe({src:a,id:q,frameborder:0,scrolling:"no"})}function d(b){a.isArray(b)&&b.length&&a.each(b,function(a){"1063"==a.t1&&u.trinity.fire({content:[a],identity:[u.nick,a.t1,"1"].join("-")})})}function e(){p.register("umppready",function(){m=!0,g("master"),g("join")}),p.register("umppdata",function(b){if(a.isArray(b))for(var c=b.length,e=0;c>e;e++){var f=b[e];f.content&&a.isString(f.content)&&(f.content=f.content.replace(/"/g,v))}u.notify(b,!0),d(b)})}function f(b,c){if(!c)return!1;a.isString(c)&&(c=a.JSON.parse(decodeURI(c)));var d=c.body,e=d.content;if(a.isObject(d))if("-"===d.identity)a.each(e,function(b){a.each(u._Events,function(c){c&&b.t1==c[0]&&(b.content&&a.isString(b.content)&&(b.content=b.content.replace(new RegExp(v,"g"),'"')),c[1](b))})});else if(r===d.type)if(k){var f=e[0],h=e[1];"umpp-store-get"===f?u.getItem(h,function(a){b.fire.call(b,{type:r,content:[h,a]},c.from)}):"umpp-store-remove"===f?u.removeItem.call(u,h):"umpp-store-set"===f?u.setItem.apply(u,h):u.send(f,h)}else{var e=d.content;p.fire("umpp-store-get-"+e[0],e[1])}else if(s===d.type){if(!d.includeSelf&&c.from===c.to)return!1;g("message",d.content)}}function g(b,c){a.each(u._SwfEvents,function(a){a&&b===a[0]&&(a[1](c),"message"!==b&&(a[0]=b+"_ed"))})}function h(a){c("//mpp."+(a?"taobao.com":"daily.taobao.net:8080")+"/ajaxconn2.html?appId="+t),m&&g("master")}function i(b,d,i,j){u.trinity=new b(d,i,{master:function(){k=!0,e(),new a.IO({url:location.protocol+"//allot-mpp."+(j?"taobao.com":"daily.taobao.net")+"/allot.do?appId="+t,dataType:"jsonp",timeout:3,success:function(a){if(a&&0==a.code){var b=a.tn?a[a.tn]:a.token;b&&(b="&"+(a.tn?a.tn:"token")+"="+b),c("//"+a.host+"/ajaxconn2.html?appId="+t+b),m&&g("master")}else a&&1111==a.status&&h(j)},error:function(){h(j)}})},join:function(){l=!0,(k&&m||!k)&&g("join")},message:function(a){f(this,a)}})}function j(a,b,c,d,e){var f=parseFloat(n)?b+"/tbc/umpp/1.4.35/trinity.swf":"trinity.swf";return u.nick=c,i(d,c,f,a),u.on("join",function(){new e({mc:u})}),u}var k,l,m,n="1.4.36",o=a.DOM,p=a.TBC.Messenger,q="J_Um_Iframe",r="_trinity_notify_private",s="_trinity_notify_public",t=-1===location.host.indexOf("meeting.wangwang")?1064:1065,u=a.namespace("TBC.umpp"),v="@1fuck1@";return a.mix(u,{_Events:[],_SwfEvents:[],_StoreCache:{},_storeData:function(a,b){k&&(this._StoreCache[a]=b)},_removeData:function(a){k&&this._StoreCache[a]&&delete this._StoreCache[a]},on:function(a,b){return(k&&m||!k&&l)&&("master"===a&&k||"join"===a&&l)?(b(),!0):this._SwfEvents.push([a,b])-1},off:function(b){return a.isNumber(b)?this._SwfEvents[b]=null:void 0},register:function(a,c,d){var e=this,f=function(f,g){f&&(f=b(f)),c(f,g),d?e._storeData(a,f):e.removeItem(a)};return e.getItem(a,function(a){a&&f(a,!0)}),e._Events.push([a,f])-1},unregister:function(a){return this._Events[a]=null},send:function(a,b){return k?p.send.call(null,a,b,q):(this.trinity&&this.trinity.fire({type:r,content:[a,b]},"_"+this.nick),void 0)},notify:function(a,b){return this.trinity.fire({type:s,content:a,includeSelf:b,identity:"-"})},setItem:function(a,b){var c=this;c.on("join",function(){c._storeData(a,b),c.send("umpp-store-set",[a,b])})},getItem:function(a,b){var c=this,d=this._StoreCache[a];k&&d?b(d):c.on("join",function(){var d=p.register("umpp-store-get-"+a,function(e){p.unregister(d),c._storeData(a,e),b(e)});c.send("umpp-store-get",a)})},removeItem:function(a){var b=this;b.on("join",function(){b._removeData(a),b.send("umpp-store-remove",a)})},clear:function(a){return this.send("clearTMsg",a)},destroy:function(){this.trinity&&(this.trinity.destroy(),delete this.trinity),o.remove("#"+q),k=void 0,l=void 0,m=void 0,this._StoreCache={}}}),u.initUser=j},{requires:["core"]}),KISSY.add("tbc/umpp/1.4.36/mods/monitorevent",function(a,b){function c(b){this.cfg=a.merge({delay:2e4},b||{}),this.status=1,this._init()}return a.mix(c.prototype,{get:function(a){return this.cfg[a]},set:function(a,b){this.cfg[a]=b},_init:function(){var b=window.g_config;return b?!b.appId||1!=b.appId&&1009!=b.appId?!1:(this.itemId=b.itemId,this.itemId?(this.activeTime=a.now(),this.cfg.mc.send("umpp-monitor-event",[this.itemId,1,this.activeTime].join(",")),this.timer=null,this._bindEvent(),this._addTimer(),this._registerUmppEvent(),void 0):!1):!1},_bindEvent:function(){var a=this;b.on(window,"focus",function(){a._active.call(a),a._focus.call(a)}),b.on(window,"blur",function(){a._active.call(a),a._blur.call(a,!0)}),b.on(window,"mousemove scroll",function(){a._active.call(a)}),b.on(window,"beforeunload",function(){a._close.call(this)})},_registerUmppEvent:function(){var a=this,b=a.cfg.mc;b.register("monitor-start",function(){a.start.call(a)}),b.register("monitor-focustime",function(b){a.set.call(a,"delay",1e3*b.focustime)})},_focus:function(){this.set("focusbluring",!1),this.status&&(this._removeTimer(),this.timer||this._addTimer(),this.cfg.mc.send("umpp-monitor-event",[this.itemId,2,a.now()].join(",")))},_blur:function(b){this.set("focusbluring",!1),this.status&&(b&&this._removeTimer(),this.cfg.mc.send("umpp-monitor-event",[this.itemId,3,a.now()].join(",")))},_active:function(){this.activeTime=a.now()},_close:function(){this.status&&this.cfg.mc.send("umpp-monitor-event",[this.itemId,4,a.now()].join(","))},_addTimer:function(){var b=this;b.timer=setTimeout(function(){var c=a.now();c-b.activeTime>b.cfg.delay&&!b.get("focusbluring")&&(b._blur(),b.set("focusbluring",!0)),b.timer=setTimeout(arguments.callee,b.cfg.delay)},b.cfg.delay)},_removeTimer:function(){this.timer&&(clearTimeout(this.timer),this.timer=null)}}),c},{requires:["event"]}),KISSY.add("tbc/umpp/1.4.36/index",function(a,b,c,d,e,f,g,h){function i(){var b,c=a.Cookie,d=-1===location.host.indexOf("daily"),e=c.get("_l_g_")||c.get("lgc"),f=location.protocol+"//"+(d?"g.alicdn.com":"assets.daily.taobao.net/g"),g=j._Events,i=j._SwfEvents;return b=e?j.initUser(d,f,j.getNick(!0),j.Trinity,h):j.initGuest(d,f,j.Trinity),g&&a.mix(b,{_Events:g}),i&&a.mix(b,{_SwfEvents:i}),a.mix(j,b)}a.version>=1.4&&a.config({modules:{ajax:{alias:["io"]},flash:{alias:["gallery/flash/1.0/"]}}});var j=a.namespace("TBC.umpp");return j.init=i,i()},{requires:["core","tbc/umpp/1.4.36/mods/messenger","tbc/umpp/1.4.36/mods/getNick","tbc/umpp/1.4.36/mods/trinity","tbc/umpp/1.4.36/mods/initGuest","tbc/umpp/1.4.36/mods/initUser","tbc/umpp/1.4.36/mods/monitorevent"]});/*! tmsg 2014-12-29 */
KISSY.add("tbc/tmsg/3.3.14/mods/const",function(a){var b=a.namespace("TMsg",!0);a.mix(b,{apis:{token:location.protocol+"//dianping.{serverHost}/json/token.htm",hoverCount:location.protocol+"//msg.{serverHost}/json/hover_count.htm",unreadMessage:location.protocol+"//msg.{serverHost}/json/hover_message.htm",ignore:location.protocol+"//msg.{serverHost}/json/hover_ignore.htm",buyerHistory:location.protocol+"//msg.{serverHost}/json/history_msg_tag.htm?userType=1",sellerHistory:location.protocol+"//msg.{serverHost}/json/history_msg_tag.htm?userType=2",buyerHistoryList:location.protocol+"//msg.{serverHost}/json/history_message_list.htm?userType=1",sellerHistoryList:location.protocol+"//msg.{serverHost}/json/history_message_list.htm?userType=2",message_list_for_hover:location.protocol+"//msg.{serverHost}/json/message_list_for_hover.htm",buyerSettingList:location.protocol+"//msg.{serverHost}/json/show_msg_setting.htm?source=1",sellerSettingList:location.protocol+"//msg.{serverHost}/json/show_msg_setting.htm?source=3",SettingSet:location.protocol+"//msg.{serverHost}/json/msg_setting.htm",popupMessage:location.protocol+"//msg.{serverHost}/json/popup_msg_list.htm",popupMessageReaden:location.protocol+"//msg.{serverHost}/json/read_popup_msg.htm",appReaden:location.protocol+"//msg.{serverHost}/json/message_read.htm",popupReaden:location.protocol+"//msg.{serverHost}/json/read_popup_msg.htm",deleteMessage:location.protocol+"//msg.{serverHost}/message/delete_system_message.htm"}}),a.mix(b,{temps:{panel:{foot:'<div class="J_Tmsg_Panel_Foot tmsg_panel_foot">   <a class="J_Tmsg_Button_Setting tmsg_button_setting" data-tips="setting" title="\u6d88\u606f\u8bbe\u7f6e" href="#">\u8bbe\u7f6e</a>   <a class="J_Tmsg_Button_Feedback tmsg_button_feedback" data-tips="feedback" title="\u610f\u89c1\u53cd\u9988" href="http://ur.taobao.com/survey/view.htm?spm=1.6659421.0.0.Nmaw77&id=1990&scm=1229.325.1.1" target="_blank">\u53cd\u9988</a>   <span class="J_Tmsg_Button_CheckAll_Wrap tmsg_button_check-all_wrap">       <a class="J_Tmsg_Button_CheckAll tmsg_button_check-all" href="#" target="_blank">\u67e5\u770b\u5168\u90e8</a>   </span></div>',apps:{apps_head:'<div class="J_Tmsg_Panel_Head tmsg_panel_head">   <h2 class="J_Tmsg_Panel_Title tmsg_panel_title">\u672a\u8bfb\u65b0\u6d88\u606f</h2>   <a class="J_Tmsg_Button_ReadAll tmsg_button_read-all" data-tip="ignoreAll" title="\u5ffd\u7565\u6240\u6709\u6d88\u606f" href="#">\u5168\u90e8\u8bbe\u4e3a\u5df2\u8bfb</a></div>',apps_head2:'<div class="J_Tmsg_Panel_Head tmsg_panel_head">   <h2 class="J_Tmsg_Panel_Title tmsg_panel_title">{title}</h2>   <a class="J_Tmsg_Button_GoBack tmsg_button_go-back" data-tips="read_all" href="#">\u8fd4\u56de</a></div>',apps_body:'<div class="J_Tmsg_Panel_AppsBody tmsg_panel_body">   <img style="display:block;margin:30px auto" width="48" height="48" src="//gtd.alicdn.com/tps/i4/T1HcvHXd4nXXb6ROYh-48-48.gif" /></div>',apps_item:'<div class="J_Tmsg_App tmsg_app {shopClass}" data-app-id="{appId}" data-app-type="{appType}">   <h3 class="tmsg_app_title">       <em class="tmsg_app_title_app-name">{mainTitle}</em>       <span class="tmsg_app_title_new-info">{subTitle}</span>   </h3>   <ul class="tmsg_app_list {single}">{subList}</ul>   <a class="J_Tmsg_Button_CloseApp tmsg_button_close-app" title="\u5ffd\u7565\u8be5\u6d88\u606f" href="#">\u5173\u95ed</a>   {moreIcon}   {extraButton}</div>',apps_item_single:'<div class="J_Tmsg_App tmsg_app {shopClass}" data-app-id="{appId}" data-message-id="{messageId}">   <h3 class="tmsg_app_title">       <em class="tmsg_app_title_app-name">{mainTitle}</em>       <span class="tmsg_app_title_new-info">{subTitle}</span>   </h3>   <ul class="tmsg_app_list tmsg_app_list_single">       <li class="tmsg_details_item">           <a class="tmsg_details_item_thumb" href="{link}" target="_blank">               <img src="{pic}" width="60" height="60" alt=""/>               {tips}           </a>           <h4 class="tmsg_details_item_title">               <a href="{link}" target="_blank">{title}</a>           </h4>           <p class="tmsg_details_item_info">               <a href="{link}" target="_blank">{info}</a>           </p>           <a class="tmsg_link" href="{actionUrl}" target="_blank">{actionName}</a>       </li>   </ul><span class="J_Tmsg_App_Remove tmsg_app_btn_remove" title="\u5220\u9664\u8fd9\u6761\u6d88\u606f">\u5220\u9664</span></div>',apps_item_subItem:'<li class="tmsg_app_list_item">   <a class="{klass}" href="{link}" {target}>       <img class="tmsg_app_list_item_thumb" width="60" height="60" src="{thumb}" alt="" />   </a>   {tips}   {roundMask}   {tipsFixIeNumber}</li>',apps_item_subItem_single:'<li class="tmsg_details_item">   <a class="J_Tmsg_Apps_Single-Item_Link tmsg_details_item_thumb" href="{link}" target="_blank">       <img src="{pic}" width="60" height="60" alt=""/>       {tips}   </a>   <h4 class="tmsg_details_item_title">       <a class="J_Tmsg_Apps_Single-Item_Link" href="{link}" target="_blank">{title}</a>   </h4>   <p class="tmsg_details_item_info">       <a class="J_Tmsg_Apps_Single-Item_Link" href="{link}" target="_blank">{info}</a>   </p>   <a class="J_Tmsg_Apps_Single-Item_Link tmsg_link" href="{actionUrl}" target="_blank">{actionName}</a></li>',apps_item_tips:'<p class="tmsg_app_list_item_tip"><span>{tips}</span><i></i></p>',apps_item_roundMask:'<p class="tmsg_app_list_item_tip_fixie-mask"></p>',apps_item_tips_fixIeNumber:'<span class="tmsg_app_list_item_tip_fixie-num"><span>{num}</span><i></i></span>',apps_item_icon_more:'<a class="tmsg_button_more" href="#">\u66f4\u591a</a>',apps_item_button_deploy:'<a class="J_Tmsg_Button_DeployApp tmsg_button_deploy-app" href="#">\u5c55\u5f00</a>',apps_item_button_linkout:'<a class="J_Tmsg_Button_LinkoutToAPP tmsg_button_linkout-to-app" href="{link}" target="_blank">\u67e5\u770b</a>'},errors:{no_message_with_history:'<div class="tmsg_error">   <p class="tmsg_error_notice">       <img width="23" height="14" src="//gtms02.alicdn.com/tps/i2/T1KLt9FuVaXXXIaF_b-23-14.png" alt=""/>       <span>\u6ca1\u6709\u65b0\u6d88\u606f\u4e86</span>       <img width="23" height="14" src="//gtms01.alicdn.com/tps/i1/T1xwX6FshtXXXIaF_b-23-14.png" alt=""/>   </p>   <div class="tmsg_error_pic tmsg_error_pic_type1"></div>   <a class="J_Tmsg_Button_CheckPrevMsgs tmsg_button_check-prev-msgs" href="#">\u67e5\u770b\u4e4b\u524d\u7684\u6d88\u606f</a></div>',no_message_without_history:'<div class="tmsg_error">   <p class="tmsg_error_notice">       <img width="23" height="14" src="//gtms02.alicdn.com/tps/i2/T1KLt9FuVaXXXIaF_b-23-14.png" alt=""/>       <span>\u6ca1\u6709\u65b0\u6d88\u606f\u4e86</span>       <img width="23" height="14" src="//gtms01.alicdn.com/tps/i1/T1xwX6FshtXXXIaF_b-23-14.png" alt=""/>   </p>   <div class="tmsg_error_pic tmsg_error_pic_type1"></div></div>',no_message_when_setting:'<div class="tmsg_error">   <p class="tmsg_error_notice">       <img width="23" height="14" src="//gtms02.alicdn.com/tps/i2/T1KLt9FuVaXXXIaF_b-23-14.png" alt=""/>       <span>\u4f60\u8fd8\u6ca1\u6709\u6536\u5230\u8fc7\u6d88\u606f\u54e6\uff0c\u7b49\u6536\u5230\u4e86\u518d\u6765\u8bbe\u7f6e\u5427\u3002</span>       <img width="23" height="14" src="//gtms01.alicdn.com/tps/i1/T1xwX6FshtXXXIaF_b-23-14.png" alt=""/>   </p>   <div class="tmsg_error_pic tmsg_error_pic_type2"></div></div>',network_anomaly:'<div class="tmsg_error">   <p class="tmsg_error_notice">       <img width="23" height="14" src="//gtms02.alicdn.com/tps/i2/T1KLt9FuVaXXXIaF_b-23-14.png" alt=""/>       <span>\u7f51\u7edc\u5f02\u5e38\uff0c<a class="J_Tmsg_Button_Refresh tmsg_button_refresh" href="#">\u5237\u65b0</a>\u4e00\u4e0b</span>       <img width="23" height="14" src="//gtms01.alicdn.com/tps/i1/T1xwX6FshtXXXIaF_b-23-14.png" alt=""/>   </p>   <div class="tmsg_error_pic tmsg_error_pic_loading"></div></div>'}},details:{typeWrap:'<h3 class="tmsg_app_title">   <em class="tmsg_app_title_app-name">{typeTitle}</em></h3><ul class="tmsg_details_auction-list">{list}</ul>',singleWrap:'<ul class="tmsg_details_logistics-list">{list}</ul>',itemTemp:'<li class="tmsg_details_item">   <a class="tmsg_details_item_thumb" href="{link}" target="_blank">       <img src="{pic}" width="60" height="60" alt=""/>       {tips}   </a>   <h4 class="tmsg_details_item_title">{title}</h4>   <p class="tmsg_details_item_info_logistics-status">{info}</p>   <a class="tmsg_link" href="{link}" target="_blank">{actionName}</a></li>'},setting:{wrap:'<h3 class="tmsg_app_title">   <em class="tmsg_app_title_app-name">{title}</em></h3><ul class="tmsg_app_settilg-list">{list}</ul>',list:'<li class="J_Tmsg_App_Setting_Item tmsg_app_settilg-item" data-app-id="{appId}">   <em class="tmsg_app_settilg-item_name">{appName}</em>   <span class="tmsg_app_settilg-item_edit tmsg_app_settilg-item_status_{status}" data-status="{statusNum}">       <a class="J_Tmsg_Setting_App_Edit_Button tmsg_app_settilg-item_button-edit" href="#">\u8bbe\u7f6e</a>   </span></li>'},strong:{wrap:'<div class="J_Tmsg_Panel_StrongPop tmsg_panel_strong_popup">   <div class="tmsg_panel_strong_list">{list}</div>   <div class="J_Tmsg_Panel_Strong_Button tmsg_panel_strong_button">       <a class="J_Tmsg_Panel_Strong_Button_Prev tmsg_panel_strong_button_prev " href="#">\u4e0a\u4e00\u4e2a</a>       <a class="J_Tmsg_Panel_Strong_Button_Next tmsg_panel_strong_button_next" href="#">\u4e0b\u4e00\u4e2a</a>   </div></div>',item:'<div class="tmsg_panel_strong_item" data-message-id="{appId}" data-app-type="{appType}">   <h3 class="tmsg_app_title">       <em class="tmsg_app_title_app-name">{mainTitle}</em>       <span class="tmsg_app_title_new-info">{subTitle}</span>   </h3>   <ul class="tmsg_app_list tmsg_app_list_single">       <li class="tmsg_details_item">           <a class="J_Tmsg_Strong_Item_Read tmsg_details_item_thumb" href="{link}" target="_blank">               <img src="{pic}" width="60" height="60" alt="">               {tips}           </a>           <h4 class="tmsg_details_item_title">               <a class="J_Tmsg_Strong_Item_Read" href="{link}" target="_blank">{title}</a>           </h4>           <p class="tmsg_details_item_info_logistics-status">               <a href="{link}" target="_blank">{info}</a>           </p>           <a class="J_Tmsg_Strong_Item_Read tmsg_link" href="{link}" target="_blank">{actionName}</a>       </li>   </ul>   <a class="J_Tmsg_Popup_Button_CloseApp tmsg_button_close-app" href="#">\u5173\u95ed</a></div>'}}})}),KISSY.add("tbc/tmsg/3.3.14/mods/utils",function(a){var b=a.DOM,c=(a.Event,TMsg),d=window,e=!~location.host.indexOf("daily.taobao.net"),f="tbc/tmsg/3.3.14/plugin/";a.mix(c,{event:{},plugin:{}}),a.mix(c,{isIE6:d.ActiveXObject&&!d.XMLHttpRequest,isKS16:!(parseFloat(a.version,10)>1.1),isDebug:!!~location.search.indexOf("ks-debug"),isOnline:e,cdnHost:e?location.protocol+"//g.alicdn.com/":location.protocol+"//assets.daily.taobao.net/g/",serverHost:e?"taobao.com":"daily.taobao.net",environment:TB.Global&&TB.Global.version>=2?"New Global":TB.SellerGlobal?"Seller Global":"Old Global"}),a.mix(c,{sm:{init:function(){window.UA_Opt&&window.ua||(window.UA_Opt=window.UA_Opt||{LogVal:"ua",MaxMCLog:3,MaxMPLog:3,MaxKSLog:3,Token:(new Date).getTime()+":"+Math.random(),SendMethod:8,Flag:14222},window.ua="",a.getScript(location.protocol+"//acjs.aliyun.com/actionlog/js/ua.js",function(){try{UA_Opt.reload()}catch(a){}},"GBK"))},ua:function(){var b=window.ua;return UA_Opt.Token=a.now()+":"+Math.random(),UA_Opt.reload(),b}},use:function(b,d){var e=[b],g=b+"-min.js";a.getScript(c.cdnHost+f+g,function(){c.isKS16?d&&d():a.use(f+e.join(","+f),function(){d&&d()})})},ajax:function(b,c,d){var e={t:a.now(),_input_charset:"utf-8"};a.IO.jsonp(b,a.merge(e,c),function(a){d&&d(a)})},deal:function(d,e){if("string"==typeof d&&(d=a.JSON.parse(d)),d.status==e.success.code)e.success.callback&&e.success.callback(d);else if(d.status==e.noLogin.code)e.noLogin.callback?e.noLogin.callback(d):c.error.noLogin();else if("0"==d.status){var f=b.get(".J_Tmsg_Panel_AppsBody");b.html(f,c.temps.panel.errors.network_anomaly)}else if("delErr"==d.status){var f=b.get(".J_Tmsg_Panel_AppsBody");b.html(f,c.temps.panel.errors.network_anomaly),e.delErr.callback&&e.delErr.callback(d)}else e.error.callback&&e.error.callback(d)},getNick:function(){return c.fromUnicode(a.Cookie.get("_nk_"))},setToken:function(){if(c.token)return!1;var b=location.protocol+"//dianping."+c.serverHost+"/json/token.htm";a.IO.jsonp(b,{_fetchToken:!0},function(a){c.token=a.token})},getToken:function(b){c.token?b&&b(c.token):a.IO.jsonp(c.renderUrl(c.apis.token),{_fetchToken:!0},function(d){a.mix(c,{token:d.token}),b&&b(d.token)})},fromUnicode:function(a){return a.replace(/\\u([a-f\d]{4})/gi,function(a,b){return String.fromCharCode(parseInt(b,16))})},sendStatistic:function(b){b&&((new Image).src=location.protocol+"//gm.mmstat.com/sns."+b+"?cache="+a.now())},switchGlobal:function(a){switch(c.environment){case"Seller Global":a.seller&&a.seller();break;default:a.common&&a.common()}},renderUrl:function(b){return a.substitute(b,{serverHost:c.serverHost})},getStrLength:function(a){for(var b=a.length,c=0,d=0;b>d;d++)a.charCodeAt(d)<27||a.charCodeAt(d)>126?c+=2:c++;return c},substringWithinLimit:function(a,b){if(!a||!b)return"";for(var c=0,d=0,e="",f="...";d<a.length;d++){if(a.charCodeAt(d)>255?c+=2:c++,c>b)return e+f;e+=a.charAt(d)}return a+f},setScroll:function(){},delArrayItem:function(a,b){return 0>b?a:a.slice(0,b).concat(a.slice(b+1,a.length))}})}),KISSY.add("tbc/tmsg/3.3.14/mods/tmsg",function(a){var b,c,d,e,f=(a.IO,a.DOM),g=a.JSON,h=a.Event,i=TMsg,j=(i.apis,i.temps),k=a.TBC.umpp,l="3.3.14",m={},n=!1,o=!1,p=!1,q=!(!i.isKS16&&!i.isIE6);return i.base={dataFormatting:function(b){return a.isString(b)?g.parse(b):a.isObject(b)&&b.content?a.isString(b.content)?g.parse(b.content):a.isObject(b.content)?b.content:void 0:b},registUmpp:function(){var b,e,f=this,g=2,h="tmsgexpiretime";d=k.register("1067",function(c,d){e=f.dataFormatting(c),p=!1,k.setItem("1067",a.merge(m,e.content?e.content:e)),!d&&i.sendStatistic("21.50"),m=a.merge(m,e),f.renderHeadNum(e),b&&!d&&k.setItem(h,a.now())},!0),c=k.on("master",function(){b=!0,k.getItem(h,function(b){(!b||a.now()-1*b>=60*g*60*1e3)&&(k.setItem("1067",{}),f.fetchMsg())})})},fetchMsg:function(){var b=this,c=i.renderUrl(i.apis.hoverCount);i.ajax(c,{},function(c){i.deal(c,{noLogin:{code:"-1"},success:{code:"1",callback:function(c){m=a.merge(m,c.content),k.setItem("1067",m),k.notify([{t1:"1067",content:m}],!0),b.renderHeadNum(m)}}})})},cpg:function(){function a(a){k&&k.getItem(a,function(b){b&&(k.removeItem(a),window.console&&window.console.debug&&console.debug("\u6e05\u7406\u672c\u5730\u7f13\u5b58["+a+"]\u5b8c\u6bd5\uff01"))})}var b="1067_cpg";k&&k.getItem(b,function(a){var c=["(\u3000\xb4\u2200\uff40)","(\uff9f\uff70\uff9f)","(*\uff40\u25bd\xb4*)","( \uff9f\u0414\uff9f)","\uff08\uff3e\uff10\uff3e\uff09"],d=Math.floor(5*Math.random());a||(k.setItem("tmsgexpiretime",0),k.setItem("1067",{})),k.setItem(b,c[d])}),a("20141212")},init:function(){var a=this;if(!q&&a.renderHoverBase(),a.registUmpp(),a.cpg(),q){var b=f.get(".J_Menu","#J_Tmsg");f.remove(".menu-bd","#J_Tmsg"),f.remove(".tmsg_basic_arrow","#J_Tmsg"),h.on(b,"click",function(){i.switchGlobal({common:function(){location.href=i.renderUrl("http://msg.{serverHost}/message/list.htm")},seller:function(){location.href=i.renderUrl("http://msg.{serverHost}/seller/seller_list.htm")}})})}else h.delegate("#J_Tmsg","mouseenter",".J_Menu",function(){i.sendStatistic("21.1")}),i.switchGlobal({common:function(){},seller:function(){h.on(".J_Tmsg_Basic","mouseenter",function(){!q&&a.renderHover()})}})},destroy:function(){!!m&&(m={}),k.unregister(d),k.off(c)},renderHoverBase:function(){var a=f.get(".J_Tmsg_Panel_Apps"),b=f.create(j.panel.apps.apps_head),c=f.create(j.panel.apps.apps_body),d=f.create(j.panel.foot);f.append(b,a),f.append(c,a),f.append(d,a)},resetLocalData:function(b,c){if(a.isArray(b))m.apps=[],m.buyerCount=0,m.sellerCount=0,k.setItem("1067",m),k.notify([{t1:"1067",content:m}],!0);else{var d=0;for(1==c?m.buyerCount-=1:(m.buyerCount-=1,m.sellerCount-=1);d<m.apps.length;d++)m.apps[d].appId==b&&(m.apps=i.delArrayItem(m.apps,d));m.buyerCount<0&&(m.buyerCount=0),m.sellerCount<0&&(m.sellerCount=0),k.setItem("1067",m),k.notify([{t1:"1067",content:m}],!0)}},renderHeadNum:function(a){var b=this,c=f.get("#J_Tmsg"),d=f.get(".J_Tmsg_Logo",c),e=f.get(".J_Tmsg_Logo_Loading",c),g=f.get(".J_Tmsg_Logo_Icon",c),h=f.get(".J_Tmsg_Logo_Unread",c);f.hide(e),f.show(g),a.buyerCount>0?i.switchGlobal({common:function(){f.addClass(d,"tmsg_logo_active"),f.html(h,a.buyerCount)},seller:function(){a.sellerCount>0&&(f.addClass(d,"tmsg_logo_active"),f.html(h,a.sellerCount))}}):(f.removeClass(d,"tmsg_logo_active"),f.html(h,"")),a.popupCount>0&&b.renderPopup()},renderPopup:function(){var b=this,c=i.renderUrl(i.apis.popupMessage);n||(n=!0,i.ajax(c,{},function(c){i.deal(c,{noLogin:{code:"-1"},success:{code:"1",callback:function(c){if(c.msgList.length){var d=f.get("#J_Tmsg"),e=f.get(".J_Tmsg_Panel_Strong",d),g="";a.each(c.msgList,function(c){g+=a.substitute(j.strong.item,{link:c.actionUrl,pic:c.picUrl,tips:b.renderTips(c.tips),appId:c.messageId,typeId:c.typeId,mainTitle:c.mainTitle,subTitle:c.subTitle,title:b.getTitle(c.contentMsg),info:b.getInfo(c.contentMsg.info.content),actionName:c.contentMsg.actionName.content||""})});var i=f.create(a.substitute(j.strong.wrap,{list:g}));if(1==c.msgList.length){var k=f.get(".tmsg_panel_strong_item",i);f.remove(f.get(".J_Tmsg_Panel_Strong_Button",i)),f.addClass(k,"J_Tmsg_Panel_Strong_Item_Active")}else{var l=f.query(".tmsg_panel_strong_item",i);a.each(l,function(a){f.removeClass(k,"J_Tmsg_Panel_Strong_Item_Active"),f.hide(a)}),f.addClass(l[0],"J_Tmsg_Panel_Strong_Item_Active"),f.show(l[0])}f.append(i,e),b.toggleStrongPanel(),h.delegate(d,"click",".J_Tmsg_Popup_Button_CloseApp",function(a){a.preventDefault(),b.popupClose()}),h.delegate(d,"click",".J_Tmsg_Panel_Strong_Button_Prev",function(a){a.preventDefault(),b.popupPrev(a.target)}),h.delegate(d,"click",".J_Tmsg_Panel_Strong_Button_Next",function(a){a.preventDefault(),b.popupNext(a.target)}),h.delegate(d,"click",".J_Tmsg_Strong_Item_Read",function(a){b.popupReaded(f.parent(a.target,".tmsg_panel_strong_item"))})}}}})}))},renderHoverList:function(b){var c=this,d="",e=f.get(".J_Tmsg_Panel_Apps"),g=f.get(".J_Tmsg_Panel_AppsBody",e);p=!0,c.setMessageCenterLink(e),i.switchGlobal({common:function(){b.apps&&b.apps.length?(a.each(b.apps,function(b){d+=a.substitute(j.panel.apps.apps_item,{appId:b.appId,appType:b.messageType,shopClass:"",mainTitle:b.mainTitle,subTitle:b.subTitle,subList:c.renderAppSubList(b.msgList,b.actionUrl),single:1==b.msgList.length?"tmsg_app_list_single":"",moreIcon:c.getAppMoreIcon(b),extraButton:c.getAppExtraButton(b)})}),f.html(g,d),c.setPanelBody(e),f.show(f.get(".J_Tmsg_Button_ReadAll",e))):c.switchNoMessageTemp()},seller:function(){b.sellerCount>0&&b.apps&&b.apps.length?(a.each(b.apps,function(b){d+="Seller Global"==i.environment&&1==b.messageType?"":a.substitute(j.panel.apps.apps_item,{appId:b.appId,appType:b.messageType,shopClass:"",mainTitle:b.mainTitle,subTitle:b.subTitle,subList:c.renderAppSubList(b.msgList,b.actionUrl),single:1==b.msgList.length?"tmsg_app_list_single":"",moreIcon:c.getAppMoreIcon(b),extraButton:c.getAppExtraButton(b)})}),f.html(g,d),c.setPanelBody(e),f.show(f.get(".J_Tmsg_Button_ReadAll",e))):c.switchNoMessageTemp()}}),!o&&c.bindBaseEvent()},renderHover:function(){var b=this,c=i.renderUrl(i.apis.unreadMessage);q||p||(!m.apps&&m.buyerCount||m.newMsgTag?i.ajax(c,{},function(c){i.deal(c,{noLogin:{code:"-1"},success:{code:"1",callback:function(c){m=a.merge(m,c.content,{newMsgTag:!1}),k.setItem("1067",m),k.notify([{t1:"1067",content:m}],!0),b.renderHoverList(m)}}})}):b.renderHoverList(m))},renderAppSubList:function(b,c){var d=this,e="";if(b.length>1)for(var f=0;f<b.length;f++)e+=a.substitute(j.panel.apps.apps_item_subItem,{klass:c?"J_Tmsg_Button_LinkoutToAPP":"J_Tmsg_Button_DeployApp",thumb:b[f].picUrl,link:c||"#",tips:d.renderTips(b[f].tips),target:c?'target="_blank"':""});else e+=a.substitute(j.panel.apps.apps_item_subItem_single,{link:b[0].actionUrl,title:d.getTitle(b[0].contentMsg),pic:b[0].picUrl,tips:d.renderTips(b[0].tips),info:d.getInfo(b[0].contentMsg.info.content),actionUrl:b[0].actionUrl||"",actionName:b[0].contentMsg.actionName.content||""});return e},renderTips:function(b){return b?a.substitute(j.panel.apps.apps_item_tips,{tips:b}):""},renderDeployTypesItem:function(b){var c=this,d="";return a.each(b,function(b){d+=a.substitute(j.details.itemTemp,{link:b.actionUrl,pic:b.picUrl,tips:c.renderTips(b.tips),title:c.getTitle(b.contentMsg),info:c.getInfo(b.contentMsg.info.content),actionName:b.contentMsg.actionName.content||""})}),d},renderDeploysingle:function(b){var c=this,d=f.get("#J_Tmsg"),e=f.get(".J_Tmsg_Panel_Detail",d),g=f.get(".J_Tmsg_Panel_AppsBody",e);f.html(g,a.substitute(j.details.singleWrap,{list:c.renderDeployTypesItem(b.types[0].msgList)})),c.togglePanel(e)},renderDeployTypes:function(b){var c=this,d=f.get("#J_Tmsg"),e=f.get(".J_Tmsg_Panel_Detail",d),g=f.get(".J_Tmsg_Panel_AppsBody",e),h="";a.each(b.types,function(b){h+=a.substitute(j.details.typeWrap,{typeTitle:b.subTitle,list:c.renderDeployTypesItem(b.msgList)})}),f.html(g,h),c.togglePanel(e)},getInfo:function(a){return a?i.getStrLength(a)>28?i.substringWithinLimit(a,28):a:""},getTitle:function(a){var b=a.title.content,c=i.getStrLength(b);return 0==c?"":c>0&&28>=c?b:a.info.content?i.substringWithinLimit(b,28):58>=c?b:i.substringWithinLimit(b,58)},getAppMoreIcon:function(a){return a.gtThree?j.panel.apps.apps_item_icon_more:""},getAppExtraButton:function(b){return 1==b.msgList.length?"":b.actionUrl?a.substitute(j.panel.apps.apps_item_button_linkout,{link:b.actionUrl}):j.panel.apps.apps_item_button_deploy},setMessageCenterLink:function(a){var b=f.get(".J_Tmsg_Button_CheckAll",a);i.switchGlobal({common:function(){if(f.removeClass(b,"J_Tmsg_Button_CheckAll"),m.hasSellerMsg){var c=f.get(".J_Tmsg_Button_CheckAll_Wrap",a);f.html(c,'<a href="'+i.renderUrl("http://msg.{serverHost}/message/list.htm?scm=1229.325.1.2")+'" target="_blank">\u4e70\u5bb6\u6d88\u606f</a><span style="margin:0 7px">|</span><a href="'+i.renderUrl("http://msg.{serverHost}/seller/seller_list.htm?scm=1229.325.1.3")+'" target="_blank">\u5356\u5bb6\u6d88\u606f</a>')}else f.attr(b,"href",i.renderUrl("http://msg.{serverHost}/message/list.htm?scm=1229.325.1.2"))},seller:function(){f.removeClass(b,"J_Tmsg_Button_CheckAll"),f.attr(b,"href",i.renderUrl("http://msg.{serverHost}/seller/seller_list.htm?scm=1229.325.1.3"))}})},setNoMessageTemp:function(a){var b=this,c=f.get(".J_Tmsg_Panel_Apps"),d=f.create(j.panel.apps.apps_head),e=f.create(j.panel.apps.apps_body),g=f.create(j.panel.foot);f.html(c,""),f.append(d,c),f.append(e,c),f.append(g,c),b.setMessageCenterLink(c),i.ajax(a,{},function(a){i.deal(a,{noLogin:{code:"-1"},success:{code:"1",callback:function(a){var b=f.get(".J_Tmsg_Panel_Apps"),c=f.get(".J_Tmsg_Panel_AppsBody",b);"false"!=a.historyTag?f.html(c,j.panel.errors.no_message_with_history):f.html(c,j.panel.errors.no_message_without_history),f.hide(f.get(".J_Tmsg_Button_ReadAll",b))}}})})},switchNoMessageTemp:function(){var a=this;i.switchGlobal({common:function(){var b=i.renderUrl(i.apis.buyerHistory);a.setNoMessageTemp(b)},seller:function(){var b=i.renderUrl(i.apis.sellerHistory);a.setNoMessageTemp(b)}})},setHistoryMessage:function(b){var c=this,d=f.get(".J_Tmsg_Panel_history");c.readyPanel(d,"\u5386\u53f2\u6d88\u606f"),i.ajax(b,{},function(b){i.deal(b,{noLogin:{code:"-1"},success:{code:"1",callback:function(b){var e=f.get(".J_Tmsg_Panel_AppsBody",d),g=b.msgList,h="";a.each(g,function(b){h+=a.substitute(j.panel.apps.apps_item_single,{appId:b.appId,messageId:b.messageId,shopClass:"",mainTitle:b.mainTitle,subTitle:b.subTitle,link:b.actionUrl,pic:b.picUrl,tips:c.renderTips(b.tips),title:c.getTitle(b.contentMsg),info:c.getInfo(b.contentMsg.info.content),actionUrl:b.actionUrl,actionName:b.contentMsg.actionName.content||""})}),f.html(e,""),f.html(e,h),c.setPanelBody(d),c.togglePanel(d)}}})})},switchHistoryMessage:function(){var a=this;i.switchGlobal({common:function(){var b=i.renderUrl(i.apis.buyerHistoryList);a.setHistoryMessage(b)},seller:function(){var b=i.renderUrl(i.apis.sellerHistoryList);a.setHistoryMessage(b)}})},ignoreSingle:function(a){var b=this,c=f.parent(a,".J_Tmsg_App"),d=f.attr(c,"data-app-id"),e=f.attr(c,"data-app-type");i.getToken(function(a){i.ajax(i.renderUrl(i.apis.ignore),{m_token:a,appId:d},function(a){i.deal(a,{noLogin:{code:"-1"},success:{code:"1",callback:function(){f.remove(c),b.jugHoverEmpty(),b.resetLocalData(d,e)}}})})})},ignoreAll:function(){for(var a=this,b=f.get("#J_Tmsg"),c=f.query(".J_Tmsg_App",b),d=0,e=[];d<c.length;d++)e.push(f.attr(c[d],"data-app-id"));i.getToken(function(b){i.ajax(i.renderUrl(i.apis.ignore),{m_token:b,appId:e.join(",")},function(b){i.deal(b,{noLogin:{code:"-1"},success:{code:"1",callback:function(){var b=f.get(".J_Tmsg_Panel_AppsBody");f.html(b,""),a.jugHoverEmpty(),a.resetLocalData(e)}}})})})},deployApp:function(b){var c=this,d=f.parent(b,".J_Tmsg_Panel_Apps"),e=f.parent(b,".J_Tmsg_App"),g=f.attr(e,"data-app-id"),h=f.attr(e,"data-app-type");a.getScript(i.cdnHost+"tbc/tmsg/"+l+"/content-min.css",{success:function(){i.ajax(i.renderUrl(i.apis.message_list_for_hover),{appId:g},function(a){i.deal(a,{noLogin:{code:"-1"},success:{code:"1",callback:function(a){var b=f.get("#J_Tmsg"),i=f.get(".J_Tmsg_Panel_Detail",b);c.readyPanel(i,a.mainTitle),a.hasMoreType?c.renderDeployTypes(a):c.renderDeploysingle(a),f.remove(e),c.jugHoverEmpty(),c.setPanelBody(d),c.resetLocalData(g,h)}}})})}})},linkoutApp:function(a){var b=this,c=f.parent(a,".J_Tmsg_Panel_Apps"),d=f.parent(a,".J_Tmsg_App"),e=f.attr(d,"data-app-id"),g=f.attr(d,"data-app-type");i.getToken(function(a){i.ajax(i.renderUrl(i.apis.appReaden),{appId:e,m_token:a},function(a){i.deal(a,{noLogin:{code:"-1"},success:{code:"1",callback:function(){f.remove(d),b.jugHoverEmpty(),b.setPanelBody(c),b.resetLocalData(e,g)}}})})})},readyPanel:function(b,c){var d=this,e=f.create(a.substitute(j.panel.apps.apps_head2,{title:c})),g=f.create(j.panel.apps.apps_body),h=f.create(j.panel.foot);f.html(b,""),f.append(e,b),f.append(g,b),f.append(h,b),d.setMessageCenterLink(b)},setPanelBody:function(b){var c=f.get(".J_Tmsg_Panel_AppsBody",b),d=(f.docHeight(),f.viewportHeight()),g=f.innerHeight(b);g+35>d&&(f.css(c,{height:g-(g-d)-35-37-32-100+"px",overflow:"auto"}),a.getScript(i.cdnHost+"tbc/tmsg/"+l+"/plugin/scroll-min.css",{success:function(){a.use("gallery/kscroll/1.2/",function(a,b){e=new b(c,{prefix:"clear-",hotkey:!0,bodydrag:!0,allowArrow:!0})})}}))},toggleStrongPanel:function(){var a=f.get("#J_Tmsg"),b=f.get(".J_Tmsg_Panel_Strong",a);f.get(".tmsg_panel_active",a)||f.show(b)},togglePanel:function(a){var b=this,c=f.get("#J_Tmsg"),d=f.get(".J_Menu",c),e=f.get(".menu-bd",c),g=f.get(".J_Tmsg_Panel_Detail",c),h=f.get(".J_Tmsg_Panel_history",c),i=f.get(".J_Tmsg_Panel_Setting",c);f.removeClass(g,"tmsg_panel_active"),f.removeClass(h,"tmsg_panel_active"),f.removeClass(i,"tmsg_panel_active"),f.hide(e),f.hide(g),f.hide(i),f.hide(h),b.setPanelBody(a),f.addClass(a,"tmsg_panel_active"),f.show(a),f.addClass(d,"menu-active")},jugHoverEmpty:function(){var a=this,b=f.get("#J_Tmsg"),c=f.get(".J_Tmsg_Panel_Apps",b),d=f.get(".J_Tmsg_Panel_AppsBody",c);f.get(".J_Tmsg_App",d)||a.switchNoMessageTemp()},deleteMessage:function(b){var c=this,d=f.parent(b,".J_Tmsg_App"),g=f.attr(d,"data-message-id");i.getToken(function(b){i.ajax(i.renderUrl(i.apis.deleteMessage),{messageId:g,m_token:b},function(b){b&&b.status&&("1"!=b.status&&(b.status="delErr"),i.deal(b,{noLogin:{code:"-1"},success:{code:"1",callback:function(){var b=function(){return a.all(".J_Tmsg_App",".J_Tmsg_Panel_AppsBody").length};f.remove(d);var g=b();if(g)if(1==g)c.switchHistoryMessage();else{var h=f.viewportHeight(),i=a.all(".J_Tmsg_Panel_AppsBody.clear-body").height();h>=i+35&&(i-(i-h)-35-37-32-100>i?a.all(".J_Tmsg_Panel_history .clear-container").css({height:i+"px"}):a.all(".J_Tmsg_Panel_history .clear-scrollbar").hide()),e&&e.scrollByDistance(0)}else c.goback()}},delErr:{code:"delErr",callback:function(){c.goback()}}}))})})},setSettingList:function(b){var c=this,d=f.get("#J_Tmsg"),e=f.get(".J_Tmsg_Panel_Setting",d),g=f.get(".J_Tmsg_Panel_AppsBody",e);i.ajax(b,{},function(b){i.deal(b,{noLogin:{code:"-1"},success:{code:"1",callback:function(b){var d=b.content,h="",i=0;if(0==d.length)f.html(g,j.panel.errors.no_message_when_setting);else if(d.length<=5&&d.length>0){for(;i<d.length;i++)h+=a.substitute(j.setting.list,{appId:d[i].appId,appName:d[i].appName,statusNum:d[i].acceptable?"1":"0",status:d[i].acceptable?"open":"close"});f.html(g,a.substitute(j.setting.wrap,{title:"\u6700\u8fd1\u63a5\u6536\u7684\u6d88\u606f",list:h}))}else if(d.length>5){for(;5>i;i++)h+=a.substitute(j.setting.list,{appId:d[i].appId,appName:d[i].appName,statusNum:d[i].acceptable?"1":"0",status:d[i].acceptable?"open":"close"});if(f.html(g,a.substitute(j.setting.wrap,{title:"\u6700\u8fd1\u63a5\u6536\u7684\u6d88\u606f",list:h})),d.length>5){for(var k=5,l="";k<d.length;k++)l+=a.substitute(j.setting.list,{appId:d[k].appId,appName:d[k].appName,statusNum:d[k].acceptable?"1":"0",status:d[k].acceptable?"open":"close"});var m=f.create(a.substitute(j.setting.wrap,{title:"\u8f83\u65e9\u63a5\u6536\u7684\u6d88\u606f",list:l}));f.append(m,g)}}c.togglePanel(e)}}})})},setSetting:function(){var a=this,b=f.get("#J_Tmsg"),c=f.get(".J_Tmsg_Panel_Setting",b);a.readyPanel(c,"\u6d88\u606f\u8bbe\u7f6e"),i.switchGlobal({common:function(){var b=i.renderUrl(i.apis.buyerSettingList);a.setSettingList(b)},seller:function(){var b=i.renderUrl(i.apis.sellerSettingList);a.setSettingList(b)}})},setAppStatus:function(a){var b=f.parent(a,".J_Tmsg_App_Setting_Item"),c=f.attr(b,"data-app-id"),d=f.get(".tmsg_app_settilg-item_edit",b),e=f.attr(d,"data-status");i.getToken(function(a){i.ajax(i.renderUrl(i.apis.SettingSet),{appId:c,status:1==e?"0":"1",m_token:a},function(a){i.deal(a,{noLogin:{code:"-1"},success:{code:"1",callback:function(){1==e?(f.attr(d,"data-status","0"),f.removeClass(d,"tmsg_app_settilg-item_status_open"),f.addClass(d,"tmsg_app_settilg-item_status_close")):(f.attr(d,"data-status","1"),f.removeClass(d,"tmsg_app_settilg-item_status_close"),f.addClass(d,"tmsg_app_settilg-item_status_open"))}}})})})},goback:function(){var a=f.get("#J_Tmsg"),b=f.get(".J_Menu",a),c=f.get(".menu-bd",a),d=f.get(".J_Tmsg_Panel_Detail",a),e=f.get(".J_Tmsg_Panel_history",a),g=f.get(".J_Tmsg_Panel_Setting",a);f.addClass(b,"menu-hover"),f.removeClass(d,"tmsg_panel_active"),f.removeClass(e,"tmsg_panel_active"),f.removeClass(g,"tmsg_panel_active"),f.hide(d),f.hide(e),f.hide(g),f.removeClass(b,"menu-active"),f.show(c)},showTips:function(c){f.get(".J_Tmsg_Tips_Wraps")&&f.remove(".J_Tmsg_Tips_Wraps"),a.use("overlay",function(a,d){var e=j.tips.wraps,g=f.attr(c,"data-tips"),h=f.innerWidth(c);b=new d({width:"",elCls:"J_Tmsg_Tips_Wraps",content:a.substitute(e,{tipsContent:j.tips.content[g]}),zIndex:1e10,align:{node:c,points:["tr","tl"],offset:[-h,75]}}),b.render();var i=f.get(".J_Tmsg_Tips_Wraps");f.css(i,{position:"absolute"}),b.show()})},hideTips:function(){b.destroy&&b.destroy()},refresh:function(){var b=this,c=i.renderUrl(i.apis.unreadMessage);i.ajax(c,{},function(c){i.deal(c,{noLogin:{code:"-1"},success:{code:"1",callback:function(c){p=!0,m=a.merge(m,c.content,{newMsgTag:!1}),k.setItem("1067",m),k.notify([{t1:"1067",content:m}],!0),b.renderHoverList(m)}}})})},popupReaded:function(a){var b=f.attr(a,"data-message-id");i.getToken(function(a){i.ajax(i.renderUrl(i.apis.popupReaden),{m_token:a,messageId:b},function(){})})},popupClose:function(){var a=this,b=f.get("#J_Tmsg"),c=f.get(".J_Tmsg_Panel_StrongPop",b),d=f.get(".J_Tmsg_Panel_Strong_Item_Active",c);i.sendStatistic("21.5"),a.popupReaded(d),f.remove(c)},popupPrev:function(b){var c=this,d=f.parent(b,".J_Tmsg_Panel_Strong"),e=f.get(".J_Tmsg_Panel_Strong_Item_Active",d),g=f.prev(e),h=f.query(".tmsg_panel_strong_item",d);return f.attr(e,"data-message-id")==f.attr(h[h.length-1],"data-message-id")&&c.popupReaded(e),g?(a.each(h,function(a){f.removeClass(e,"J_Tmsg_Panel_Strong_Item_Active"),f.hide(a)
}),f.addClass(g,"J_Tmsg_Panel_Strong_Item_Active"),f.show(g),void 0):!1},popupNext:function(b){var c=this,d=f.parent(b,".J_Tmsg_Panel_Strong"),e=f.get(".J_Tmsg_Panel_Strong_Item_Active",d),g=f.next(e),h=f.query(".tmsg_panel_strong_item",d);return g?(a.each(h,function(a){f.removeClass(e,"J_Tmsg_Panel_Strong_Item_Active"),f.hide(a)}),f.addClass(g,"J_Tmsg_Panel_Strong_Item_Active"),f.show(g),void c.popupReaded(e)):!1},showCheckAll:function(a){var b=f.parent(a,".J_Tmsg_Panel_Foot"),c=f.get(".J_Tmsg_Button_CheckAll_Wrap",b);i.switchGlobal({common:function(){m.hasSellerMsg&&f.html(c,'<a href="'+i.renderUrl("http://msg.{serverHost}/message/list.htm?scm=1229.325.1.2")+'" target="_blank">\u4e70\u5bb6\u6d88\u606f</a><span style="margin:0 7px">|</span><a href="'+i.renderUrl("http://msg.{serverHost}/seller/seller_list.htm?scm=1229.325.1.3")+'" target="_blank">\u5356\u5bb6\u6d88\u606f</a>')}})},bindBaseEvent:function(){var b=this,c=f.get("#J_Tmsg");o=!0,h.delegate(c,"click",".J_Tmsg_Button_CloseApp",function(a){a.preventDefault(),i.sendStatistic("21.10"),b.ignoreSingle(a.target)}),h.delegate(c,"click",".J_Tmsg_Button_ReadAll",function(a){a.preventDefault(),b.ignoreAll(a.target)}),h.delegate(c,"click",".J_Tmsg_Button_CheckPrevMsgs",function(c){c.preventDefault(),i.sendStatistic("21.9"),a.getScript(i.cdnHost+"tbc/tmsg/"+l+"/content-min.css",{success:function(){b.switchHistoryMessage()}})}),h.delegate(c,"click",".J_Tmsg_Button_DeployApp",function(a){a.preventDefault(),i.sendStatistic("21.11"),b.deployApp(a.target)}),h.delegate(c,"click",".J_Tmsg_Button_LinkoutToAPP",function(a){b.linkoutApp(a.target)}),h.delegate(c,"click",".J_Tmsg_Apps_Single-Item_Link",function(a){b.linkoutApp(a.target)}),h.delegate(c,"click",".J_Tmsg_Button_Setting",function(c){c.preventDefault(),i.sendStatistic("21.8"),a.getScript(i.cdnHost+"tbc/tmsg/"+l+"/content-min.css",{success:function(){b.setSetting(c.target)}})}),h.delegate(c,"click",".tmsg_app_settilg-item_edit",function(a){a.preventDefault(),b.setAppStatus(a.target)}),h.delegate(c,"click",".J_Tmsg_Button_GoBack",function(a){a.preventDefault(),b.goback(a.target)}),h.delegate(c,"click",".J_Tmsg_Button_Refresh",function(a){a.preventDefault(),b.refresh()}),h.delegate(c,"click",".J_Tmsg_Button_CheckAll",function(a){a.preventDefault(),b.showCheckAll(a.target)}),h.delegate(document,"click","body",function(a){var b=a.target,d=f.get(".tmsg_panel_active",c),e=!f.parent(b,".tmsg_panel_active");d&&e&&function(){var a=f.get(".J_Menu",c),b=f.get(".menu-bd",a);f.removeClass(a,"menu-active"),f.style(b,"display",""),f.hide(d)}()}),h.delegate(c,"mouseleave",".J_Menu",function(){i.switchGlobal({seller:function(){var a=f.get("#J_Tmsg"),b=f.get(".menu-bd",a);"block"==f.css(b,"display")&&f.style(b,"display","")}})}),h.delegate(c,"mouseenter",".J_Tmsg_Panel_Strong",function(){i.sendStatistic("21.3")}),h.delegate(c,"click",".J_Tmsg_App_Remove",function(a){a.preventDefault(),b.deleteMessage(a.target)})}},i}),KISSY.add("tbc/tmsg/3.3.14/index",function(a){var b=TMsg.cdnHost+"tbc/tmsg/3.3.14/index-min.css";TMsg.isKS16?a.getScript(b):a.getScript(b,function(){}),TMsg.base&&TMsg.base.init()},{requires:["tbc/tmsg/3.3.14/mods/const","tbc/tmsg/3.3.14/mods/utils","tbc/tmsg/3.3.14/mods/tmsg"]});